!function(){var define=document.getElementById('newBridge').define;define("bull/aop/JointPoint",["require"],function(require){function e(e,t,n,i,o,r){this.thisp=e,this.args=t,this.modName=n,this.funcName=i,this.func=o,this.returnValue=r}return e.prototype={constructor:e,getThis:function(){return this.thisp},getArgs:function(){return this.args},getModName:function(){return this.modName},getFuncName:function(){return this.funcName},getFunc:function(){return this.func},setReturnValue:function(e){this.returnValue=e},getReturnValue:function(){return this.returnValue}},e}),define("bull/aop/aopEmitter",["require","./main"],function(require){function e(e,n,i){var o=[],r=t;if(r=r[e]||{},r=r[n]||{},r=r[i]||[],"[object Array]"==={}.toString.call(r))for(var a=0;a<r.length;a++)o.push(r[a]);return o}var exports={},t={};return exports.on=function(e,n,i,o){var r=t;r[e]=r[e]||{},r=r[e],r[n]=r[n]||{},r=r[n],r[i]=r[i]||[],r=r[i],r.push({func:o.func,funcName:o.funcName,modName:o.modName})},exports.getBefore=function(t,n){return e(require("./main").TypeEnum.BEFORE,t,n)},exports.queryBefore=function(e,t){var n=exports.getBefore();if(console.log("method before "+e+" -> "+t+":"),!n.length)return void console.log("none");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getAfter=function(t,n){return e(require("./main").TypeEnum.AFTER,t,n)},exports.queryAfter=function(e,t){var n=exports.getAfter();if(!n.length)return void console.log("none");console.log("method after "+e+" -> "+t+":");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getRegisterAop=function(e){var n={},i=[],o=t[e];for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];for(var s in a)if(a.hasOwnProperty(s)){if(!n[s])n[s]=!0,i.push({modName:r,funcName:s,from:a[s][0].modName})}}return i},exports.emit=function(t,n,i,o){for(var r=e(t,n,i),a=0;a<r.length;a++)r[a].func(o)},exports}),define("bull/microPromise/microPromise",["require"],function(require){function e(){for(var e=arguments.length,n=0,i=t(),o=[],r=0;r<e;r++){var a=arguments[r];!function(t){a.then(function(r){if(n++,o[t]=r,n===e)i.resolve.apply(i,o)},function(){i.reject()})}(r)}return i.promise()}var t=function(){function e(){for(var e=this,t=0;t<o.length;t++)!function(t){if(a&&a[0]&&a[0].then)a[0].then(function(){o[t].apply(e,arguments)});else setTimeout(function(){o[t].apply(e,a)},0)}(t)}function n(){for(var e=this,t=0;t<r.length;t++)!function(t){setTimeout(function(){r[t].apply(e,a)},0)}(t)}function i(e,n){var i=t();if(d===c.resolved){var l=this;setTimeout(function(){e.apply(l,a)},0)}else if(d===c.reject){var l=this;setTimeout(function(){n.call(l,s)},0)}else{if(e)o.push(function(){i.resolve(e.apply(l,arguments))});if(n)r.push(function(e){n(e),i.reject()})}return i.promise()}if(!this instanceof t)return new t;var o=[],r=[],a=[],s="",c={pendding:1,resolved:2,rejected:3},d=c.pendding;return{resolve:function(){var t=Array.prototype.slice.call(arguments,0);if(d===c.pendding)a=t,d=c.resolved,e.call(this)},reject:function(e){if(d===c.pendding)s=e,d=c.rejected,n.call(this)},then:i,promise:function(){return{then:i}}}};return{Deferred:t,when:e}}),define("bull/aop/main",["require","./JointPoint","./aopEmitter","../loader","../microPromise/microPromise"],function(require){function e(e,t,n){r.emit(a.BEFORE,e,t,n)}function t(e,t,n){r.emit(a.AFTER,e,t,n)}function n(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function i(e){e=e||"";var t=e.split(","),i=n(t[0]||""),o=n(t[1]),r=n(t[2]);return t=i.split("."),{packageName:t[0],modName:t[1],funcName:t[2],before:o,after:r}}var exports={},o=require("./JointPoint"),r=require("./aopEmitter"),a=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(n,i,r){var a=require("../loader"),s=require("../microPromise/microPromise");return function(){var c=[],d=Array.prototype.slice.call(arguments,0),l=new o(this,d,n,i,r),u={jointPoint:l,microPromise:s};e(n,i,l);var f=a.getInjection(n)||{},m=f[i]||[];if("[object Array]"==={}.toString.call(m))for(var g=0;g<m.length;g++){var p=m[g];if(p in u)c.push(u[p]);else c.push(a.get(p))}c=c.concat(d);var b=r.apply(this,c);if(b&&b.then)b.then(function(e){l.setReturnValue(e),t(n,i,l)});else l.setReturnValue(b),t(n,i,l);return b}},exports.aspectRegister=function(e,t,n){var o=require("../loader");if(-1===e.indexOf("."))e=t+"."+e;for(var s=0;s<n.length;s++)!function(t){t.before&&r.on(a.BEFORE,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.before,func:function(n){var i=o.get(e)[t.before];if(!i)throw'module "'+e+"\" don't have method "+t.before;i.apply(n.getThis(),n.getArgs())}}),t.after&&r.on(a.AFTER,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.after,func:function(n){var i=o.get(e)[t.after];if(!i)throw'module "'+e+"\" don't have method "+t.after;i.apply(n.getThis(),n.getArgs())}})}(i(n[s]))},exports}),define("bull/loader",["require","./aop/main"],function(require){function e(t,n){var i;if("function"==typeof n){e(t,n.prototype);var o=c(t,r,n);return o.prototype=n.prototype,o}else{for(var r in n)if(n.hasOwnProperty(r))if("function"==typeof(i=n[r]))n[r]=c(t,r,i);return n}}function t(e){e=e||[];for(var t=0;t<e.length;t++)exports.init(e[t])}function n(t,n){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];if(i=n+"."+i,r.hasOwnProperty(i)){if(o._belong&&i!==o._belong)throw'module conflict: module "'+i+'" is already register to "'+o._belong+'"'}else{if(o._belong)throw'module "'+i+'" already register to "'+o._belong+'"';o._belong=i,r[i]=e(i,o)}}}function i(e,t){e=e||[];for(var n=0;n<e.length;n++){var i=e[n];a[i.id]=a[i.id]||{};var o=a[i.id],r=i.method;for(var s in r)o[s]=r[s]}}function o(e,t){for(var n=0;n<e.length;n++){var i=e[n];d(i.id,t,i.pointCut)}}var exports={},r={},a={},s=require("./aop/main"),c=s.createAopProxy,d=s.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var r=e.package;if(!r&&(e.resource||e.aspect))throw"package name not found";t(e.importConfig),e.resource&&n(e.resource,r),e.aspect&&o(e.aspect,r),e.injection&&i(e.injection,r)}},exports.getInjection=function(e){return a[e]},exports.getDeps=function(e){var t=a[e],n={};for(var i in t)if(t.hasOwnProperty(i))for(var o=t[i],r=0;r<o.length;r++)n[o[r]]=!0;delete n[e];var s=[];for(var i in n)if(i.indexOf(".")>-1)s.push(i);return s},exports.queryDep=function(e){var t=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!t.length)console.log("none");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var t=[];for(var n in r)if(r.hasOwnProperty(n))if(e){if(n.indexOf(e)>-1)t.push(n)}else t.push(n);return t},exports.queryModule=function(e){var t=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var t=[],n={};for(var i in a)if(a.hasOwnProperty(i)){var o=a[i];for(var r in o)if(o.hasOwnProperty(r))for(var s=o[r],c=0;c<s.length;c++){var d=s[c];if(d===e){var l=i+d;if(l in n)continue;else n[l]=!0;t.push({modName:i,funcName:r})}}}if(t.length){console.log("module "+e+" used by these method:");for(var c=0;c<t.length;c++)console.log(t[c].modName+" -> "+r)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,t=0;console.log("checking deps:");for(var n in r)if(r.hasOwnProperty(n)){e=exports.getDeps(n);for(var i=0;i<e.length;i++)if(!exports.has(e[i]))if(e[i].indexOf(".")>-1)t++,console.log(e[i]+" is required by "+n+" but now missing")}if(!t)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in r},exports.get=function(e){if(e in r)return r[e];else throw'module "'+e+'" not found'},exports}),define("bull/main",["require","./loader","./aop/aopEmitter"],function(require){function e(){var e=document.createElement("div"),t=e.style;t.position="fixed",t.right="20px",t.top="20px",t.border="solid 1px black",t.backgroundColor="#eee",e.innerHTML="\u70b9\u6b64\u67e5\u770b<br/>\u6a21\u5757\u5173\u7cfb";var n=!1;e.onclick=function(){if(!n)n=!0,require(["bull/debug"],function(e){n=!1,e.entry()})},document.body.insertBefore(e,document.body.firstChild)}function t(){if(location.hash.indexOf("bullDebug")>-1)e()}var exports={},n=require("./loader"),i=require("./aop/aopEmitter");return exports.get=n.get,exports.queryBefore=i.queryBefore,exports.queryAfter=i.queryAfter,exports.queryInvoke=n.queryInvoke,exports.queryDep=n.queryDep,exports.checkDep=n.checkDep,exports.queryModule=n.queryModule,exports.init=function(e){t(),n.init(e)},exports}),define("bull",["bull/main"],function(e){return e}),define("embed/webimlight/statusbar/main",[],function(){function e(){var e=t.getBoundingClientRect(),n=e.width||e.right-e.left,i=e.height||e.bottom-e.top,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;c=o-n-u,d=r-i-f}var t,n,i,o,r,a,s,c,d,exports={},l=!document.getElementById("nb_comp_btn"),u=20,f=10,m=0;return exports.show=function(e){e.addClass(t,"maxMessageContainer"),e.removeClass(t,"minMessageContainer"),e.removeClass(o,"nb-webim-light-hide"),exports.fixPosition()},exports.hide=function(e){e.removeClass(t,"maxMessageContainer"),e.addClass(t,"minMessageContainer"),e.addClass(o,"nb-webim-light-hide"),exports.fixPosition()},exports.toggle=function(e,n){if(n.hasClass(t,"minMessageContainer"))exports.show(),e.emit("webimLightStatus","show"),n.hide(["msgTip"]);else exports.hide(),e.emit("webimLightStatus","hide")},exports.clearMessageStatus=function(){m=0,i.style.display="none"},exports.syncClearMessage=function(e){e.emit("clearMessageCount",Math.random())},exports.displayMessagStatus=function(){m++,i.innerHTML=m,i.style.display=""},exports.addMessageCount=function(e,t){if(e.isConnected())if(!t||t.role)exports.displayMessagStatus()},exports.startDrag=function(t){if(t.target!==o)r=!0,e(),a=c+t.offsetX,s=d+t.offsetY,t.preventDefault()},exports.draging=function(e){if(r){var i=e.target===n,o=a-e.clientX+u,l=s-e.clientY+f;if(o>c||o<u){if(i)a=c+e.offsetX;o=Math.max(Math.min(o,c),u)}if(l>d||l<f){if(i)s=d+e.offsetY;l=Math.max(Math.min(l,d),f)}t.style.right=o+"px",t.style.bottom=l+"px",t.style.left="auto"}},exports.endDrag=function(){r=!1},exports.fixPosition=function(){e();var n=t.style.right.match(/\d+/)||[u],i=t.style.bottom.match(/\d+/)||[f];n=parseInt(n[0],10),i=parseInt(i[0],10),n=Math.max(Math.min(n,c),u),i=Math.max(Math.min(i,d),f),t.style.right=n+"px",t.style.bottom=i+"px"},exports.render=function(e,r,a,s){var c=a.prependHTML(r.template(e.get("statusbar")))[1],d=s.getServer("configBox").webimConfig;if(1===d.themeType)a.setStyles(c,{backgroundColor:d.customerColor,backgroundImage:"none"});t.appendChild(c),n=a.g("nbwlStatusBar"),i=a.g("nbwlUnreadCount"),o=a.g("nbwlToggle")},exports.clickAlertAware=function(){document.getElementById("nbawareFraudWrap").style.display="block",document.getElementById("nbawareFraud").addEventListener("click",function(){exports.dialogShow()}),document.getElementById("nbawareFraudClose").addEventListener("click",function(){exports.deleteAware()})},exports.deleteAware=function(){document.getElementById("nbawareFraudWrap").style.display="none",document.getElementById("nbwlMessageContainer").style.height="275px",document.getElementById("nbwlMessageContainer").style.marginTop="0"},exports.dialogShow=function(){if(!document.getElementById("awareFraudDialog")){var e=document.createElement("div");e.id="awareFraudDialog",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.background="rgba(0,0,0,0.5)",e.style.zIndex="2147483648";e.innerHTML='<div style="margin: 0 auto;padding: 24px 24px; font-size: 12px;width: 352px; height: 152px;box-sizing: content-box;background: #fff; position: fixed; top: calc(50% - 100px);left :calc(50% - 200px);color: #666; z-index:2147483649;border-radius: 3px;line-height: 1; text-align: center;"><div style="font-size: 14px; color: #333333;">\u670d\u52a1\u58f0\u660e</div><div style="margin-top: 16px; text-align: left;">\u767e\u5ea6\u5546\u6865\u4ec5\u63d0\u4f9b\u54a8\u8be2\u8f6f\u4ef6\u6280\u672f\u670d\u52a1\uff0c\u54a8\u8be2\u5185\u5bb9\u5747\u7531\u5546\u5bb6\u63d0\u4f9b\uff0c\u5546\u5bb6</div><div style="margin-top: 8px;text-align: left;">\u5bf9\u672c\u670d\u52a1\u4fe1\u606f\u5185\u5bb9\u3001\u6570\u636e\u8d44\u6599\u7b49\u771f\u5b9e\u6027\u3001\u5408\u6cd5\u6027\u53ca\u6709\u6548\u6027\u627f\u62c5\u5168\u90e8</div><div style="margin-top: 8px;text-align: left;">\u8d23\u4efb\u3002\u5982\u679c\u60a8\u4e0e\u5546\u5bb6\u53d1\u751f\u8d44\u91d1\u5f80\u6765\u53ef\u80fd\u5b58\u5728\u98ce\u9669\u3002\u8bf7\u6ce8\u610f\u6838\u5b9e\u771f\u5b9e</div><div style="margin-top: 8px;text-align: left;">\u8eab\u4efd\uff0c\u6d89\u53ca\u6c47\u6b3e\u3001\u8f6c\u8d26\u7b49\u52a1\u5fc5\u7535\u8bdd\u786e\u8ba4\uff0c\u8c28\u9632\u8bc8\u9a97\u3002</div><button id="awareFraudDialogNoticed" style="cursor: pointer; margin-top: 24px;background: #02A9ED; width: 72px; height: 28px;border-radius: 3px;font-size: 12px; color: #FFFFFF; text-align: center;border: none; outline: none;">\u6211\u77e5\u9053\u4e86</button></div>',document.body.appendChild(e),document.getElementById("awareFraudDialogNoticed").addEventListener("click",function(t){document.getElementById("awareFraudDialog").parentNode.removeChild(e)})}},exports.bindEvent=function(e,t){e.domOn(o,"click",exports.toggle),e.domOn(n,"mousedown",exports.startDrag),e.domOn(document,"mousemove",e.throttle(exports.draging,20)),e.domOn(document,"mouseup",exports.endDrag),e.domOn(window,"resize",e.debounce(exports.fixPosition,500)),t.on("clearMessageCount",exports.clearMessageStatus),t.on("webimLightStatus",function(e){if(!l)return l=!0,void exports.show();else if("hide"===e)exports.hide();else exports.show()})},exports.init=function(e,n,i){t=e.g("nbWebImLightContainer"),n.parse(i),exports.render(),exports.bindEvent()},exports}),define("embed/webimlight/statusbar/notify",[],function(){var e,exports={},t=document.title,n=500;return exports.display=function(i){var o=i.LANG.TITLENOTIFY;if(!e){if(!t)t=document.title;var r=0;e=setInterval(function(){var e=r%o.length;document.title=o.substring(e),r++},n)}},exports.clear=function(){clearInterval(e),e=0,document.title=t},exports}),define("embed/webimlight/statusbar/main.tpl",[],function(){return'\x3c!-- target: statusbar --\x3e<ins id="nbwlStatusBar"><ins id="nbwlFuncContainer"><ins id="nbwlClose" class="nb-webim-light-status-bar-close"><ins class="nb-webim-light-status-bar-close-icon"></ins></ins><ins id="nbwlToggle" class="nb-webim-light-status-bar-toggle"><ins class="nb-webim-light-toggle-icon"></ins></ins></ins>\x3c!--<ins id="nbwlOpenWebim" title="\u6253\u5f00\u65b0\u6c9f\u901a\u7a97\u53e3"></ins>--\x3e<ins class="nb-webim-light-status-bar-title">\u5728\u7ebf\u54a8\u8be2</ins><ins id="nbwlUnreadCount" style="display: none;"></ins>\x3c!--<div class="nbaware-fraud-tip" id="nbawareFraudWrap"><img src="http://aff-im.cdn.bcebos.com/onlineEnv/r/image/pc-icon.png" class="nbaware-fraud-tip-icon"><span style="margin-left: 14px;line-height:36px;">\u6700\u8fd1\u8bc8\u9a97\u6848\u4ef6\u9891\u53d1\uff0c\u8c28\u9632\u8bc8\u9a97\uff0c</span><span id="nbawareFraud" class="nbaware-fraud-tip-check">\u67e5\u770b\u300a\u670d\u52a1\u58f0\u660e\u300b</span><img src="http://aff-im.cdn.bcebos.com/onlineEnv/r/image/pc-close-icon.png" id="nbawareFraudClose" class="nbaware-fraud-close"></div>--\x3e</ins>'}),define("embed/webimlight/statusbar/config",["require","./main","./notify","./main.tpl"],function(require){return{package:"statusbar",resource:{main:require("./main"),notify:require("./notify"),tpl:require("./main.tpl")},injection:[{id:"statusbar.main",method:{init:["pbase.dom","common.tpl","statusbar.tpl"],render:["common.tpl","common.util","pbase.dom","data.config"],addMessageCount:["core.chat"],syncClearMessage:["communicate.synchronizer"],toggle:["communicate.synchronizer","pbase.dom"],show:["pbase.dom"],hide:["pbase.dom"],bindEvent:["pbase.events","communicate.synchronizer"]}},{id:"statusbar.notify",method:{display:["webimlight.commonConfig"]}}],aspect:[{id:"statusbar.main",pointCut:["layout.main.render, , init","layout.main.hasOperation, , clearMessageStatus","layout.main.hasOperation, , syncClearMessage","messagecontainer.main.renderMessage, , addMessageCount","webimlight.entry.show, , show"]},{id:"statusbar.notify",pointCut:["statusbar.main.displayMessagStatus, , display","statusbar.main.clearMessageStatus, , clear"]}]}}),define("embed/webimlight/robot/main",["require"],function(require){var e,t,n,exports={};return exports.render=function(i,o,r,a,s){var c=i.domain+"/msgIndex?siteId="+s.siteid+"&userId="+s.eid+"&siteToken="+s.siteToken;if(/^https:/.test(c))c=c.replace(/^https/,"http");else if(/^\/\//.test(c))c="http:"+c;a.appendHTML(r.template(o.get("irTipLayer"),{url:c}),e),t=a.g("nbGotoMsg"),n=a.g("nbTransToCs")},exports.bindEvents=function(){document.getElementById("nbTransToCs-close").onclick=function(){exports.hideOnline()},document.getElementById("nbTransToCs-btn").onclick=function(){return exports.send({type:"transfer"}),!1}},exports.send=function(e){},exports.showMsg=function(){t.style.display="block"},exports.showOnline=function(e,t){if("IR"===t)n.style.display="block"},exports.hideOnline=function(){n.style.display="none"},exports.hideMsg=function(){t.style.display="none"},exports.hideLayer=function(){exports.hideOnline(),exports.hideMsg()},exports.init=function(t,n,i){e=t.g("nbWebImLightContainer"),n.parse(i),exports.render(),exports.bindEvents()},exports}),define("embed/webimlight/robot/main.tpl",[],function(){return'\x3c!-- target: irTipLayer --\x3e<ins id="nbIRLayer" class="nb-robot-layer"><ins id="nbGotoMsg" class="nb-robot-layer-in nb-robot-layer-msg"><ins class="nb-robot-text"><span>\u4ee5\u4e0b\u4fe1\u606f\u6ca1\u6709\u5e2e\u52a9\u5230\u60a8\uff0c\u8bf7</span><a href="<%url%>" target="_blank">[ \u7559\u8a00 ]</a></ins></ins><ins id="nbTransToCs" class="nb-robot-layer-in nb-robot-layer-cs"><ins class="nb-robot-text"><ins id="nbTransToCs-close"></ins><span>\u5ba2\u670d\u5df2\u4e0a\u7ebf\uff0c\u60a8\u662f\u5426</span><a href="#" id="nbTransToCs-btn">[ \u5728\u7ebf\u6c9f\u901a ]</a></ins></ins></ins>'}),define("embed/webimlight/robot/config",["require","./main","./main.tpl"],function(require){return{package:"robot",resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"robot.main",method:{init:["pbase.dom","common.tpl","robot.tpl"],render:["webimlight.commonConfig","common.tpl","common.util","pbase.dom","core.config"]}}],aspect:[{id:"robot.main",pointCut:["communicate.handler.currentIR, ,init","communicate.handler.showMsgRemind, ,showMsg","communicate.handler.csonline, ,showOnline","communicate.handler.fininshIR, ,hideLayer","communicate.handler.transferError, ,hideOnline"]}]}}),define("im-lib/lang/isObject",[],function(){return function(e){return"[object Object]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/isArray",[],function(){return function(e){return"[object Array]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/extend",[],function(){return function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}),define("im-lib/lang/each",["require","./isArray"],function(require){return function(e,t,n){if(require("./isArray")(e)){for(var i=e.length,o=0;o<i;o++)if("function"==typeof t)t.call(n,e[o],o,e)}else for(var r in e)if(e.hasOwnProperty(r))t.call(n,r,e[r],e)}}),define("im-lib/lang",["require","./lang/isObject","./lang/isArray","./lang/extend","./lang/each"],function(require){var exports={};return exports.isObject=require("./lang/isObject"),exports.isArray=require("./lang/isArray"),exports.extend=require("./lang/extend"),exports.each=require("./lang/each"),exports}),define("im-lib/json",[],function(){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,n,i,r=["["],a=e.length;for(n=0;n<a;n++)switch(typeof(i=e[n])){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(o(i)),t=1}return r.push("]"),r.join("")}function n(e){return e<10?"0"+e:e}function i(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}function o(n){switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return e(n);case"boolean":return String(n);default:if(null===n)return"null";else if(n instanceof Array)return t(n);else if(n instanceof Date)return i(n);else{var r,a,s=["{"],c=o;for(var d in n)if(Object.prototype.hasOwnProperty.call(n,d))switch(typeof(a=n[d])){case"undefined":case"unknown":case"function":break;default:if(r)s.push(",");r=1,s.push(c(d)+":"+c(a))}return s.push("}"),s.join("")}}}var exports={};exports.parse=function(e){if(window.JSON&&JSON.parse)return JSON.parse(e);else return new Function("return ("+e+")")()},exports.stringify=function(e){if(window.JSON&&JSON.stringify)return JSON.stringify(e);else return o(e)};var r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return exports}),define("im-lib/net",[],function(){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}var exports={};return exports.imgRequest=function(e){document.createElement("img").src=e},exports.jsonp=function(e,t){function n(){return(new Date).getTime()}function i(){return Math.random().toString().substr(2)}function o(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function r(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var i in e)if(e.hasOwnProperty(i))t+="&"+i+"="+encodeURIComponent(e[i]);return t+="&_time="+n(),t=t.substr(1)}function a(e,a,s,c){var d,l=(a.op,a.l);a=null,e=e+(-1===e.indexOf("?")?"?":"&")+r(a);var u=/callback=(\w+)/.exec(e);if(u&&u[1])d=u[1];else d="jsonp_bridge_"+n()+"_"+i(),e=e.replace("?","?"+t.key+"="+d+"&");var f=document.createElement("script");f.type="text/javascript",f.src=e,f.id="id_"+d,f.charset="utf-8";var m=!0,g=null;if(window[d]=function(e){clearTimeout(g),window[d]=void 0;var t=document.getElementById("id_"+d);setTimeout(function(){o(t)},0),s(e),m=!1},"onerror"in f)f.onerror=function(){c&&c(),o(f)},m=!1;var p=1e4;if(1===l)p+=2e4;g=setTimeout(function(){if(m)c&&c(),o(f)},p);var b=document.getElementsByTagName("head")[0];if(b)setTimeout(function(){b.appendChild(f)},0)}a(e,t,t.success,t.failure)},exports.request=function(t,n){var i=e(),o=n.headers||{},r=3e4,a=setTimeout(function(){i.onreadystatechange=null,i.abort(),n.failure&&n.failure()},r);if(i.open(n.method||"GET",t),o["Content-Type"])o["Content-Type"]=o["Content-Type"],i.setRequestHeader("Content-Type",o["Content-Type"]),delete o["Content-Type"];return i.onreadystatechange=function(){if(4===i.readyState)if(clearTimeout(a),i.status>=200&&i.status<300||304===i.status){if(n.success)n.success(i.responseText)}else if(n.failure)n.failure()},i.send(n.data),i},exports.upload=function(e,t,n,i,o){function r(){i(),u.onload=function(){},u.parentNode.removeChild(u)}function a(){o(),u.onerror=function(){},u.parentNode.removeChild(u)}if("/"===e.charAt(0)&&!/^\/\//.test(e))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)&&window.clouda){var s=t;clouda.device.fs.post(s,e,{onsuccess:function(e){if(i)i(e)},onfail:function(){if(o)o()},uploadKey:n,param:{}})}else if(t.nodeName){var c="upload_iframe"+parseInt(1e4*Math.random(),10),d='<iframe id="'+c+'" name="'+c+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',l=document.createElement("div");l.innerHTML=d;var u=l.getElementsByTagName("iframe")[0];if(document.body.appendChild(u),t.setAttribute("target",c),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),u.attachEvent)u.attachEvent("onload",r),u.attachEvent("onerror",a);else u.onload=r,u.onerror=a;t.submit()}else if(window.FormData){var f=new FormData;if(t.fileName)f.append(n,t,t.fileName);else f.append(n,t);exports.request(e,{success:i,failure:o,data:f,method:"post"})}},exports.initWs=function(e,t,n){e.init(t,n)},exports.ws=function(e,t,n,i){e.sendMsg(t,n,i)},exports}),define("im-lib/util",[],function(){var exports={},e="0123456789ABCDEF";return exports.uuid=function(){for(var t=[],n=0;n<32;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var i=t.join("").toLowerCase();return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.decodeHTML=function(e){return e=e||"",e.replace("&lt;","<").replace("&gt;",">").replace("&amp;","&").replace("&quot;",'"').replace("&nbsp;"," ")},exports.encodeHTML=function(e){return e=e||"",e.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/&/g,"&amp").replace(/"/g,"&quot").replace(/ /g,"&nbsp")},exports.getText=function(e){var t="";if(3===e.nodeType||4===e.nodeType)t+=exports.decodeHTML(e.nodeValue);else if("IMG"===e.tagName)if(e.getAttribute("data-face-id"))return"["+e.getAttribute("data-face-text")+"]";else return"[\u56fe\u7247]";else if(8!==e.nodeType)for(var n=0;n<e.childNodes.length;n++)t+=exports.getText(e.childNodes[n]);return t},exports.isSupportWs=function(){return"function"==typeof window.WebSocket&&"function"==typeof window.WebSocket.prototype.send}(),exports.padLeft=function(e,t,n){n=n||"0";for(var i=e.toString().length;i<t;)e=n+e,i++;return e},exports.msgid=function(){for(var e=[],t=0;t<5;t++)e[t]=Math.floor(10*Math.random());return(new Date).getTime()+e.join("")},exports.getCookie=function(e,t){var n=e+"=",i="";if(document.cookie.length>0){var o=document.cookie.indexOf(n);if(o>-1){o+=n.length;var r=document.cookie.indexOf(";",o);if(-1===r)r=document.cookie.length;i=t?unescape(document.cookie.substring(o,r)):document.cookie.substring(o,r)}}return i},exports}),define("im-lib/Emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var o=n[e].length;if(o>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var o,r=0;r<i.length;r++)if((o=i[r])===t||o.listener===t){i.splice(r,1);break}return this},t.emit=function(e){var t=this._getEvents(),n=t[e],i=Array.prototype.slice.call(arguments,1);if(n){n=n.slice(0);for(var o=0,r=n.length;o<r;o++)n[o].apply(this,i)}return this},t.listeners=function(e){return this._getEvents()[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t},e}),define("im-lib/userData",[],function(){function e(e){return e.replace(o,"___")}function t(){}function n(){if(!i)try{return i=document.createElement("input"),i.type="hidden",i.addBehavior("#default#userData"),document.body.appendChild(i),!0}catch(e){return i={load:t,save:t,getAttribute:t,setAttribute:t,removeAttribute:t},!1}return!0}var exports={},i=null,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),r=location.hostname+"_bridge_im";return exports.setItem=function(t,o){if(n()){t=e(t);var a=new Date;a.setDate(a.getDate()+365),i.expires=a.toUTCString(),i.load(r),i.setAttribute(t,o),i.save(r)}},exports.getItem=function(t){if(!n())return"";else return t=e(t),i.load(r),i.getAttribute(t)},exports.removeItem=function(){if(n())key=e(key),i.load(r),i.removeAttribute(key),i.save(r)},exports.clear=function(){var e=new Date;e.setDate(e.getDate()-1),i.expires=e.toUTCString()},exports}),define("im-lib/localStorage",["require","./userData"],function(require){var e,exports={};try{e=window.localStorage||require("./userData")}catch(t){e=require("./userData")}return exports.setItem=function(t,n){try{e.setItem(t,n)}catch(e){}},exports.getItem=function(t){return e.getItem(t)},exports.removeItem=function(t){e.removeItem(t)},exports.clear=function(){e.clear()},exports}),define("im-lib/main",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}),define("im-lib",["im-lib/main"],function(e){return e}),define("im-core/main",["require","im-lib","im-lib/Emitter","bull","./bullConfig"],function(require){function e(module,e,t){module.on(e,function(){var n=Array.prototype.slice.call(arguments);n.unshift(t||e),exports.emit.apply(exports,n)})}var t=require("im-lib"),n=require("im-lib/Emitter"),i=require("bull"),exports={};n.mixin(exports);var o=!1,r=[],a=null;return exports.messageHandler=function(e,n){var i=n.adata&&t.json.parse(n.adata)||{},o=i.displayName||i.nickname||e.sinfo.nickname||n.from,r=1e3*n.time;exports.decode(n,function(e){if(1==+e.role||"server"===e.role)e.recognize=n.recognize||{};if(e.about=1===n.aboutMoney?"money":"other",n.menuMessage&&n.menuMessage.headContent)e.menuMessage=n.menuMessage,e.text=n.menuMessage.headContent;else e.menuMessage=!1;if(e.msgId=n.msgid||r,exports.pushReadedMsg(n),"offlineChatFormText"!==n.reason)if(exports.emit("message",e,o,r,n.msgHandlerType||""),1===n.aboutMoney)exports.emit("systemMessage","\u6d89\u53ca\u8d44\u91d1\u4ea4\u6613\u65f6\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01")})},exports.decode=function(e,t){},exports.init=function(e){var t=require("bull"),n=require("./bullConfig");t.init(n),exports.initCore(e),document.addEventListener("visibilitychange",function(){exports.pushReadedMsg()})},exports.getTargetMsg=function(e){if(e){if(r[e-1].seqId)return r[e-1];else return exports.getTargetMsg(e-1)}else return!1},exports.pushReadedMsg=function(e,t,n){if(n&&n.seqId)r.push(n);else if(r.length)n=exports.getTargetMsg(r.length);else return;if("boolean"!=typeof n||n){var o=document.querySelector(".qiao-mobile-lite-mask-show");if(!document.hidden&&o){if(i.get("data.config").getServer().siteObj.userCommonSwitch.isOpenStateOfRead&&n.seqId){var s={content:{waiterMaxMsgId:n.msgid,waiterMaxSeqId:n.seqId,sid:n.sid,eid:String(n.eid),bid:e.bid}};if(a)clearTimeout(a);a=setTimeout(function(){t.hasReadedMsg(s)},1e3)}}}},exports.initCore=function(t,n,i,o,r){i.extend(exports,o),exports.addPlugin(),i.extend(n,r||{}),n.anonym=n.bid?0:1,t.on("message",exports.messageHandler);var a=["error","reconnect","connected","disconnect","offline","csoffline","invitefail","queueing","otherwebimalive","fetchhistorysuccess","fetchhistoryfail","fetchhistoryfinish","visitorblock","autoendtalk","currentIR","showMsgRemind","csonline","transferError","fininshIR","updateNewCSR","visitorTransfer","unknownMsg","aiAssistance","reCallMsg","checkServiceVersion","handleCallAudioEvent"];i.each(a,function(n){e(t,n)})},exports.addPlugin=function(){for(var e=0;e<arguments.length;e++)exports.plugin(arguments[e])},exports.connect=function(e,t,n,i,r){function a(a){if(n.isBlocked())return o={type:i,options:r},exports.emit("visitorblock",{blocktype:n.isBlocked()}),void exports.emit("blocked",{blocktype:n.isBlocked()});if(a.invited)a.status=3;switch(a.status){case 0:case 1:case 2:e.connect(i,r);break;case 3:if(r.invited||a.invited)a.invited=1,a.from=r.from,e.connect(i,a);else a.reason="talk to other",e.disconnect(a,function(n){if(t.usingWs)e.wsPickSucc(n),e.wsPick()}),e.setStopPick(!1),e.pick();break;case 4:e.connect(i,r);break;default:e.connect(i,r)}}if(exports.emit("startconnect"),n.isLogin())a(t);else n.login(a,function(){exports.emit("error",{type:"init"})},function(e){exports.emit("visitorblock",{blocktype:e})})},exports.checkcode=function(e,t){e.checkcode(t,function(){if(o)exports.connect(o.type,o.options),o=!1})},exports.confirm=function(e){e.confirm(function(){if(o)exports.connect(o.type,o.options),o=!1})},exports.auth=function(e,t,n){if(e.isLogin());else e.login(function(){exports.emit("connected")},function(){exports.emit("error",{type:"init"})})},exports.send=function(e,t,n,i){function o(e,t){if(t&&t.extra&&0==+t.extra.riskType&&1==+t.extra.riskResult)exports.emit("checkUpHF",n,t.extra);exports.emit("sendfinish",n),exports.emit("sendsuccess",n)}function r(){exports.emit("sendfail",n)}if(exports.emit("trysendmsg"),!e.isConnected())return exports.emit("sendfail",n),!1;else return exports.emit("sendMobileData",n),t.encode(n,function(t){t.adata=i,e.send(t,o,r)},r),!0},exports.falseFeedback=function(e,t,n,i){function o(){exports.emit("falseFeedbackSuccess",n,i)}function r(){exports.emit("falseFeedbackFail",n,i)}return e.falseFeedback(n,i,o,r),!0},exports.preSend=function(e,t,n){if(!e.isConnected())return!1;e.preSend({mtype:0,content:n.text,isMobileWebIm:n.isMobileWebIm||!1})},exports.recommendUsed=function(e,t,n){if(!e.isConnected())return!1;e.recommendUsed({msgid:n.msgid,used_type:n.used_type,user_id:n.user_id})},exports.disconnect=function(e,t,n,i){if(exports.emit("sessioncut"),!1!==i)e.disconnect();if(!1!==n)t.logout()},exports.plugin=function(e,t){if(t.encoder)e.addEncoder(t.encoder);if(t.decoder)e.addDecoder(t.decoder);if(t.emit)t.emit=function(){var e=Array.prototype.slice.call(arguments);exports.emit.apply(exports,e)}},exports.get=function(e,t){return e.get(t)},exports.getConfig=function(e,t){if(t)return e[t];else return e},exports.getAuth=function(e,t){if(t)return e[t];else return e},exports.isConnected=function(e){return e.isConnected()},exports.sendOfflineMsg=function(e,t,n,i){function o(){exports.emit("sendofflinemsgfinish",n),exports.emit("sendofflinemsgsuccess",n)}function r(){exports.emit("sendofflinemsgfail",n)}if(e.isConnected())return exports.emit("sendofflinemsgfail",n),!1;else return t.encode(n,function(t){t.adata=i,e.send(t,o,r)},r),!0},exports.fetchHistory=function(e,t){e.fetchHistory(t)},exports.fetchSessionMessage=function(e){e.fetchSessionMessage()},exports.isBlocked=function(e){return e.isBlocked()},exports.checkVersion=function(e,t,n,i){console.log(e,"config1111");var o={uid:e.tid,funcs:["client_app_voicecom","client_app_call"]};t.checkVersion(o,n,i)},exports}),define("im-core",["im-core/main"],function(e){return e}),define("im-core/plugin/fileTransfer",["require","../main"],function(require){var e=1,exports={};exports.encoder={};var t=exports.encoder;t.fileAccept=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,size:t.size,type:"accept"}}})},t.fileVUpload=function(t,n){n({mtype:e,content:{type:"file",msgInfo:t.msgInfo,data:{status:t.status,bcsName:t.bcsName,name:t.name,size:t.size,type:"vUpload"}}})},t.fileVDownLoad=function(t,n){n({mtype:e,content:{type:"file",data:{status:t.status,bcsName:t.bcsName,name:t.name,type:"vDownLoad"}}})},t.fileVCancelSend=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,type:"vCancelSend"}}})},exports.decoder={};var n=require("../main");return exports.decoder.fileTransfer=function(e,t){e=e||{};var i=e.content||{},o=i.data||{},r=i.msgInfo||{},a={bcsName:o.bcsName,name:o.name},s="";switch(o.type){case"accept":s="fileAccept",a.status=o.status;break;case"sDownLoad":s="fileSDownLoad",a.status=o.status;break;case"sUpLoad":s="fileSUpload",a.size=o.size;break;case"vCancelSend":s="vCancelSend";break;case"vDownLoad":s="vDownLoad",a.status=o.status;break;case"vUpload":s="vUpload"}n.emit(s,a,r,e.msgHandlerType||"")},exports}),define("qiao-im-msdk/plugin/fileTransfer",["im-core/plugin/fileTransfer"],function(e){return e}),define("im-core/const",[],function(){var exports={};return exports.PLATFORM_PC=0,exports.PLATFORM_MOBILE=1,exports.SERVER_TIEXIN=1,exports.SERVER_DUZHAN=2,exports.SERVER_QIAO=3,exports.AUTH_TYPE_LOCAL=0,exports.AUTH_TYPE_QIAO=4,exports.AUTH_TYPE_DUZHAN=5,exports.CHAT_TYPE_USER=0,exports.CHAT_TYPE_GROUP=1,exports.CHAT_TYPE_IR=4,exports.PUSH_TYPE_BYE=2,exports.PUSH_TYPE_CHAT=3,exports.PUSH_TYPE_OFFLINE=4,exports.PUSH_TYPE_FETCH_HISTORY=5,exports.PUSH_TYPE_PRE_SEND=6,exports.PUSH_TYPE_FETCH_SESSION_MESSAGE=7,exports.PUSH_TYPE_MSG_SYNC=9,exports.PUSH_TYPE_RECOMMEND_USED=15,exports.PUSH_TYPE_READED_MSG=16,exports.CHART_START_TYPE="vsturl:u",exports.BLOCK_TYPE={IP_BLOCK:1,BID_BLOCK:2,CONFIRM_BLOCK:3,CODE_BLOCK:4,DIRECT_BLOCK:5},exports}),define("qiao-im-msdk/const",["im-core/const"],function(e){return e}),define("im-core/config",["require","./const"],function(require){var e=require("./const");return{bid:"",siteid:"",eid:"",likeCrm:"1",filterAdvertisement:"1",csrfToken:"",crossDomain:!1,platform:e.PLATFORM_PC,server:e.SERVER_QIAO,authType:e.AUTH_TYPE_QIAO,authToken:"bridge",urlRoot:"/",sid:"-100",tid:"-1",fromType:1,ttype:1,reasons:["vstreq:u","vstsys:u","vstwtr:u","vsturl:u","vstwtr:f","vstreq:f","vstsys:f","vstsys:i"],isPageOnload:!0,isSessionConnected:!1,webSocket:!1,usingWs:!1,wsUrl:"/"}}),define("qiao-im-msdk/config",["im-core/config"],function(e){return e}),define("im-core/plugin/unknownMsg",["require","im-lib","../config","im-core"],function(require){function e(e,t){t({content:{content:{data:e.content,msgInfo:e.msgInfo||{},type:e.msgType||""},type:a},mtype:r})}function t(e,t){e=e||{};var a=e.content||{},c=a.content;if(a.mtype===o||a.mtype===r)try{c=n.json.parse(a.content),c.msgInfo=c.msgInfo||{};var d=e.adata&&n.json.parse(e.adata)||{};c.nickname=d.nickname||s}catch(e){c=a.content}c.role=e.from===i.bid?0:1,require("im-core").emit("unknownMsg",c)}var exports={},n=require("im-lib"),i=require("../config"),o=1,r=4,a="unable message",s="\u5bf9\u65b9";return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder["unable message"]=t,exports}),define("qiao-im-msdk/plugin/unknownMsg",["im-core/plugin/unknownMsg"],function(e){return e}),define("base/pc/lib",["require"],function(require){function e(e,t){var n="",i=e<0,o=Math.abs(e)+"";if(o.length<t)n=new Array(t-o.length+1).join("0");return(i?"-":"")+n+o}var exports={},t=/\{\s*\[(?:native code|function)\]\s*\}/i;return exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.isNative=function(e){return!(!e||!t.test(e))},exports.instanceOf=function(e,t){return e&&e.hasOwnProperty&&e instanceof t},exports.extend=function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&"_belong"!==n)e[n]=t[n];return e},exports.getBid=function(){var e,t=(+new Date).toString(),n=Math.floor(1e5*Math.random()).toString(),i=5-n.length;if(i>0)for(e=0;e<i;e++)n+="0";return t+n},exports.uuid=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},exports.parseTime=function(t,n){function i(e,t){n=n.replace(e,t)}if("string"!=typeof n)return t.toString();var o=t.getFullYear(),r=t.getMonth()+1,a=t.getDate(),s=t.getHours(),c=t.getMinutes(),d=t.getSeconds();return i(/yyyy/g,e(o,4)),i(/yy/g,e(parseInt(o.toString().slice(2),10),2)),i(/MM/g,e(r,2)),i(/M/g,r),i(/dd/g,e(a,2)),i(/d/g,a),i(/HH/g,e(s,2)),i(/H/g,s),i(/hh/g,e(s%12,2)),i(/h/g,s%12),i(/mm/g,e(c,2)),i(/m/g,c),i(/ss/g,e(d,2)),i(/s/g,d),n},exports.trim=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},exports.transferDate=function(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),n=["\u4eca\u5929","\u6628\u5929"],i=864e5,o=new Date,r=parseInt((+o-6e4*o.getTimezoneOffset())/i,10),a=r-parseInt((t-6e4*o.getTimezoneOffset())/i,10);if((a=Math.abs(a))<n.length)return n[a];else return exports.parseTime(new Date(e),"yyyy-MM-dd")},exports.preventDefault=function(e){if(e&&e.preventDefault)e.preventDefault();else window.event.returnValue=!1;return!1},exports}),define("embed/log/main",["require","../../base/pc/lib"],function(require){function e(e){return!s[e]&&(s[e]="uuid_"+r.uuid()),s[e]}function t(){return!s.tabid&&(s.tabid="tabid_"+(new Date).getTime()),s.tabid}function n(e){return(new Date).getTime()-a[e]}function i(e,t){a[e]=t||+new Date}function o(e){var t=1,n=e.match(/(iPad).*OS\s([\d_]+)/),i=!n&&e.match(/(iPhone\sOS)\s([\d_]+)/),o=e.match(/(Android);?[\s\/]+([\d.]+)?/);if(n||i)t=3;else if(o)t=2;return t}var r=require("../../base/pc/lib"),exports={},a={},s={pushTotalMsg:0,pushFailMsg:0,pickMsg:0,pushMsg:0,ifLoopStart:!1},c={};exports.componentIsShow={icon:0,toolbar:0},exports.smartInvite={expGroup:"",text:"",isUse:0,ideaType:-1,query:-1,startObj:{}},exports.smartCommunication={isAutoDirectCom:-1,getIntelWelLan:-1,showIntelWelLan:-1},exports.isInviteOrCom=-1;var d=1,l=0,u=0,f=0,m=0,g=["m2005","m2021"];return exports.init=function(e,t,n){var i=e.getServer(),r=i.siteObj;a.eid=r.eid,a.siteid=r.siteId,a.platform=r.platform,n.bid=t.init(r.siteId,r.bid||n.bid,r.session),a.bid=n.bid,a.logRoot=e.staticDomain,a.startTime=i.startTime,exports.smartInvite.likeCrm=i.configBox.inviteBox.likeCrm,exports.smartInvite.inviteBox=i.configBox.inviteBox;var s=i.configBox;if(0==+s.inviteBox.likeCrm&&1==+o(navigator.userAgent))if(0==+s.isWebim&&1==+s.webimConfig.isOpenAutoDirectCom&&1!=+s.seekIcon.iconType&&1==+i.siteObj.isCsOnline)exports.isInviteOrCom=2;else if(1==+s.inviteBox.autoInvite||1==+s.inviteBox.smartBoxEnable&&0!=+s.inviteBox.smartBoxOpen)exports.isInviteOrCom=1},exports.addLightMsg=function(e){if("sub"==(e.role?"sub":"custom"))s.pickMsg++;else s.pushMsg++,s.pushTotalMsg++},exports.sendFailMsg=function(){s.pushFailMsg++},exports.logQueue=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"queue",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),queueCost:n("m2013")})},exports.logConnect=function(){if(exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"connected",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),transferCost:n("m2013")}),!s.ifLoopStart)exports.logPickMsg(),exports.logPushMsg(),s.ifLoopStart=!0},exports.logTransferFail=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"failed",brgeyemid:"m2007",winType:"webimLight",cost:c.render+n("m2013"),transferCost:n("m2013")})},exports.logOpenWebim=function(){exports.sendLog(t(),{cncttype:"openWebim",uuid:e("openUUID"),brgeyemid:"m2006"})},exports.logClickSeek=function(e,n,i,o){var r={brgeyemid:"m2005",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")};if(exports.smartInvite.isPcSmart&&"accept"===i&&o)if(+exports.smartInvite.smartButtonType){for(var a=!1,s=o.target.className.split(" "),c=0;c<s.length;c++)if("nb-invite-ok-show"===s[c])a=!0;if(a)f+=1,r.smartNthClickBtnInvite=f}else m+=1,r.smartNthClickBgInvite=m;i&&(r.type=i),exports.sendLog(t(),r)},exports.logPickMsg=function(){var e=function(){var e=s.pickMsg;if(s.pickMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2004"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logPushMsg=function(){var e=function(){var e=s.pushMsg;if(s.pushMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2003",isAutoDirectCom:exports.smartCommunication.isAutoDirectCom});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logEndNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2002"})},exports.logStartNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2001"})},exports.logRenderStart=function(){i("m2008",a.startTime),exports.sendLog(t(),{uuid:e("renderUUID"),brgeyemid:"m2008"})},exports.logRenderEnd=function(){c.render=n("m2008"),exports.sendLog(t(),{cncttype:"renderFinish",uuid:e("renderUUID"),brgeyemid:"m2009",cost:c.render,icon:exports.componentIsShow.icon,toolbar:exports.componentIsShow.toolbar})},exports.logEnterStart=function(){i("m2010"),exports.sendLog(t(),{cncttype:"startSite",uuid:e("enterUUID"),brgeyemid:"m2010",isInviteOrCom:exports.isInviteOrCom})},exports.logEnterEnd=function(){exports.sendLog(t(),{cncttype:"finishSite",uuid:e("enterUUID"),brgeyemid:"m2011",cost:n("m2008"),siteCost:n("m2010")})},exports.logStartTransfer=function(){i("m2013")},exports.leaveSite=function(){exports.sendLog(t(),{uuid:e("enterUUID"),brgeyemid:"m2012",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg}),exports.sendLog(t(),{uuid:e("msgFailRate"),brgeyemid:"m2014",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg})},exports.logForceTalk=function(){exports.sendLog(t(),{cncttype:"forceTalk",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickUnread=function(){exports.sendLog(t(),{cncttype:"clickUnread",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickMsgLite=function(){exports.sendLog(t(),{cncttype:"clickMsgLite",uuid:e("openUUID"),brgeyemid:"m2015"})},exports.logClickOnlineConsult=function(){exports.sendLog(t(),{cncttype:"clickOnlineConsult",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickDial=function(){exports.sendLog(t(),{cncttype:"clickDial",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logClickGetConnect=function(){exports.sendLog(t(),{cncttype:"clickGetConnect",uuid:e("openUUID"),brgeyemid:"m2016"})},exports.logMessageAutoShow=function(n){exports.sendLog(t(),{cncttype:"messageAutoShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")})},exports.logMessageClickShow=function(n){exports.sendLog(t(),{cncttype:"messageClickShow",uuid:e("openUUID"),brgeyemid:"m2017",url:document.URL,referrer:document.referrer,bclid:n.get("BCLID")})},exports.logInviteShow=function(n,i){if(1===d){if(0!==exports.smartInvite.likeCrm)d=0;l+=1;var o={cncttype:"inviteShow",uuid:e("openUUID"),brgeyemid:"m2018",isSmart:n,text:exports.smartInvite.text,from:i,nthShowInvite:l};exports.sendLog(t(),o)}},exports.logMsgBubbleShow=function(){exports.sendLog(t(),{cncttype:"msgBubbleShow",uuid:e("openUUID"),brgeyemid:"m2019"})},exports.logClickIcon=function(){exports.sendLog(t(),{cncttype:"clickIcon",uuid:e("openUUID"),brgeyemid:"m2020"})},exports.logClickInvite=function(n){u+=1;var i={cncttype:"clickInvite",uuid:e("openUUID"),brgeyemid:"m2021",from:n,text:exports.smartInvite.text};exports.sendLog(t(),i)},exports.logClickMsgBubble=function(){exports.sendLog(t(),{cncttype:"clickMsgBubble",uuid:e("openUUID"),brgeyemid:"m2023"})},exports.logClickSmartLogo=function(){exports.sendLog(t(),{cncttype:"clickSmartLogo",uuid:e("openUUID"),brgeyemid:"m4001"})},exports.logCloseSmartInvite=function(){exports.sendLog(t(),{cncttype:"closeSmartInvite",uuid:e("openUUID"),brgeyemid:"m4002"})},exports.logStopSmartInvite=function(n){exports.sendLog(t(),{cncttype:"stopSmartInvite",uuid:e("openUUID"),brgeyemid:"m4003",stopSmartInviteType:n})},exports.logAutoDirectCom=function(){exports.smartCommunication.isAutoDirectCom=1,exports.sendLog(t(),{cncttype:"autoDirectCom",uuid:e("openUUID"),brgeyemid:"m4004",getIntelWelLan:exports.smartCommunication.getIntelWelLan})},exports.logShowIntelWelLan=function(){exports.smartCommunication.showIntelWelLan=1,exports.sendLog(t(),{cncttype:"showIntelWelLan",uuid:e("openUUID"),brgeyemid:"m4005",isAutoDirectCom:exports.smartCommunication.isAutoDirectCom})},exports.logStopACOrIW=function(n,i){exports.sendLog(t(),{cncttype:"stopACOrIW",uuid:e("openUUID"),brgeyemid:"m4006",isInviteOrCom:exports.isInviteOrCom,getIntelWelLan:exports.smartCommunication.getIntelWelLan,stopAutoCom:n||-1,stopIntelWel:i||-1})},exports.sendLog=function(e,t,n,i,r){var s=r||{};if(s.t=(new Date).getTime(),s.ip="",s.dtype=o(navigator.userAgent),s.ucid=n.eid||a.eid,s.uid=t.get("to")||n.tid||"",s.siteid=n.siteid||a.siteid,s.tabid=i,s.bid=n.bid||a.bid,s.sessionid=t.get("sid")||n.sid||"",s.originType=0,exports.smartInvite.expGroup)s.siExpGroup=exports.smartInvite.expGroup,s.welcome=exports.smartInvite.text;s.likeCrm=exports.smartInvite.likeCrm,s.ideaType=exports.smartInvite.ideaType,s.query=exports.smartInvite.query;for(var c in exports.smartInvite.startObj)if(exports.smartInvite.startObj.hasOwnProperty(c))if("type"!==c&&"query"!==c)s[c]=exports.smartInvite.startObj[c];if(r&&r.brgeyemid&&-1!==g.indexOf(r.brgeyemid))s.from=n.fromType;e.send(a.logRoot,s)},exports}),define("common/logger",["bull"],function(){var exports={};return exports.log=function(e){try{e=e||{};var t=require("bull"),n=t.get("data.config"),i=t.get("core.config"),o=n.getServer("siteObj"),r=o.webRoot+"report/log.gif";if(!e.pstage||!e.stage||!e.logType)return void console.error("pstage,stage,logType \u4e0d\u80fd\u4e3a\u7a7a");e.loginid=o.eid||"",e.t=e.t||Date.now(),e.s=o.siteId||"",e.v=i.bid||"",e.sid=i.sid||"";var a=e.loginid+"-"+e.pstage+"-"+e.stage+"-"+e.v;if("START"===e.logType)sessionStorage.setItem(a,JSON.stringify(e));else if("END"===e.logType){var s={},c=sessionStorage.getItem(a)||"";if(c)s=JSON.parse(c);if(!s||"START"!==s.logType)return console.log("APM logger START not find. logCacheKey is: ",a),void sessionStorage.removeItem(a);var d=e.t-s.t;if(d<=0||d>=1e4)return console.log("APM logger timeDiff invalid. logCacheKey is: ",a,d),void sessionStorage.removeItem(a);var l=exports.uuid();s.lid=e.lid=l,exports.send(r,s),exports.send(r,e),sessionStorage.removeItem(a)}}catch(e){console.log(e)}},exports.send=function(e,t,n){var i=Date.now(),o=window[i]=new Image,r="";o.onload=o.onerror=o.onabort=function(){if(window[i]=null,"function"==typeof n)n&&n()};for(var a in t)if(""!==t[1]){var s="&"+a+"="+encodeURIComponent(t[a]);r+=s}o.src=e+"?"+r.slice(1)},exports.uuid=function(){for(var e=[],t="0123456789ABCDEF",n=0;n<32;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[12]="4",e[16]=t.substr(3&e[16]|8,1);var i=e.join("");return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.logStatic=function(e){exports.log({pstage:1,stage:2,logType:e.logType||"START",fnName:"logStatic",t:e.t||""})},exports.logVisiterEnter=function(e){exports.log({pstage:1,stage:3,logType:e.logType||"START",fnName:"logVisiterEnter",t:e.t||""})},exports.logVisiterEnterHTJ=function(e){exports.log({pstage:1,stage:5,logType:e.logType||"START",fnName:"logVisiterEnterHTJ",t:e.t||""})},exports.logVisiterEnterAust=function(e){exports.log({pstage:1,stage:6,logType:e.logType||"START",fnName:"logVisiterEnterAust",t:e.t||""})},exports.logVisiterEnterHTJStatic=function(e){exports.log({pstage:1,stage:7,logType:e.logType||"START",fnName:"logVisiterEnterHTJStatic",t:e.t||""})},exports.logVisiterEnterHTJServer=function(e){exports.log({pstage:1,stage:8,logType:e.logType||"START",fnName:"logVisiterEnterHTJServer",t:e.t||""})},exports}),define("lib/logger",["common/logger"],function(e){return e}),define("im-core/net",["require","im-lib","common/logger"],function(require){function e(){}var exports={};require("im-lib").Emitter.mixin(exports);var t=require("common/logger"),n={INITIAL:0,INITIALIZED:1,DISABLED:2},i=n.INITIAL;return exports.canUseWs=function(e,t,o,r,a,s,c){return e.isSupportWs&&t.webSocket&&i!==n.DISABLED},exports.successFactory=function(e,t,n,i,o,r){var a=e;return function(e){try{if(-1!==Object.prototype.toString.call(e).indexOf("String"))e=t.parse(e)}catch(e){return void i()}if(a.set("sn",e.n_sn),!e.status||2===e.status)exports.emit("response",o||e.method,e.body||e),n(e.body||e,e);else{if(void 0===r)r=!0;if(r)exports.emit("auth invalid");i(e)}}},exports.wsCommands=function(e,t,o,r){return{getComCallback:function(e){return{"site/poll":{success:exports.successFactory(o.pickSuccess,o.pickFailure),failure:o.pickFailure},"chat/poll":{success:exports.successFactory(r.wsPickSucc,r.wsPickFail),failure:r.wsPickFail}}},changeStatus:function(t){i=t.status,e.usingWs=i===n.INITIALIZED},getBaseBody:function(n){return{auth:t.get(),e:e.eid,s:e.siteid,v:e.bid}},setAuth:function(n){t.set("key",n.key),e.bid=n.bid},request:function(e){exports.request(e.path,e.options,"downgrade")}}},exports.getJsonp=function(e){function t(e){var t=e.jsonp,i=document.getElementsByTagName("head")[0];e.data.callback=t;var o=n(e.data),r=document.createElement("script");if(i.appendChild(r),window[t]=function(n){i.removeChild(r),clearTimeout(r.timer),window[t]=null,e.success&&e.success(n)},r.src=e.url+"?"+o,e.time)r.timer=setTimeout(function(){window[t]=null,i.removeChild(r),e.error&&e.error({message:"\u8d85\u65f6"})},time)}function n(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push("v="+i()),t.join("&")}function i(){return Math.floor(1e4*Math.random()+500)}e=e||{},e.data=e.data||{},t(e)},exports.wsCallBack=function(e){return exports.wsCommands()[e.type](e.data)},exports.jsonToQuery=function(e,t,n){var i=[];return t.each(n,function(n,o){if(t.isObject(o))o=e.stringify(o);if("number"!=typeof o)o=encodeURIComponent(o);i.push(n+"="+o)}),i.join("&")},exports.request=function(t,o,r,a,s,c,d){var l=t.urlRoot+s;if(c.fullPath&&!0===c.fullPath)l=s;c=c||{},c.data.sign=o.get("sign")||"";var u=c.failure||e,f=c.success||e;if("downgrade"===d)c.success=c.success;else if(!1===c.isneedlogout)c.success=exports.successFactory(f,u,s,!1);else c.success=exports.successFactory(f,u,s);var m=c.data||{};if(exports.emit("request",s,m),m.v=t.bid,m.s=t.siteid,m.e=t.eid,m.isAFF=0==+t.likeCrm?"1":"0",m.filterAdvertisement=""+t.filterAdvertisement,m.dev=t.platform,m.auth=o.get(),"chat/st"===s&&o.get("code_token"))m.code_token=o.get("code_token");if("site/st"===s)m.siteToken=t.siteToken||"";if("site/st"===s||"chat/push"===s||"site/aust"===s)m.AFDto="undefined"!=typeof xaf?xaf.getData().Token:"",m.AFDvw="undefined"!=typeof xaf?xaf.getData().view:"";if(c.data=null,exports.canUseWs(m,s,f,u,d)){if(i===n.INITIAL)r.initWs(t.wsUrl+"?v="+m.v,exports.wsCallBack);r.ws(s,m,c)}else if(t.crossDomain||c.crossDomain){if(l+=l.indexOf("?")>=0?"&":"?",l+=exports.jsonToQuery(m),c.type=m.type,c.key="cb",c.op=m.op,c.l=m.l,2===m.type&&"chat/push"===s&&!f&&!u||3===m.op&&"site/auth"===s&&!f&&!u||1===m.op&&"site/st"===s&&!f&&!u||1===m.op&&"site/aust"===s&&!f&&!u){var g=document.createElement("img");return void(g.src=l)}if("imgCross"===d)r.imgRequest(l);else r.jsonp(l,c)}else{if(c.method=c.method||"POST","POST"===c.method)c.data=a.stringify(m),l=l+"?v="+m.v;else l+=l.indexOf("?")>=0?"&":"?",l+=exports.jsonToQuery(m),l+="&v="+m.v;if(c.setCookie)l=l+"&s="+m.s,l=l+"&t="+c.setCookie;r.request(l,c)}},exports.auth=function(e,t,n,i,o){var r;if(0===e.visitType)r=t?0:1;else r=t?2:3;var a,s={success:i,failure:o,data:{op:r,dev:e.platform,ser:e.server,s_info:n}};if(!t)s.method="GET",a="imgCross";exports.request("site/auth",s,a)},exports.poll=function(e,t,n,i){function o(t){n(t),e.emit("handleCallAudioEvent",t)}var r={success:o,failure:i,data:{l:t?1:0}};exports.request("site/poll",r)},exports.site=function(e,n,i,o,r){var a={success:o,failure:r,data:{op:n?0:1,s_info:i,url:location.href}},s="site/st";if(e.vstProto)a.data.siteToken=e.siteToken,a.data.dev=e.platform,a.data.ser=e.server,a.data.bst=e.startTime||"",s="site/aust";var c;if(!n)a.method="GET",c="imgCross";window.NB_START_REQUEST_BLINK=(new Date).getTime();var d={aid:"5480",timeout:500,biz:{ev:"page_enter",customer:e.eid,bid:e.bid,length:0},complete:function(e){if(t.logVisiterEnterHTJServer({logType:"END"}),t.logVisiterEnterHTJ({logType:"END"}),t.logVisiterEnterAust({logType:"START"}),e)a.data.AFDjt=e.jt||"";exports.request(s,a,c)}};if(n)if(a.data.AFDbiz=d.biz,"undefined"!=typeof xaf)try{return t.logVisiterEnterHTJServer({logType:"START"}),void xaf.report(d)}catch(e){}exports.request(s,a,c)},exports.chat=function(e,t,n){var i={success:t,failure:n,data:e};exports.request("chat/st",i)},exports.pick=function(e,t,n,i){var o={success:n,failure:i,data:{l:1,sid:t||""}};if(e.isPageOnload||!e.isSessionConnected)exports.request("chat/poll",o);else o.data.l=0,setTimeout(function(){exports.request("chat/poll",o)},3e3)},exports.push=function(e,t,n,i){var o={success:n,failure:i,data:t||{}};if(2===t.type)o.method="GET";var r=0;if(t&&t.param&&t.param.content){var a=document.createElement("div");a.innerHTML=t.param.content,r=a.innerText.length,a=null}var s={aid:"5480",biz:{ev:"talk",customer:e.eid,bid:e.bid,length:r},complete:function(e){if(e)o.data.AFDjt=e.jt||"";exports.request("chat/push",o)}};if(3===t.type)if(o.data.AFDbiz=s.biz,"undefined"!=typeof xaf)try{xaf.report(s)}catch(e){exports.request("chat/push",o)}else exports.request("chat/push",o);else exports.request("chat/push",o)},exports.falseFeedback=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("nbcps-web/suggest/addContentSuggest.action",i)},exports.node=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("bookmanage/saveBook.action",i)},exports.validate=function(e,t,n){var i={method:"GET",success:t,failure:n,data:e||{},isneedlogout:!1};exports.request("protection/validate",i)},exports.upload=function(e,t,n,i,o,r){t.upload(e.urlRoot+n,i,"file",o,r)},exports.getUploadUrl=function(e,t,n,i){return i=i||t.uuid(),e.urlRoot+"wupload/"+i+"/"+n.get("sid")},exports.getDownloadUrl=function(e,t,n,i,o){return i=i||t.uuid(),o=o||i,e.urlRoot+"wdownload/"+i+"/"+n.get("sid")+"/"+i+"?response-content-disposition=attachment;filename="+o},exports.getDomain=function(e){e=e||"";var t=/https?:\/\/([^\/]+)/i,n=e.match(t);return null!=n&&n.length>1?n[1]:""},exports.getParam=function(e,t){t=t||"";var n=t.substr(t.indexOf("?")),i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=n.substr(1).match(i);return o&&o.length>2?decodeURIComponent(o[2]):""},exports.getXstFromLink=function(e){var t="";if(!e)return t;var n=exports.getDomain(e);if(!n||n.indexOf("baidu.com")<0)return t;if(!(t=exports.getParam("xst",e))){var i=exports.getParam("reqParam",e)||"";try{i=JSON.parse(i)}catch(e){i={}}if(i.xst)t=i.xst}return t},exports.getXst=function(){var e=exports.getXstFromLink(location.href);if(!e&&exports.getParam("referer",location.href))e=exports.getXstFromLink(exports.getParam("referer",location.href));if(!e&&document.referrer)e=exports.getXstFromLink(document.referrer);return e},exports.log=function(e,t,n){},exports.checkVersion=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("checkVersionFunc.action",i)},exports}),define("qiao-im-msdk/net",["im-core/net"],function(e){return e}),define("im-core/chat",["require","im-lib","embed/log/main","./config","./net"],function(require){function e(e){if(!e&&I.connected)exports.emit("disconnect");if(I.stopPick=!0,I.connected=!1,I.sid="",I.options&&1===I.options.invited)I.options.invited=0}function t(){if(!I.connected)if(I.csonline)if(!I.csonline||I.online)I.connected=!0,exports.emit("connected",{sid:I.sid}),p.each(I.msgPool,function(e){exports.emit("message",e)}),I.msgPool=[]}function n(t,n){var i={type:t};if(n)i.data=n;exports.emit("error",i),e()}function i(e,t){if(!e.pickType)I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.csonline=!0,I.ttype=e.ttype;if(t)y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{}}function o(){O={ifIR:!1,count:0,id:null}}function r(e){var t={},n=e.length-1;return p.each(e,function(i,o){var r=i.content.bcsName;if(2===i.mtype&&"string"==typeof i.content)i.content=JSON.parse(i.content);if("img"===i.content.type&&!t[r]){if(o>=n)return P.push(e[n]),e;p.each(e,function(n,i){if("string"==typeof n.content){var a=document.createElement("div");a.innerHTML=n.content;var s=a.getElementsByTagName("img")[0];if(s&&s.tagName&&"IMG"===s.tagName.toUpperCase()&&s.id===r){var c=e.splice(o,1);e.splice(i,0,c[0]),t[r]=1}}})}}),e}function a(e){var t;if(e&&1===e.status&&"auth invalid"===e.errinfo)n("offline"),t=!0;return t}function s(e){if(_=0,U)U=!1,exports.emit("reconnect");if(exports.isConnected()){var t=I.options.siteid;if(t)m.localStorage.setItem("ACTIVE_"+t,+new Date)}p.each(e,function(e){var t=e.msg.detail?e.msg.detail.length:0,n=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.getElementsByClassName("chat-area-service-translation-content"),i=t.getElementsByClassName("chat-area-service-reply-box"),o=t.getElementsByClassName("chat-area-service-reply-text");if(n.length&&i.length&&o.length)return i[0].removeChild(o[0]),t.innerHTML;else return e};if(e.msg.content){if(""===(e.msg.adata&&JSON.parse(e.msg.adata)["__CONFIDENTIAL-REASON__"])&&1==+y.filterAdvertisement)y.filterAdvertisement="0";e.msg.content=n(e.msg.content)}else if(t>0)for(var i=0;i<t;i++)e.msg.detail[i].content=n(e.msg.detail[i].content);var o=e.type,r=exports.pickHandler[o];if(r)r(e.msg);c(e)})}function c(e){function t(){}function n(t){c(e)}function i(e,t){var n="",i=e<0,o=Math.abs(e)+"";if(o.length<t)n=new Array(t-o.length+1).join("0");return(i?"-":"")+n+o}function o(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),n=["\u4eca\u5929","\u6628\u5929"],i=864e5,o=new Date,a=parseInt((+o-6e4*o.getTimezoneOffset())/i,10),s=a-parseInt((t-6e4*o.getTimezoneOffset())/i,10);if((s=Math.abs(s))<n.length)return n[s];else return r(new Date(e),"yyyy-MM-dd")}function r(e,t){function n(e,n){t=t.replace(e,n)}if("string"!=typeof t)return e.toString();var o=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),s=e.getHours(),c=e.getMinutes(),d=e.getSeconds();return n(/yyyy/g,i(o,4)),n(/yy/g,i(parseInt(o.toString().slice(2),10),2)),n(/MM/g,i(r,2)),n(/M/g,r),n(/dd/g,i(a,2)),n(/d/g,a),n(/HH/g,i(s,2)),n(/H/g,s),n(/hh/g,i(s%12,2)),n(/h/g,s%12),n(/mm/g,i(c,2)),n(/m/g,c),n(/ss/g,i(d,2)),n(/s/g,d),t}var a={transferDate:o,parseTime:r};if(e)if(e.msg&&+e.msg.msgid&&+e.ack){var s={adata:void 0,content:"",mtype:0,msgid:e.msg.msgid,ack:e.ack},d=new Date,l=a.transferDate(d)+" "+a.parseTime(d,"HH:mm:ss");s.name="\u6211",s.timeStr=l,exports.send(s,t,n,10)}}function d(e){if(++_>H&&!U)U=!0,exports.emit("offline")}function l(e){s(e),f()}function u(e){if(d(e),!a(e))setTimeout(function(){f()},3e3)}function f(){if(!I.stopPick)setTimeout(function(){v.pick(I.sid,l,u)},0)}var m=require("im-lib"),g=m.Emitter,p=m.lang,b=require("embed/log/main"),h=1,y=require("./config"),v=require("./net"),w=!0;window.newBlinkNewMsgRecord=[];var T,S="",I={connected:!1,stopPick:!1,csonline:!1,msgPool:[],presend:{sending:!1,content:""}},C={INVITE:18,ACCEPT:20,BYE:28},E={OVER:4,TAKE_OVER:3,TRANSFER:6,RECEIVE:2},x="blocked",k="auto",M={SUCCESS:0,FAILURE:1},L={QUEUEING:2,TALKING:4},N=10,O={ifIR:!1,count:1,id:null},A={CSR:0,GROUP:1,IR:4},B={READY:0,BUSY:1,LEAVE:2,UNLOGIN:3},R={TRANSFER:0,CONVERSATION:1},D={COUNT:0,LIST:1,MSG_SYNC:0,END_TIME:0,PAGE:20,DEFAULT:5,DELAY:2e3},P=[],exports={};g.mixin(exports),v.on("auth invalid",function(){I.stopPick=!0}),exports.pickHandler={},exports.pickHandler[100]=function(e){if(exports.setConfig({tid:e.uid,sid:e.sid}),e.op===C.ACCEPT)if(e.st===M.SUCCESS)D.END_TIME=e.systime||0,I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.csonline=!0,I.online=!0,y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg(),D.MSG_SYNC=e.systime||0;else exports.bye();if(e.op===C.BYE)if(e.st===M.SUCCESS){var t=I.options||{};if("talk to other"===e.reason)I.stopPick=!1,t.invited=0,t.tid=y.tid,t.ttype=1,t.sid="",t.from=5,exports.connect(t.ttype,t,!1)}else exports.emit("invitefail");if(e.op===C.INVITE){if(D.END_TIME=e.systime||0,"queue"===e.reason)return void(w=!1);if(e.ttype===A.IR)O.ifIR=!0,O.id=e.uid,exports.emit("currentIR");if("re_invite"===e.reason&&y.status===L.QUEUEING)return exports.emit("queueing"),void(w=!1);if("re_invite"===e.reason){if(y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.tid=y.tid||"",I.ttype=e.ttype,I.csonline=!0,I.online=!0,y.syncSessionHistory)exports.fetchSessionMessage();return void exports.fetchOfflineMsg()}if(e.st===M.SUCCESS)I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.csonline=!0,I.ttype=e.ttype,y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{};else{var n=m.json.parse(e.adata||"{}");return I.to=n.uid||"-1",I.authType=e.authtype,I.csonline=!1,exports.emit("csoffline"),void exports.fetchOfflineMsg()}exports.fetchOfflineMsg()}},exports.pickHandler[101]=function(t){if(exports.setConfig(t.uid,"tid"),t.msgHandlerType=t.msgHandlerType||"",t.opr===E.OVER)if(t.reason&&-1!==t.reason.indexOf(x))exports.emit("visitorblock",t),e();else if(t.reason&&-1!==t.reason.indexOf(k))exports.emit("autoendtalk",t),e();else n("forceover");else if(t.opr===E.TAKE_OVER)if(i(t,!0),O.ifIR)o(),exports.emit("fininshIR",{type:"invite"});else exports.emit("updateNewCSR",y.sinfo);else if(t.opr===E.TRANSFER)if(i(t,!0),O.ifIR)o(),exports.emit("fininshIR",{type:"online"});else exports.emit("updateNewCSR",y.sinfo);else if(t.opr===E.RECEIVE){var r=t.detail||{};if(r.join_action===R.TRANSFER){var a=!1,s=t.adata&&m.json.parse(t.adata)||{},c=s.transfer||{},d=t.sinfo&&m.json.parse(t.sinfo)||{};if(c.status)a=!0,exports.emit("visitorTransfer",{nickname:d.nickname||""},t.msgHandlerType);i(t,a)}}},exports.pickHandler[103]=function(e){for(var t=window.newBlinkNewMsgRecord,n=0;n<t.length;n++)if(t[n]==e.msgid)return;if(t.push(e.msgid),I.connected){if(exports.emit("message",e),O.ifIR&&e.from===O.id&&O.count)if(++O.count>=5)exports.emit("showMsgRemind",O.count),O.count=0}else I.msgPool.push(e)},exports.pickHandler[104]=function(e){if(y.status=e.status,e.status===L.QUEUEING){if(1==+h&&2==+b.isInviteOrCom)h=2,b.logStopACOrIW(-1,3);I.sid=e.sid,I.queueing=!0,exports.emit("queueing")}if(e.status===L.TALKING)if(I.queueing=!1,I.sid=e.sid,I.online=!0,t(),O.ifIR)if(""!==e.reason)exports.emit("transferError",e)},exports.pickHandler[105]=function(e){if(T)clearTimeout(T),T=null;var t=e.detail||[];if(e.type===D.COUNT){var n=0;if(p.each(t,function(e,t){n+=e.count}),n<D.DEFAULT)n=D.DEFAULT;if(n>D.PAGE)n=D.PAGE;exports.fetchHistory({count:n})}else if(e.type===D.LIST){var i=t.length;if(t[0])D.MSG_SYNC=t[0].systime||D.MSG_SYNC;if(t[i-1])D.END_TIME=t[i-1].systime||D.END_TIME;t=P.concat(t),P=[],t=r(t),p.each(t,function(e,t){e.msgHandlerType="insertBefore",exports.emit("message",e)}),exports.fetchHisFinish(!0,e)}},exports.pickHandler[106]=function(e){I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.csonline=!0,y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg()},exports.pickHandler[107]=function(e){if(e.webmsg){for(var t=window.newBlinkNewMsgRecord,n=0;n<t.length;n++)if(t[n]==e.msgid)return;t.push(e.msgid);var i=m.json.parse(e.webmsg);i.body.reverse(),p.each(i.body,function(e){var t=e.msg;t.msgHandlerType="insertBefore",t.time=parseInt(+t.time/1e3,10);var n=e.msg.content;if(m.lang.isArray(n))p.each(n,function(e){var n=e.pickType;if(n){var i=exports.pickHandler[n];if(e.msgHandlerType="insertBefore",i)i(e)}else t.content=e.content||e,t.mtype=e.mtype||0,exports.emit("message",t)})})}},exports.pickHandler[108]=function(e){if(O.ifIR&&e.status===B.READY)exports.emit("csonline",e,"IR");else if(!I.connected&&e.status===B.READY)exports.emit("csonline",e,"OFFLINE_MSG")},exports.pickHandler[109]=function(e){if(I.connected){var t=m.json.parse(e.content);if(m.lang.isArray(t))exports.emit("aiAssistance",e);else exports.emit("aiAssistance",[])}else exports.emit("aiAssistance",[])},exports.pickHandler[180]=function(e){if(I.connected){var t=m.json.parse(e.content);if(28==+t.type&&1==+t.tag){var n=m.json.parse(t.content),i=n.reCallMsgId+"";if(i&&i.length>0)exports.emit("reCallMsg",i)}}},exports.receiveOfflineMsg=function(e){var t={sid:"",tid:I.tid,type:e.PUSH_TYPE_MSG_SYNC,tid_authtype:y.authType,param:{systime:D.MSG_SYNC}};v.push(t,null,null)},exports.fetchHisFinish=function(e,n){if(n=n||{},e)exports.receiveOfflineMsg(),exports.emit("fetchhistorysuccess");else exports.emit("fetchhistoryfail");exports.emit("fetchhistoryfinish",n),t()},exports.fetchHistory=function(e,t){t=t||{};var n=y.offlineMsgGetType||0,i=n?"":I.sid,o=n?"-1":I.tid,r=n?y.bid:I.to,a={sid:i,tid:o,type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:y.authType,param:{type:1,gettype:n,from:r,max_count:t.count||N,from_authtype:I.authType,endtime:D.END_TIME}};v.push(a,null,exports.fetchHisFinish)},exports.fetchSessionMessage=function(e){var t=I.tid||"",n=t,i="";if(t.indexOf(":")){var o=t.split(":");n=o[0],i=o[1]||""}var r=m.json.stringify({tag:1,type:2,userId:n-0,subId:i-0,bid:y.bid}),a={sid:I.sid,tid:I.tid,type:e.PUSH_TYPE_FETCH_SESSION_MESSAGE,tid_authtype:y.authType,param:{webmsg:r}};v.push(a)},exports.bye=function(e){var t={sid:I.options.sid,tid:I.tid,type:e.PUSH_TYPE_BYE,tid_authtype:y.authType,param:{reason:"bye for invite error"}};v.push(t)};var _=0,U=!1,H=3;return exports.wsPickSucc=function(e){s(e)},exports.wsPickFail=function(e){d(e)},exports.pick=f,exports.connect=function(e,t,i,o,r){o=o||{},I.tid=o.tid||"",I.options=o;var a={op:0,sid:o.sid||"",tid:I.tid,tid_authtype:t.authType,invited:o.invited-0?1:0,rtype:o.route||0,ttype:i,inviterefer:location.href,sp_refer:o.sp_refer||"",reason:t.reasons[o.from]||e.CHART_START_TYPE};if(t.adata&&1!==o.noshowSmartInvite)a.adata=t.adata;v.chat(a,function(e){if(!1!==r)if(I.stopPick=!1,t.usingWs)exports.wsPickSucc(e),exports.wsPick();else f()},function(){n("connect")})},exports.wsPick=function(e){if(f(),e.usingWs)setTimeout(exports.wsPick,3e4)},exports.talking=function(e,n){if(n=n||{},e=e||{},y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},I.sid=e.sid,I.to=n.tid,I.authType=e.authtype,I.csonline=!0,I.online=!0,I.tid=e.tid||"",I.options=n,I.stopPick=!1,y.syncSessionHistory)exports.fetchSessionMessage();t(),f()},exports.queue=function(e,t){t=t||{},e=e||{},y.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},I.sid=e.sid,I.to=e.uid,I.authType=e.authtype,I.csonline=!0,I.tid=e.tid||"",I.options=t,I.stopPick=!1,exports.emit("queueing"),f()},exports.preSend=function(e,t){if(!t.isMobileWebIm)if(!t.content&&!t.end||!0===I.presend.sending||t.content===I.presend.content)return;t.mtype=0,t.to=I.to,t.time=(new Date).getTime(),t.rtype=I.ttype;var n={sid:I.sid||"",tid:I.to,type:e.PUSH_TYPE_PRE_SEND,tid_authtype:I.authType,param:t};v.push(n,function(e){I.presend.sending=!1},function(e){I.presend.sending=!1}),I.presend.sending=!0,I.presend.content=t.content},exports.send=function(e,t,n,i,o){t.from=y.bid,t.to=I.to,t.time=(new Date).getTime(),t.rtype=I.ttype;var r=y.eid+String((new Date).getTime()).substring(4),s={sid:I.sid||"",tid:I.to,type:I.csonline?e.PUSH_TYPE_CHAT:e.PUSH_TYPE_OFFLINE,tid_authtype:I.authType,param:t,logId:r};if(void 0!==t.adata)s.adata=t.adata,delete t.adata;if(o&&10===o)s.type=10,s.msgid=t.msgid,s.ack=t.ack;else exports.preSend({content:"",end:!0});v.push(s,n,function(e){if(a(e),i)i()})},exports.recommendUsed=function(e,t){t.from=y.bid,t.to=I.to,t.time=(new Date).getTime(),t.rtype=I.ttype;var n=y.eid+String((new Date).getTime()).substring(4),i={sid:I.sid||"",tid:I.to,type:e.PUSH_TYPE_RECOMMEND_USED,tid_authtype:I.authType,param:t,logId:n,msgId:t.msgid};v.push(i)},exports.hasReadedMsg=function(e,t){var n=y.eid+String((new Date).getTime()).substring(4),i={sid:I.sid||"",tid:I.to,type:e.PUSH_TYPE_READED_MSG,tid_authtype:I.authType,param:t,logId:n,msgId:t.waiterMaxMsgId};v.push(i)},exports.falseFeedback=function(e,t,n,i,o){S=y.sid;var r=I.to.indexOf(":")>-1?I.to.split(":")[1]:0,a={type:t.type,info:t.text,riskType:t.extra.riskType,riskResult:t.extra.riskResult},s={content:JSON.stringify(a),deviceType:4,contentType:1,bid:y.bid,siteId:y.siteid,chatId:y.sid||S,userId:y.eid,subUserId:r};v.falseFeedback(s,i,o)},exports.disconnect=function(t,n,i){t=t||{};var o=void 0===t.tid_authtype?I.authType:t.tid_authtype;o=o||4,v.push({type:2,sid:t.sid||I.sid,tid:t.tid||I.to||-1,reason:t.reason||"",tid_authtype:o},n,i),e(!0)},exports.isConnected=function(){return I.connected},exports.setConfig=function(e,t,n){if(n)e[n]=t;else e=Object.assign(e,t);exports.emit("checkServiceVersion",e)},exports.get=function(e){return I[e]},exports.setStopPick=function(e){I.stopPick=e},exports.fetchOfflineMsg=function(e){if(y.syncFetchOfflineMsg){var n={sid:"",tid:"-1",type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:y.authType,param:{type:D.COUNT,from:I.to,from_authtype:I.authType}};v.push(n,null,exports.fetchHisFinish),T=setTimeout(function(){t()},D.DELAY)}else t()},exports.checkVersion=function(e,t,n){console.log(e,"\u6821\u9a8c\u5ba2\u670d\u7aef\u529f\u80fd\u70b9\u662f\u5426\u652f\u6301"),v.checkVersion(e,t,n)},exports}),define("qiao-im-msdk/chat",["im-core/chat"],function(e){return e}),define("im-core/plugin/img",["require","im-lib","../chat","../net","im-core/chat","../main"],function(require){function e(e){return e=e.split(u?"\\":"/"),e.pop()}function t(e){return"wupload/"+e+"/"+a.get("sid")}function n(e,t){var n=require("im-core/chat");return t=t||"a.jpg","wdownload/"+e+"/"+n.get("sid")+"/"+t}function i(n,i){var o=(e(n.path),n.bcsName),r=t(o);c[r]={msg:n,done:i};var a='<img id="'+o+'" data-uploaded="1" data-bcsName="'+o+'"/>',u={mtype:0,content:a},f={mtype:l,content:{type:d,bcsName:o}},m=require("../main");s.upload(r,n.form||n.path,function(){i(u),m.emit("imgsendsuccess",{bcsName:o,id:n.mid,status:"success"})},function(){f.content.status=1,i(f),m.emit("imgsendfail",{bcsName:o,id:n.mid,status:"fail"})})}function o(e,t){var i=e.content,o=i.bcsName,r=n(o,"img");t({type:d,bcsName:o,bcsUrl:r,status:i.status})}var r=require("im-lib").Emitter,a=require("../chat"),s=require("../net"),c={},d="img",l=1,u=/ window nt/i.test(navigator.userAgent),exports={};return r.mixin(exports),exports.encoder={},exports.encoder[d]=i,exports.decoder={},exports.decoder[d]=o,exports}),define("qiao-im-msdk/plugin/img",["im-core/plugin/img"],function(e){return e}),define("im-core/plugin/shake",["require","../main"],function(require){function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){require("../main").emit("shake",e.msgHandlerType||""),t()}var exports={},n="shake",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("qiao-im-msdk/plugin/shake",["im-core/plugin/shake"],function(e){return e}),define("im-core/plugin/text",["require","../chat","../config","im-lib","im-core/chat"],function(require){function e(e,t){var n=document.createElement("div");n.innerHTML=e.text||"";for(var i=n.getElementsByTagName("img"),o=i.length;o;o--){var r=i[o-1];if(r.getAttribute("data-bcsName")){var a=document.createElement("img");a.setAttribute("data-bcsName",r.getAttribute("data-bcsName")),a.setAttribute("data-uploaded",r.getAttribute("data-uploaded")),a.id=r.id,r.id="";var c=r.parentNode;c.insertBefore(a,r),c.removeChild(r)}}t({mtype:s,content:n.innerHTML.replace(/\r|\n/gi,"")||""})}function t(e,t){var n=require("im-core/chat");return t=t||"a.jpg",o.urlRoot=o.urlRoot||"",o.urlRoot+"wdownload/"+e+"/"+n.get("sid")+"/"+t}function n(e){var n=document.createElement("div");n.innerHTML=e;for(var i=n.getElementsByTagName("img"),o=0;o<i.length;o++){var r=i[o],a=r.getAttribute("data-bcsName"),s=r.getAttribute("data-bcsUrl");if(a&&!s)s=t(a,a),r.setAttribute("data-bcsUrl",s)}return n.innerHTML}function i(e,t){var i=(require("../chat"),e.adata&&r.json.parse(e.adata)||{}),s=n(e.content),c=e.from===o.bid?0:1;t({confidentialreason:i["__CONFIDENTIAL-REASON__"],type:a,role:c,time:1e3*e.time,text:s||""})}var o=(require("../chat"),require("../config")),r=require("im-lib"),a="text",s=0,exports={};return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder[s]=i,exports}),define("qiao-im-msdk/plugin/text",["im-core/plugin/text"],function(e){return e}),define("im-core/plugin/transfer",[],function(){function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){t()}var exports={},n="transfer",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("qiao-im-msdk/plugin/transfer",["im-core/plugin/transfer"],function(e){return e}),define("im-core/plugin/uploaded",[],function(){function e(e,t){t({mtype:i,content:{type:n,bcsName:e.bcsName,status:0}})}function t(e,t){t()}var exports={},n="img",i=1;return exports.encoder={},exports.encoder.uploaded=e,exports.decoder={},exports.decoder.uploaded=t,exports}),define("qiao-im-msdk/plugin/uploaded",["im-core/plugin/uploaded"],function(e){return e}),define("im-core/plugin/voice",["require","../config","../chat","../net","../main"],function(require){function e(e){return"wupload/"+e+"/"+r.get("sid")}function t(e,t){return t=t||"a.mp3",a.getDownloadUrl(e,t)}function n(n,i){var o=n.bcsName,r=e(o);s[r]={msg:n,done:i};var l={mtype:d,content:{type:c,bcsName:o,duration:n.duration,text:""}},u={mtype:d,content:{type:c,bcsName:o}},f=require("../main");a.upload(r,n.form||n.path,function(){i(l),f.emit("voicesendsuccess",{bcsName:o,fid:o,status:"success",finish:!0,url:t(o)})},function(){u.content.status=1,i(u),f.emit("voicesendfail",{bcsName:o,fid:n.mid,status:"fail",url:t(o)})})}function i(e,n){var i=e.from===o.bid?0:1,r=e.content.bcsName;e.content.type=c,e.content.role=i,e.content.fid=r,e.content.status="loading",e.content.finish=!0,e.content.url=t(r),n(e.content)}var o=require("../config"),r=require("../chat"),a=require("../net"),s={},c="voice",d=2,exports={};return exports.encoder={},exports.encoder[c]=n,exports.decoder={},exports.decoder[c]=i,exports}),define("qiao-im-msdk/plugin/voice",["im-core/plugin/voice"],function(e){return e}),define("im-core/plugin/form",["require","../chat","../config"],function(require){function e(e,t){var n=document.createElement("div");n.innerHTML=e.text||"",t({mtype:"offlineChatFormContent"===e.reason?0:o,reason:e.reason,content:n.innerHTML.replace(/\r/gi,"")||""})}function t(e,t){var o=(require("../chat"),e.content),r=e.from===n.bid?0:1;t({type:i,role:r,time:1e3*e.time,text:o||""})}var n=(require("../chat"),require("../config")),i="form",o=4,exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[o]=t,exports}),define("qiao-im-msdk/plugin/form",["im-core/plugin/form"],function(e){return e}),define("im-core/plugin/location",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.from===n.bid?0:1;e.content.type=i,e.content.role=o,e.content.text=r,t(e.content)}var n=require("../config"),i="location",o=4,r="[\u5730\u7406\u4f4d\u7f6e]",exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("qiao-im-msdk/plugin/location",["im-core/plugin/location"],function(e){return e}),define("im-core/plugin/config",["require","./fileTransfer","./unknownMsg","./img","./shake","./text","./transfer","./uploaded","./voice","./form","./location"],function(require){return{package:"coreplugin",resource:{fileTransfer:require("./fileTransfer"),unknownMsg:require("./unknownMsg"),img:require("./img"),shake:require("./shake"),text:require("./text"),transfer:require("./transfer"),uploaded:require("./uploaded"),voice:require("./voice"),form:require("./form"),location:require("./location")}}}),define("qiao-im-msdk/plugin/config",["im-core/plugin/config"],function(e){return e}),define("im-lib/websocket/config",[],function(){return{wsUrl:"/",majorVer:"1",minorVer:"0",protocol:"0",reqTimeout:2e4,wsTimeout:3e4}}),define("im-lib/websocket/const",[],function(){return{MSGINITSTATUS:{INITIAL:0,INITIALIZED:1},WSINITSTATUS:{INITIAL:0,INITIALIZING:1,INITIALIZED:2},WSSTATUS:{CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},REQMSGTYPE:{CONTROL:0,BEAT:1,TEXT:2},REQPROTYPE:{BEAT:0,REQUEST:2,ACK:5},REQSTATUS:{UNSENT:0,SENT:1,CONFIRMED:2},RESPPROTYPE:{BEATACK:1,ACK:3,REQUEST:4}}}),define("im-lib/websocket/index",["require","./const"],function(require){function e(e){return g[e.type](e.data)}function t(e){return{seqId:parseInt(e.substr(2,8),10),type:parseInt(e.substr(10,1),10)}}var exports={},n=require("./const"),i=1,o=1,r=n.MSGINITSTATUS.INITIAL,a={},s={},c={},d={},l=null,u=null,f={"site/auth":n.REQMSGTYPE.CONTROL,"site/st":n.REQMSGTYPE.CONTROL,"site/poll":n.REQMSGTYPE.BEAT,"chat/st":n.REQMSGTYPE.CONTROL,"chat/poll":n.REQMSGTYPE.BEAT,"chat/push":n.REQMSGTYPE.TEXT,ack:n.REQMSGTYPE.ACK},m={"site/auth":n.REQPROTYPE.REQUEST,"site/st":n.REQPROTYPE.REQUEST,"site/poll":n.REQPROTYPE.BEAT,"chat/st":n.REQPROTYPE.REQUEST,"chat/poll":n.REQPROTYPE.BEAT,"chat/push":n.REQPROTYPE.REQUEST,ack:n.REQPROTYPE.ACK},g={disabled:function(e){l({type:"changeStatus",data:{status:2}});for(var t in s)if(s.hasOwnProperty(t)){var n=s[t];clearTimeout(n.timeOut);var i=n.data.substr(20);try{i=JSON.parse(i);var o=n.options,r=i.method.substr(1);delete i.method,delete i.header,delete i.msgid,o.data=i,l({type:"request",data:{path:r,options:o}})}catch(e){}}},message:function(e){exports.dealMsg(e)}};return exports.generateHead=function(e,t,n){return t.majorVer+t.minorVer+e.padLeft(n.seqId,8)+n.type+t.protocol+"00001111"},exports.generateCookie=function(e){for(var t=["H_BDCLCKID_SF","BAIDUID","BDSFRCVID","eqid"],n=[],i=0;i<t.length;i++){var o=t[i],r=e.getCookie(o,!1);if(r)n.push(o+"="+r+";")}if(n.length>0)n=n.join(" ");return n},exports.encodeMsg=function(e,t,o,r){var a={};if(a.type=m[t],a.msgType=f[t],a.status=n.REQSTATUS.UNSENT,a.msgid=e.msgid(),a.type===n.REQPROTYPE.ACK)a.seqId=r.seqId;else a.seqId=i++;o.msgid=a.msgid,o.method="/"+t,o.header={cookie:exports.generateCookie(),userAgent:window.navigator.userAgent||""};var s=exports.generateHead(a);return a.data=s+JSON.stringify(o),a.options=r,a},exports.sendMsg=function(e,t,i,o,r){function a(){t.send(c.data),c.timeOut=setTimeout(a,e.reqTimeout)}var c=exports.encodeMsg(i,o,r);if(c.type===n.REQPROTYPE.REQUEST)s[c.seqId]=c,d[c.msgid]=c,a(),c.status=n.REQSTATUS.SENT;else t.send(c.data)},exports.decodeMsg=function(e){var n={},i=t(e.substr(0,20));if(n.seqId=i.seqId,n.type=i.type,n.body=""===e.substr(20)?{}:JSON.parse(e.substr(20)),null===u&&n.body.body){var o=n.body.body[0];l({type:"setAuth",data:{key:o.key,bid:o.msg.v}})}return n},exports.dealMsg=function(e){var t=exports.decodeMsg(e);if(t.type===n.RESPPROTYPE.ACK){var i=s[t.seqId];clearTimeout(i.timeOut),i.status=n.REQSTATUS.CONFIRMED,delete s[t.seqId]}else if(t.type===n.RESPPROTYPE.REQUEST){if(null===u)u=l({type:"getBaseBody",data:{}});if(exports.sendMsg("ack",u,{seqId:t.seqId}),t.seqId===o)do{try{if(d[t.body.msgid]){var i=d[t.body.msgid];i.options.success(t.body),delete d[t.body.msgid]}else a[t.body.method].success(t.body);delete c[o]}catch(e){}finally{o++}}while(t=c[o]);else if(t&&o&&t.seqId>o)c[t.seqId]=t}},exports.init=function(t,i,o,s){if(r===n.MSGINITSTATUS.INITIAL)i.wsUrl=o,l=s,a=l({type:"getComCallback"}),t.init(e),r=n.MSGINITSTATUS.INITIALIZED,l({type:"changeStatus",data:{status:1}})},exports}),define("im-lib/websocket/websocket",["require","./const"],function(require){function e(e){if(a.readyState===r.WSSTATUS.OPEN)d=r.WSINITSTATUS.INITIALIZED,s=3,exports.pushAllMsgs()}function t(e){l({type:"message",data:e.data})}function n(e){}function i(e){if(d=r.WSINITSTATUS.INITIAL,s-- >0)exports.init(l);else l({type:"disabled",data:c})}function o(){a.addEventListener("open",e),a.addEventListener("message",t),a.addEventListener("error",n),a.addEventListener("close",i)}var exports={},r=require("./const"),a=null,s=3,c=[],d=r.WSINITSTATUS.INITIAL,l=null;return exports.pushAllMsgs=function(){for(var e=null;e=c.shift();)a.send(e)},exports.send=function(e){if(d===r.WSINITSTATUS.INITIALIZED)a.send(e);else c.push(e)},exports.close=function(){a.close()},exports.init=function(e,t){if(d===r.WSINITSTATUS.INITIAL)d=r.WSINITSTATUS.INITIALIZING,a=new WebSocket(e.wsUrl),setTimeout(function(){if(d===r.WSINITSTATUS.INITIALIZING)exports.close()},e.wsTimeout),l=t,o()},exports}),define("im-lib/config",["require","./lang","./json","./net","./util","./Emitter","./localStorage","./main","./websocket/config","./websocket/const","./websocket/index","./websocket/websocket"],function(require){return{package:"imLib",resource:{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage"),main:require("./main"),wsConf:require("./websocket/config"),wsConst:require("./websocket/const"),ws:require("./websocket/index"),wssocket:require("./websocket/websocket")},injection:[{id:"imLib.net",method:{initWs:["imLib.ws"],ws:["imLib.ws"]}},{id:"imLib.ws",method:{generateHead:["imLib.util","imLib.wsConf"],generateCookie:["imLib.util"],encodeMsg:["imLib.util"],sendMsg:["imLib.wsConf","imLib.wssocket"],init:["imLib.wssocket","imLib.wsConf"]}},{id:"imLib.wssocket",method:{init:["imLib.wsConf"]}}]}}),define("im-core/auth",["require"],function(require){var e={},exports={};return exports.get=function(t,n){var i={anonym:t.anonym,key:e.key||"",sn:e.sn||"",id:t.bid||"",from:t.authType,token:t.authToken||""};if(n)return i[n]||e[n];else return i},exports.set=function(t,n){e[t]=n},exports}),define("qiao-im-msdk/auth",["im-core/auth"],function(e){return e}),define("im-core/message",["require"],function(require){function e(){}function t(t,n){return t=t||e,n=n||e,function(e){if(!1===e)n();else if(e)t(e)}}var n={},i={},exports={};return exports.encode=function(e,i,o){var r=n[e.type];if(!r)throw e.type+" message not supported";r(e,t(i,o))},exports.decode=function(e,n,o){var r=e.mtype;if(1===r||4===r||2===r)if(e.content&&e.content.type)if("file"===(r=e.content.type))r="fileTransfer";var a=i[r];if(a)a(e,t(n,o));else if(o)o()},exports.addEncoder=function(e,t){e.each(t,function(e,t){n[e]=t})},exports.addDecoder=function(e,t){e.each(t,function(e,t){i[e]=t})},exports}),define("qiao-im-msdk/message",["im-core/message"],function(e){return e}),define("im-core/site",["require"],function(require){var exports={};return exports.init=function(e,t,n){t.extend(e,n||{}),e.anonym=e.bid?0:1},exports.enter=function(e,t,n){if(t=t||function(){},n=n||function(){},e.isLogin())t();else e.login(t,n)},exports.leave=function(e){if(e.isLogin())e.logout()},exports}),define("qiao-im-msdk/site",["im-core/site"],function(e){return e}),define("im-core/user",["require","./net","common/logger"],function(require){function e(){clearTimeout(i),i=null,o=!1}var exports={},t=require("./net"),n=require("common/logger");t.on("auth invalid",function(){e()});var i,o,r={INVITE:1,AUTH:2},a=null,s=!1;exports.heartBeat=function(e){function t(){i=setTimeout(exports.heartBeat,15e3)}e.poll(!1,t,t)},exports.wsHeartBeat=function(e,t){if(t.poll(!1,exports.refresh,exports.refresh),e.usingWs)a=setTimeout(exports.wsHeartBeat,3e4)};var c={};return exports.pickSuccess=function(e,t){e.each(t,function(e){var t=c[e.type+""];if(t)t(e.msg)})},exports.pickFailure=function(){},exports.refresh=function(e,t,n){function i(){t.poll(r,function(t){e.each(t,function(e){var t=c[e.type+""];if(t)if(t(e.msg),window.nbNewWebImSid=e.msg.sid,e.msg.uid)window.nbNewWebImUid=e.msg.uid}),exports.refresh()},function(){setTimeout(exports.refresh,3e3)})}if(o){var r=Boolean(n.isPageOnload);if(r)i();else setTimeout(i,3e3)}},exports.pickHandler1=function(e,t,n,i){if("invite"===i.reason)n.sid=i.sid,n.tid=i.uid,n.fromType=2,n.ttype=0,e.emit("initiative",i);else if("chat"===i.reason)n.sid=i.sid,n.tid=i.uid,n.ttype=i.ttype,n.invited=1,n.sinfo=i.sinfo&&t.parse(i.sinfo)||{},e.emit("forcetalk",i)},exports.pickHandler104=function(e,t,n,i){if(t.status=i.status,e.emit("watchStatus",i),t.usingWs)n.pickHandler[104](i)},c[1]=function(e){exports.pickHandler1(e)},c[104]=function(e){exports.pickHandler104(e)},exports.getInfo=function(e,t){function n(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(t<0||n<0)if(i="+",t=-t,n<0)n=-n;return t+="",n+="","UTC"+i+t+":"+n}var i=window.navigator,o=window.screen;return{lang:i.language||i.systemLanguage,cbit:o.colorDepth,rsl:o.width+"*"+o.height,tz:n(),xst:encodeURIComponent(t.getXst()),referrer:encodeURIComponent(document.referrer),xstlink:encodeURIComponent(location.href)}},exports.enter=function(e,t,i){exports.loadHTJ(function(){try{var o={aid:"5480",app:"universe",ver:"1.0.0.0",timeout:2e3};xaf.init(o),e.site(!0,exports.getInfo(),function(e){if(n.logVisiterEnterAust({logType:"END"}),!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)}catch(n){e.site(!0,exports.getInfo(),function(e){if(!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)}})},exports.loadHTJ=function(e){n.logVisiterEnterHTJ({logType:"START"}),n.logVisiterEnterHTJStatic({logType:"START"});var t=document.createElement("script"),i=e||function(){};if(t.type="text/javascript",t.setAttribute("data-bdms-faccdee21b68","eyJhcHBfa2V5IjoiNTQ4MCIsImFwcF92aWV3IjoicHJvbW90ZSIsImJyb3dzZXJfdXJsIjoiaHR0cHM6Ly9zb2ZpcmUuYmFpZHUuY29tL2RhdGEvdWEvYWIuanNvbiIsImZvcm1fZGVzYyI6IiIsInNlbmRfaW50ZXJ2YWwiOjUwLCJzZW5kX21ldGhvZCI6M30="),t.readyState)t.onreadystatechange=function(){if("loaded"==t.readyState||"complete"==t.readyState)t.onreadystatechange=null,i()};else t.onload=function(){i(),n.logVisiterEnterHTJStatic({logType:"END"})};t.src="https://sofire.bdstatic.com/js/xaf3.js",document.getElementsByTagName("head")[0].appendChild(t)},exports.checkEnterResult=function(e,t,n,i,r){var a=!1;if(!n.length)return a;else return e.each(n,function(n){if(100===n.type){var s=n.msg||{};if(3===s.status&&0===t.visitType){var c=t.tid||"",d=t.sid||"";e.extend(t,s),t.tid=c,t.sid=d}else e.extend(t,s);if(a=!0,o=!0,t.usingWs)exports.wsHeartBeat();else exports.refresh();i(n.msg)}else r()}),a},exports.checkAuthResult=function(e,t,n,i,o,a,c,d){var l=!1;return n.each(o,function(n){if(n.type===r.AUTH){if(l=!0,n=n.msg||{},!n.valid&&(n.blocktype===t.BLOCK_TYPE.IP_BLOCK||n.blocktype===t.BLOCK_TYPE.BID_BLOCK||n.blocktype===t.BLOCK_TYPE.DIRECT_BLOCK))return d&&d(n.blocktype),s=n.blocktype,void e.emit("blocked",{blocktype:n.blocktype});if(!n.valid&&(n.blocktype===t.BLOCK_TYPE.CONFIRM_BLOCK||n.blocktype===t.BLOCK_TYPE.CODE_BLOCK))return s=n.blocktype,i.bid=n.v,void exports.enter(a,c);if(n.valid)i.bid=n.v,exports.enter(a,c);else c()}}),l},exports.parseEnterResult=function(e,t,n,i,a,s,c,d,l){if(s.sign)i.set("sign",s.sign||s[0].sign),window.newBlinkKey=!0;else window.newBlinkKey=!1;if(i.set("key",s.key||s[0].key),s.v||s[0].msg.v)a.bid=s.v||s[0].msg.v;var u=!1;if(!s.length)return u;else return n.each(s,function(t){if(t.type===r.AUTH)return u=!0,t=t.msg||{},l&&l(t.blocktype),isBlock=t.blocktype,void e.emit("blocked",{blocktype:t.blocktype});else if(100===t.type){if(t.v)a.bid=t.v;var i=t.msg||{};if(3===i.status&&0===a.visitType){var s=a.tid||"",f=a.sid||"";n.extend(a,i),a.tid=s,a.sid=f}else n.extend(a,i);if(u=!0,o=!0,a.usingWs)exports.wsHeartBeat();else exports.refresh();window.directConnectKey=!0,window.birdgeIsLogin=!0,c(t.msg)}else d()}),u},exports.getEnterResult=function(e,t,n){e.poll(!0,function(e){if(!exports.checkEnterResult(e,t,n))exports.getEnterResult(t,n);else window.birdgeIsLogin=!0},n)},exports.getAuthResult=function(e,t,n,i,o){t.poll(!0,function(e){if(!exports.checkAuthResult(e,n,i,o))exports.getAuthResult(n,i,o);else window.directConnectKey=!0},i)},exports.isLogin=function(){return!!i||o},exports.login=function(e,t,i,o,r,a){if(!exports.isLogin())if(i.vstProto)exports.loadHTJ(function(){try{var t={aid:"5480",app:"universe",ver:"1.0.0.0"};xaf.init(t),e.site(!0,exports.getInfo(),function(e){n.logVisiterEnterAust({logType:"END"}),exports.parseEnterResult(e,o,r,a),window.nbAustData=e[0]},r)}catch(t){e.site(!0,exports.getInfo(),function(e){exports.parseEnterResult(e,o,r,a)},r)}});else e.auth(!0,exports.getInfo(),function(e){if(e.sign)t.set("sign",e.sign||e[0].sign);if(t.set("key",e.key||e[0].key),i.bid=e.v||e[0].msg.v,!exports.checkAuthResult(e,o,!1,a))exports.getAuthResult(o,r,a)},r);else o()},exports.checkcode=function(e,t,n,i,o,r){var a=function(){e.emit("codeinvalidated")},c=function(t){if(t&&0===t.status)n.set("code_token",t.data.code_token),s=!1,e.emit("codevalidated"),r();else a()};t.validate({from:"chat",code:o,bid:i.bid},c,a)},exports.confirm=function(e,t,n){t.set("code_token","CONFIRM_CLICK"),s=!1,n()},exports.logout=function(t,n){if(e(),t.site(!1),!n.vstProto)t.auth(!1)},exports.extendPickHandler=function(e,t){e.extend(c,t.pickHandler)},exports.isBlocked=function(){return s},exports}),define("qiao-im-msdk/user",["im-core/user"],function(e){return e}),define("im-core/log",["require"],function(require){var exports={};return exports.send=function(){},exports}),define("qiao-im-msdk/log",["im-core/log"],function(e){return e}),define("im-core/bullConfig",["require","./plugin/config","im-lib/config","./main","./auth","./config","./const","./chat","./message","./site","./user","./net","./log"],function(require){return{package:"core",importConfig:[require("./plugin/config"),require("im-lib/config")],resource:{main:require("./main"),auth:require("./auth"),config:require("./config"),consts:require("./const"),chat:require("./chat"),message:require("./message"),site:require("./site"),user:require("./user"),net:require("./net"),log:require("./log")},injection:[{id:"core.main",method:{initCore:["core.chat","core.config","imLib.lang","core.consts"],connect:["core.chat","core.config","core.user"],auth:["core.user"],checkcode:["core.user"],confirm:["core.user"],send:["core.chat","core.message"],falseFeedback:["core.chat","core.message"],addPlugin:["coreplugin.fileTransfer","coreplugin.img","coreplugin.unknownMsg","coreplugin.shake","coreplugin.text","coreplugin.transfer","coreplugin.uploaded","coreplugin.voice","coreplugin.form","coreplugin.location"],preSend:["core.chat","core.message"],recommendUsed:["core.chat","core.message"],pushReadedMsg:["core.config","core.chat"],checkVersion:["core.config","core.chat"],plugin:["core.message"],disconnect:["core.chat","core.user"],messageHandler:["core.config"],get:["core.chat"],getConfig:["core.config"],bindEvent:["core.main","communicate.handler"],isConnected:["core.chat"],sendOfflineMsg:["core.chat","core.message"],fetchHistory:["core.chat"],fetchSessionMessage:["core.chat"],isBlocked:["core.user"],getAuth:["core.auth"]}},{id:"core.auth",method:{get:["core.config"]}},{id:"core.chat",method:{fetchHistory:["core.consts"],connect:["core.consts","core.config"],fetchSessionMessage:["core.consts"],bye:["core.consts"],preSend:["core.consts"],recommendUsed:["core.consts"],hasReadedMsg:["core.consts"],send:["core.consts"],falseFeedback:["core.consts"],fetchOfflineMsg:["core.consts"],receiveOfflineMsg:["core.consts"],wsPick:["core.config"],setConfig:["core.config"]}},{id:"core.message",method:{addEncoder:["imLib.lang"],addDecoder:["imLib.lang"]}},{id:"core.net",method:{jsonToQuery:["imLib.json","imLib.lang"],getUploadUrl:["core.config","imLib.util","core.main"],getDownloadUrl:["core.config","imLib.util","core.main"],request:["core.config","core.auth","imLib.net","imLib.json"],auth:["core.config"],site:["core.config"],push:["core.config"],authOut:["core.user"],upload:["core.config","imLib.net"],initLog:["core.config","data.config"],log:["imLib.net"],pick:["core.config"],canUseWs:["imLib.util","core.config"],wsCommands:["core.config","core.auth","core.user","core.chat"],successFactory:["core.auth","imLib.json"],poll:["core.chat"]}},{id:"core.site",method:{init:["core.config","imLib.lang"],enter:["core.user"],leave:["core.user"]}},{id:"core.user",method:{refresh:["imLib.lang","core.net","core.config"],getInfo:["imLib.lang","core.net"],enter:["core.net"],checkEnterResult:["imLib.lang","core.config"],getAuthResult:["core.main","core.net"],checkcode:["core.main","core.net","core.auth","core.config"],confirm:["core.main","core.auth"],login:["core.net","core.auth","core.config"],logout:["core.net","core.config"],getEnterResult:["core.net"],pickHandler1:["core.main","imLib.json","core.config"],pickHandler104:["core.main","core.config","core.chat"],heartBeat:["core.net"],checkAuthResult:["core.main","core.consts","imLib.lang","core.config"],pickSuccess:["imLib.lang"],wsHeartBeat:["core.config","core.net"],parseEnterResult:["core.main","core.consts","imLib.lang","core.auth","core.config"]}}],aspect:[{id:"core.message",pointCut:["core.main.decode, , decode"]},{id:"core.net",pointCut:["core.log.send, ,log"]}]}}),define("qiao-im-msdk/bullConfig",["im-core/bullConfig"],function(e){return e}),define("im-filter/main",["require","im-core"],function(require){function e(t,n,i){n=n||{};for(var o=t.childNodes,r=0;r<o.length;r++){var a=o[r].tagName;if(!(a in n))if(3===o[r].nodeType)i(o[r]);else e(o[r],n,i);else if("function"==typeof n[a])n[a](o[r])}}function t(t,n){var i=document.createElement("div");i.innerHTML=n;var o="^((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}\\.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+\\.)*([%0-9a-z][%0-9A-Za-z-]{0,61})?[0-9a-z]\\.[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[\u4e00-\u9fa5%A-Z0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$",r=new RegExp(o);return e(i,{A:function(e){e.setAttribute("target","_blank")}},function(e){var n=!1,i=t.encodeHTML(e.data),o=i.replace(r,function(e){if(e.indexOf("@")>0)return e;if(n=!0,/https?\:\/\//.test(e))return'<a href="'+e+'" target="_blank">'+e+"</a>";else return'<a href="http://'+e+'" target="_blank">'+e+"</a>"});if(n){var a=document.createElement("span");a.innerHTML=o;var s=e.parentNode;s.insertBefore(a,e),s.removeChild(e)}}),i.innerHTML}function n(e,t){t=t||function(){};var n=e.getAttribute("data-bcsUrl"),i=e.getAttribute("data-bcsName");if(!n)if(i){var o=require("im-core"),r=o.get("sid");n=d+"/wdownload/"+i+"/"+r+"/"+i}else n=e.src;e.src=s;var c=new Image;c.onload=function(){if(e.setAttribute("data-originwidth",c.width),e.setAttribute("data-originheight",c.height),c.width>a||c.height>a){var i="",o="";if(c.width>c.height)i="width",o="height";else i="height",o="width";e.style[i]=a+"px",e.style[o]=parseInt(a*c[o]/c[i],10)+"px";var r=document.createElement("span");r.className="zoom",r.innerHTML='<div class="zoom-icon"></div>',e.parentNode.insertBefore(r,e),e.style.display="block",r.appendChild(e),e.src=n}else e.src=n;t()},c.src=n}function i(e,t){var i=document.createElement("div");i.innerHTML=e;for(var o=i.getElementsByTagName("img"),r=0;r<o.length;r++){var a=o[r];if(!a.getAttribute("data-face-id")){var l=a.getAttribute("data-bcsName");if(l){var u=a.getAttribute("data-bcsUrl");if(a.src="",!u){var f=require("im-core"),m=f.get("sid");u=d+"/wdownload/"+l+"/"+m+"/"+l,a.setAttribute("data-bcsUrl",u)}var g=a.getAttribute("data-uploaded")-0;if(0===g)a.src=s;else if(1===g)n(a,t);else if(2===g)a.src=c}else n(a,t)}else{var p=a.getAttribute("data-face-text");a.setAttribute("alt",p||"\u8868\u60c5")}}return i.childNodes}function o(e){return e.replace(l,"").replace(u,"")}function r(e){return e.replace(/<img [^>]*src=['"]file:\/\/\/.*['"][^>]*>/,"")}var a=200,s="//aff-im.cdn.bcebos.com/onlineEnv/webim/resource/img/loading.gif",c="//aff-im.cdn.bcebos.com/onlineEnv/webim/resource/img/fail.png",d="//p.qiao.baidu.com/cps",l=/<script.*?>.*?<\/script>/g,u=/ on\w+=(['"]).*\1/g;return{picFilter:i,imgProccessor:n,staticHTMLFilter:o,loadingUrl:s,loadFailUrl:c,anchor:t,localImgFilter:r}}),define("im-filter",["im-filter/main"],function(e){return e}),define("im-filter/config",["require","./main"],function(require){return{package:"imfilter",resource:{main:require("./main")},injection:[{id:"imfilter.main",method:{anchor:["imLib.util"]}}]}}),define("embed/mobilelite/lib/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,n){var i;if(n in e)return e[n];else if(i=n.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(i[1],16));else if(i=n.match(/^#(\d+)$/))return String.fromCharCode(parseInt(i[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var n="function"==typeof t?t:function(e){var n=t[e];return null==n?"":n};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return n(t)})},exports.objectToString=function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)if(e.hasOwnProperty(i))t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},exports}),define("embed/mobilelite/lib/object",["require","./string"],function(require){var e=require("./string"),exports={};exports.extend=function(e,t){for(var n=arguments.length,i=1;i<n;i++)if(t=arguments[i])for(var o in t)if(t.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.extendOwn=function(e,t){for(var n=1,i=arguments.length;n<i;n++)if(t=arguments[n])for(var o in t)if(t.hasOwnProperty(o)&&e.hasOwnProperty(o)&&void 0!==t[o])e[o]=t[o];return e},exports.clone=function(e){for(var t={},n=0,i=arguments.length;n<i;n++)if(e=arguments[n])for(var o in e)if(e.hasOwnProperty(o)&&void 0!==e[o])t[o]=e[o];return t},exports.jsonToQuery=function(t){var n,i,o=[];for(var r in t)if(t.hasOwnProperty(r))if(n=t[r],exports.isArray(n))for(i=n.length;i--;)o.push(r+"="+encodeURIComponent(n[i]));else if(exports.isObject(n))o.push(r+"="+encodeURIComponent(e.objectToString(n)));else o.push(r+"="+encodeURIComponent(n));return o.join("&")};var t=Object.prototype.toString;return exports.isObject=function(e){return"[object Object]"===t.call(e)},exports.isString=function(e){return"[object String]"===t.call(e)},exports.isArray=function(e){return"[object Array]"===t.call(e)},exports.isNumber=function(e){return!!/^[0-9]+$/.test(e)},exports}),define("embed/mobilelite/lib/net/img",["require","../object"],function(require){var e=require("../object"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(n,i,o,r){if("function"==typeof i)r=o,o=i,i=null;(i=i||{}).t=t(),n+=(n.indexOf("?")>-1?"&":"?")+e.jsonToQuery(i);var a=new Image;a.onload=function(){a.onload=null,a.onerror=null,a=null,o&&o()},a.onerror=function(){a.onload=null,a.onerror=null,a=null,r&&r()},a.src=n},exports}),define("embed/mobilelite/lib/net/ajax",["require","../object","./img"],function(require){function e(){}function t(n,i){function o(){if(4===u.readyState){try{var t=u.status}catch(e){return void c("failure")}if(c(t),t>=200&&t<300||304===t||1223===t)c("success");else c("failure");window.setTimeout(function(){if(u.onreadystatechange=e,m)u=null},0)}}function r(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest}function c(e){e="on"+e;var o=v[e],r=t[e];if(o){if(d)clearTimeout(d);if("onsuccess"!==e)o(u);else try{var c=u.responseText;c=new Function("return ("+c+")")(),i.onsuccess(c)}catch(e){return a.request(s,{errMsg:e.message||"",name:e.name||"",fileName:e.fileName||"",url:n,stack:e.stack||""}),i.onfailure(u)}}else if(r){if("onsuccess"===e)return;r(u)}}i=i||{};var d,l,u,f=i.data||"",m=!(!1===i.async),g=i.username||"",p=i.password||"",b=(i.method||"GET").toUpperCase(),h=i.headers||{},y=i.timeout||0,v={};for(l in i)if(i.hasOwnProperty(l))v[l]=i[l];if(0!==n.indexOf("http"))h["X-Requested-With"]="XMLHttpRequest";try{if(u=r(),"GET"===b){if(f)n+=(n.indexOf("?")>=0?"&":"?")+f,f=null;if(i.noCache)n+=(n.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(g)u.open(b,n,m,g,p);else u.open(b,n,m);if(m)u.onreadystatechange=o;if("POST"===b)h["Content-Type"]=h["Content-Type"]||"application/x-www-form-urlencoded",u.setRequestHeader("Content-Type",h["Content-Type"]),delete h["Content-Type"];for(l in h)if(h.hasOwnProperty(l))u.setRequestHeader(l,h[l]);if(c("beforerequest"),y)d=setTimeout(function(){u.onreadystatechange=e,u.abort(),c("timeout")},y);if(u.send(f),!m)o()}catch(e){c("failure")}return u}function n(){return(new Date).getTime().toString(36)}function i(i,a){var s=a.onsuccess||e,c=a.onfailure||e;a.onsuccess=s,a.onfailure=c;var d=a.data||{};if(a.method===r)i+=(i.indexOf("?")>=0?"&":"?")+"_t="+n(),a.data=o(d);else d._t=n(),i+=(i.indexOf("?")>=0?"&":"?")+o(d),a.data=null;return t(i,a)}var o=require("../object").jsonToQuery,r="POST",a=require("./img"),s="http://sc.qiao.baidu.com/front/ajaxError.gif",exports={};return exports.post=function(e,t,n,o){return i(e,{method:r,data:t,onsuccess:n,onfailure:o})},exports.get=function(e,t,n,o){return i(e,{method:"GET",data:t,onsuccess:n,onfailure:o})},exports}),define("embed/mobilelite/lib/net/jsonp",["require","../object","./img"],function(require){"use strict";function e(e,i){var s=r(),c=null,b=i.timeout||null,h=i.callbackKey||f,y=s,v=i.data||{};v.t=(new Date).getTime();var w=i.charset||m,T=function(e){i.onsuccess&&i.onsuccess(e),n(c),o(y)},S=function(){i.onfail&&i.onfail(),n(c),o(y)},I=a({url:e+t(e,v,h,y),charset:w,id:s});if(l[s]=d[s]=function(){try{T.apply(null,arguments)}catch(t){g.request(p,{type:"jsonp",errMsg:t.message||"",name:t.name||"",fileName:t.fileName||"",url:e,stack:t.stack||""}),S.apply(null,arguments)}},u[s]=function(){S.apply(null,arguments)},b)c=setTimeout(function(){c=null,I.abort(),S.call(null)},b);return I.send(),I}function t(e,t,n,i){var o={}.toString.call(t),r="?";if(e.indexOf("?")>-1)r="&";var a=r+n+"="+i;if("[object Object]"===o)a+="&"+s(t);return a}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(d[e])d[e]=b(e),l[e]=null,delete l[e]}function o(e){try{l[e]=null,d[e]=null,delete l[e],delete d[e]}catch(e){}}function r(){return"cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function a(e){var t,n=c.head||c.getElementsByTagName("head")&&c.getElementsByTagName("head")[0]||c.body;return{send:function(){t=c.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(!0===n||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,!0===n)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(u[t.id])u[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=require("../object").jsonToQuery,c=document,d=window,l={},u={},f="callback",m="utf-8",g=require("./img"),p="http://sc.qiao.baidu.com/front/ajaxError.gif",b=function(e){return function(){try{d[e]=null,delete d[e]}catch(e){}}};return{request:e}}),define("embed/mobilelite/lib/ajax",["require","./net/ajax","./net/jsonp","./net/img"],function(require){var e=require("./net/ajax"),t=require("./net/jsonp"),n=require("./net/img"),i=window.location.protocol+"//p.qiao.baidu.com",exports={};return exports.ajax=function(n,o){if("jsonp"===o.type)if(-1!==n.indexOf("/smartBox/")||-1!==n.indexOf("aifanfan.baidu.com/p.gif")||-1!==n.indexOf("aifanfan.baidu.com/s.gif")||-1!==n.indexOf("affselfbuildsite")||-1!==n.indexOf("corpwechatqrcode"))return t.request(n,o);else return t.request(i+n,o);if("post"===o.method)return e.post(n,o.data,o.onsuccess,o.onfail);else return e.get(n,o.data,o.onsuccess,o.onfail)},exports.img=function(e,o){if("jsonp"===o.type)return t.request(i+e,o);n.request(e,o.data,o.onsuccess,o.onfail)},exports}),define("embed/embedChat/pc/chat",["require","exports","../../mobilelite/lib/ajax"],function(require,exports){function e(e,t){var n=window.screen.availWidth,i=window.screen.availHeight;return{left:Math.ceil((n-e)/2),top:Math.ceil((i-t)/2)}}function t(e){}function n(e){var t=e;if(/^http:/.test(e))t=e.replace(/^http/,"https");else if(/^\/\//.test(e))t="https:"+e;return t}function i(e){}function o(e){f=e.sid,window.nbAustData.uid=e.uid,window.nbAustData.invite=1,window.forcetalkReason=e.reason||"",exports.openWebimLight(!0,2)}function r(e){if(window.nbNewWebImSid&&window.nbNewWebImUid)exports.openWebimLight(!1,e);else setTimeout(function(){r(e)},800)}var a=null,s=require("../../mobilelite/lib/ajax"),c=null,d=!0,l=null,u=-1,f=!1,m=!0,g=null,p=null,b=0,h=null,y={};exports.initSystemInvite=function(e){e.sid="-100",e.tid="-1",e.fromType=1,e.ttype=1},exports.refuseSuccess=function(e,t){t.hide([c]),e.fromType=1},exports.sendInviteMessage=function(e,t,n,i,o){var r=i.getServer("configBox").inviteBox;if(r.inviteTxt){new t({main:o.g("nbWebimLightEditor"),styles:{fontSize:"9pt"}}).setContent(r.inviteTxt);var a=o.g("nbwlSendBtn");n.domTrigger(a,"click")}},exports.openWebimLight=function(e,t,n,i,o,r){var a=document.getElementById("nb-frame-chat-box");if("none"===a.style.display){exports.showNbFrameChatBox(a);var s=document.getElementById("nb-frame-box");s&&s.contentWindow&&s.contentWindow.postMessage({target:"chatBox",status:!0},"*");var c=document.querySelector(".nb-webim-light-message-num"),d=document.querySelector(".hidden-message-tip"),l=document.querySelector(".icon-message-tip");if(c)c.style.display="none";if(d)d.style.display="none";if(l)l.style.display="none";b=0}var u=n.getServer("siteObj");if(+n.getServer().configBox.inviteBox.autoChat)exports.clearInvite2Chat(!0);var f=(false||document.getElementById("newBridge")).require;if(u.newWebIm&&u.online){var m=n.getServer("configBox"),g=m.webimConfig,p="";if(p="embed/css/pc/webimlight/skin-"+g.skinIndex+".css",1===g.themeType)p="embed/css/pc/webimlight/skin-0.css";f(["cl!"+p],function(){exports.createFrameChat(n,o,r),exports.bindFrameBtn(),exports.bindAudioBtn(),exports.bindHideBtn(n),exports.dragTitle()})}else{var h=document.getElementById("nb-frame-chat-box");if(h){document.getElementById("newBridge").removeChild(h)}f(["embed/webimlight/main"],function(e){e.init()})}},exports.showNbFrameChatBox=function(e,t){var n=e.getServer("siteObj");t.style.display="block",window.sessionStorage.removeItem("closed-im-chat"+n.siteId)},exports.createFrameChat=function(e,t,n,i){if(!window.birdgeIsLogin)return void(l=setTimeout(function(){exports.createFrameChat(t,n)},500));clearTimeout(l);var o=document.getElementById("nb-frame-chat-box"),r=t.getServer("siteObj"),a=document.getElementById("nb-frame-box");if(a){if(3!==n){if(e.show([o]),e.hasClass(o,"minMessageContainer"))exports.toggle(e);a&&a.contentWindow&&a.contentWindow.postMessage({target:"BackBottom",status:!0},"*")}return exports.bindFrameBtn(),exports.bindHideBtn(t),void exports.dragTitle()}var a=document.createElement("iframe"),s=document.getElementById("nbwlStatusBar"),d=document.getElementById("nb-frame-box-contant");a.id="nb-frame-box";var m=r.webRoot+"chat",g="object"==typeof i?i.innerText:i,b="";if("object"==typeof i)b=i.getAttribute?i.getAttribute("data-key"):"";var h=p||-1,y=+n>=0?n:-1;if(window.nbNewWebImUid&&1===n)u=window.nbNewWebImUid;if(2===n)m+="?austData="+encodeURIComponent(JSON.stringify(window.nbAustData))+"&siteId=",u=window.nbAustData&&window.nbAustData.uid||-1;else m+="?siteId=";if(m=m+r.siteId+"&userId="+r.userId+"&siteToken="+r.siteToken+"&bid="+h+"&ctype=0&fromType="+y+"&tid="+u+(g?"&hotIssue="+encodeURIComponent(g):"")+(b?"&hotIssueid="+encodeURIComponent(b):"")+"&forcetalkReason="+window.forcetalkReason+"&clientBeginTime="+Date.now(),f)m+="&sid="+f;a.src=m;var v=t.getServer("configBox"),w=v.webimConfig;if(w.webimStyle&&!w.webimStyle.isWebimFixed){var T=w.webimStyle.webimBottom,S=w.webimStyle.webimRight;if(T>window.innerHeight-470)T=window.innerHeight-470;if(S>window.innerWidth-360)S=window.innerWidth-360;o.style.right=S+"px",o.style.bottom=T+"px"}if(w.hasOwnProperty("width")&&w.hasOwnProperty("height"))o.style.width=w.width+"px",o.style.height=w.height+"px",d.style.height=w.height-46+"px";else o.style.width="452px",o.style.height="471px",d.style.height="425px";if(w.customerColor&&w.themeType)s.style.backgroundColor=w.customerColor;else if(+v.styleVersion&&!w.themeType){s.style.background=w.customerColor}document.getElementById("nb-frame-box-contant").appendChild(a),setTimeout(function(){if(e.hide([c]),!w.isOpenKeepCom&&(3===n||void 0===n)){if(window.sessionStorage.getItem("mini-im-chat"+r.siteId)){document.getElementById("nb-frame-box-contant").style.display="none",exports.toggle(e)}if(window.sessionStorage.getItem("closed-im-chat"+r.siteId))return}e.show([o])},500)},exports.isShowComp=function(e){var t=e.getServer("configBox").components||{},n=e.getServer("configBox").seekIcon,i=t.comps&&t.comps.length>0,o=0===n.iconType;return i&&o},exports.bindAudioBtn=function(e,t){if(!exports.isShowComp(t)){var n=t.getServer("siteObj"),i=document.querySelector(".nb-webim-light-icon-audio"),o=document.getElementById("audio"),r=window.localStorage.getItem(n.siteId+"-muted");if(document.body.onclick=function(){if(o.muted)o.muted=!1},i.onclick=function(){if(e.hasClass(i,"nb-webim-light-icon-audio-close"))window.localStorage.removeItem(n.siteId+"-muted"),e.removeClass(i,"nb-webim-light-icon-audio-close");else window.localStorage.setItem(n.siteId+"-muted",!0),e.addClass(i,"nb-webim-light-icon-audio-close")},r)e.addClass(i,"nb-webim-light-icon-audio-close")}},exports.bindFrameBtn=function(e,t,n,i){var o=document.getElementById("nbwlToggle"),r=e.g("nb-frame-chat-box");o.addEventListener("click",function(){exports.toggle(e)}),window.onmessage=function(t){var n=t.data||{},o=exports.isShowComp(i);if("chatBox"===n.target&&"openFrameChat"===n.event){var s=i.getServer("siteObj");if("changeTab"===n.type){if(window.sessionStorage.getItem("mini-im-chat"+s.siteId))if(e.hasClass(r,"maxMessageContainer"))exports.toggle(e);return}if("none"===r.style.display){if(o)exports.showNbFrameChatBox(r);var c=e.g("nb-frame-box");c&&c.contentWindow&&c.contentWindow.postMessage({target:"chatBox",status:!0},"*")}}if(o&&e.hasClass(r,"minMessageContainer"))exports.toggle(e);if(!o&&"chatBox"===n.target&&"sendMessage"===n.event){var s=i.getServer("siteObj"),d=i.getServer("configBox").webimConfig.position,l=window.localStorage.getItem(s.siteId+"-muted"),u=document.getElementById("audio");if(!l)u.play();if(i.getServer("configBox").webimConfig.autoPopupMsg)exports.keepOpenmsgWin();else if((!a||a.closed||!a.window)&&(e.hasClass(r,"minMessageContainer")||"none"===r.style.display||""===r.style.display))exports.handlerMessageTip(r,n.msg,d)}if(!o&&"chatBox"===n.target&&"setAudioTrue"===n.event){var u=document.getElementById("audio");if(u.muted)u.muted=!1}}},exports.handlerMessageTip=function(e,t,n){var t=t?JSON.parse(t):"";if(t){var i=t.msgBody.nickName,o=("string"==typeof t.msgBody.msg.content?t.msgBody.msg.content.replace(/<.*?>/g,"").replace(/&nbsp;/g,""):"")||"\u6587\u4ef6";if(["offlineChatForm","onlineFormAuto"].includes(t.msgBody.msg.reason))o="\u7559\u8a00\u8868\u5355";var r=document.querySelector(".nb-webim-light-message-num"),a=document.querySelector(".hidden-message-tip"),s=document.querySelector(".hidden-message-tip-top-name"),c=document.querySelector(".hidden-message-tip-top-num"),d=document.querySelector(".hidden-message-tip-top-close"),l=document.querySelector(".hidden-message-tip-bottom"),u=document.querySelector(".icon-message-tip"),f=window.getComputedStyle(e),m=f.display,g="auto"!==f.bottom?Number(f.bottom.replace(/px/gi,"")):0;if(r.style.display="block",b+=1,r.innerText=b,u.style.display="block",u.innerText=b,a.style.width="280px","right-bottom"===n)a.style.right="20px",a.style.left="auto";else a.style.left="20px",a.style.right="auto";if(a.style.bottom=("block"===m?g+46+20:g)+"px",a.style.top="auto",!a.style.display||"none"===a.style.display)a.style.display="block",s.innerText=i,c.innerText=b,l.innerText=o,exports.bindMsgTipClose(d),clearTimeout(h),h=setTimeout(function(){a.style.display="none"},5e3);else s.innerText=i,c.innerText=b,l.innerText=o;exports.bindMessageTipClick(a)}},exports.bindMessageTipClick=function(e,t){var n=e.g("nb-frame-chat-box");t.addEventListener("click",function(t){if(e.hasClass(n,"minMessageContainer"))exports.toggle(e);if("none"===n.style.display||""===n.style.display)if(exports.showNbFrameChatBox(n),!e.hasClass(n,"minMessageContainer")){var i=n.getBoundingClientRect(),o=Math.min(window.innerHeight,document.documentElement.clientHeight);if(i.bottom>o){var r=o-i.height-10;n.style.top=(r>0?r:0)+"px"}}var a=document.querySelector(".nb-webim-light-message-num"),s=document.querySelector(".hidden-message-tip"),c=document.querySelector(".icon-message-tip");if(a)a.style.display="none";if(s)s.style.display="none";if(c)c.style.display="none";b=0;var d=document.getElementById("nb-frame-box");d&&d.contentWindow&&d.contentWindow.postMessage({target:"BackBottom",status:!0},"*")})},exports.keepOpenmsgWin=function(e){var t=e.g("nb-frame-chat-box");if(e.hasClass(t,"minMessageContainer"))exports.toggle(e);if("none"===t.style.display||""===t.style.display){if(exports.showNbFrameChatBox(t),!e.hasClass(t,"minMessageContainer")){var n=t.getBoundingClientRect(),i=Math.min(window.innerHeight,document.documentElement.clientHeight);if(n.bottom>i){var o=i-n.height-10;t.style.top=(o>0?o:0)+"px"}}var r=e.g("nb-frame-box");r&&r.contentWindow&&r.contentWindow.postMessage({target:"chatBox",status:!0},"*"),r&&r.contentWindow&&r.contentWindow.postMessage({target:"BackBottom",status:!0},"*")}var a=document.querySelector(".nb-webim-light-message-num"),s=document.querySelector(".hidden-message-tip"),c=document.querySelector(".icon-message-tip");if(a)a.style.display="none";if(s)s.style.display="none";if(c)c.style.display="none";b=0},exports.bindMsgTipClose=function(e){var t=document.querySelector(".hidden-message-tip");e.addEventListener("click",function(e){t.style.display="none",h&&clearTimeout(h)})},exports.bindHideBtn=function(e,t){var n=document.getElementById("nb-frame-chat-box"),i=document.getElementById("nbwlClose"),o=t.getServer("siteObj"),r=t.getServer("configBox"),a=r.webimConfig;if(!exports.isShowComp(t)&&!a.isShowCloseBtn)i.style.display="none";i.addEventListener("click",function(){n.style.display="none",window.sessionStorage.setItem("closed-im-chat"+o.siteId,!0);var t=e.g("nb-frame-box");t&&t.contentWindow&&t.contentWindow.postMessage({target:"chatBox",status:!1},"*")})},exports.toggle=function(e,t,n,i){var o=e.getServer("siteObj"),r=e.getServer("configBox"),a=(r.webimConfig,n.g("nb-frame-chat-box")),s=n.g("nb-frame-box"),c=document.getElementById("nbwlToggle"),l=document.querySelector(".nb-webim-light-message-num"),u=document.querySelector(".icon-message-tip"),f=Math.min(window.innerHeight,document.documentElement.clientHeight);if(d){if(d=!1,n.hasClass(a,"minMessageContainer")){window.sessionStorage.removeItem("mini-im-chat"+o.siteId),n.addClass(a,"maxMessageContainer"),n.removeClass(a,"minMessageContainer"),n.removeClass(c,"nb-webim-light-hide");document.getElementById("nb-frame-box-contant").style.display="block";var m=a.getBoundingClientRect();if(m.bottom>f){var g=f-m.height-10;a.style.top=(g>0?g:0)+"px"}if(s&&s.contentWindow&&s.contentWindow.postMessage({target:"chatBox",status:!0},"*"),l)l.style.display="none";if(u)u.style.display="none"}else{if(i)return;window.sessionStorage.setItem("mini-im-chat"+o.siteId,!0);var p=a.getBoundingClientRect().bottom;n.addClass(a,"minMessageContainer"),n.removeClass(a,"maxMessageContainer"),n.addClass(c,"nb-webim-light-hide");var h=a.getBoundingClientRect().height;if(p>0)if(p<=f)a.style.top=p-h-10+"px";else a.style.top=f-h-10+"px";s.contentWindow.postMessage({target:"chatBox",status:!1},"*")}setTimeout(function(){d=!0},800),b=0}},exports.autoOpenWebimLight=function(e,t){var n=e.getServer("siteObj").siteId,i=(e.getServer("configBox"),"webimLightAlive"+n),o=t.localStorage.getItem(i)-0;if(new Date-o<2e3)exports.openWebimLight()},exports.dragTitle=function(){var e=document.getElementById("nb-frame-chat-box"),t=document.getElementById("nbwlStatusBar"),n=document.getElementById("nbwlFuncContainer"),i=document.getElementById("nb-frame-box-mask"),o=document.documentElement.clientWidth,r=Math.min(window.innerHeight,document.documentElement.clientHeight),a=10,s=5,c=0,d=0,l=0,u=0,f=!1,m=!1;n.onmouseenter=function(e){if(!f)m=!0},n.onmouseleave=function(e){m=!1},window.addEventListener("resize",function(){o=document.documentElement.clientWidth,r=Math.min(window.innerHeight,document.documentElement.clientHeight)}),t.onmousedown=function(e){if(c=e.offsetX,d=e.offsetY,!m)f=!0,t.style.cursor="move",document.body.style.userSelect="none",i.style.display="block"},document.addEventListener("mousemove",function(n){if(n.clientY>window.innerHeight||n.clientY<0||n.clientX<0||n.clientX>window.innerWidth)t.style.cursor="",f=!1,document.body.style.userSelect="",i.style.display="none";else{if(!f)return;l=n.clientX-c,u=n.clientY-d;var m=e.getBoundingClientRect();if(m.bottom<=r-a&&u<r-m.height-a)e.style.top=u>0?u+"px":"0px";else{var g=r-m.height-a;e.style.top=(g>0?g:0)+"px"}if(m.right<=o-s&&l<o-m.width-s)e.style.left=l>0?l+"px":"0px";else{var p=o-m.width-s;if(p>0)e.style.left=p+"px"}}}),document.addEventListener("mouseup",function(e){t.style.cursor="",f=!1,document.body.style.userSelect="",i.style.display="none"})},exports.setVisitorFrom=function(e,t,n,i){var o=t.getServer("siteObj");if(e.tid&&"-1"!==e.tid&&!i)o.from=4;else if(0===n)o.from=5;else o.from=6},exports.openWebimWindow=function(t,i,o,r,d,l,u){var f=o.getServer(),m=f.siteObj,g=f.configBox.inviteBox,h={from:0,sid:"-100",tid:l||"-1",ttype:1,siteId:m.siteId,userId:m.userId};if(0!==d){if(h={from:t.fromType,sessionid:t.sid,siteId:m.siteId,tid:t.tid||"-1",userId:m.userId,ttype:t.ttype,messageText:g.inviteTxt},1==+g.smartBoxEnable&&1==+g.smartBoxOpen&&0==+g.likeCrm&&1==+g.autoInvite)r.hide([c]);exports.initSystemInvite()}if(0==+g.likeCrm&&t.adata)h.siteConfig={},h.siteConfig.likeCrm=g.likeCrm,h.siteConfig.adata=t.adata;h.pageId=m.pageId;var v=i.getXst();if(v)h.xst=v;y.reqParam=h;var w=m.webRoot+"chatIndex";w=n(w);var T=810,S=607,I=e(T,S),C="left="+I.left+",top="+I.top+",resizable=1,width="+T+",height="+S,E={type:"jsonp",data:{type:2,time:(new Date).getTime(),logId:window.speedLogId,userId:m.eid,sourceId:"AFFSpeed"}};s.ajax("https://aifanfan.baidu.com/p.gif",E);var g=o.getServer().configBox.inviteBox;if(+g.autoChat)exports.clearInvite2Chat(!0);var x=m.siteToken||"0",k="object"==typeof u?u.innerText:u,M="";if("object"==typeof u)M=u.getAttribute?u.getAttribute("data-key"):"";if(!a&&4!==t.siteStatus||0===t.siteStatus){var L="pcNBBridage"+(new Date).getTime();a=window.open(w+"?siteToken="+x+(k?"&hotIssue="+encodeURIComponent(k):"")+(M?"&hotIssueid="+encodeURIComponent(M):"")+"&speedLogId="+window.speedLogId+"&bid="+p+"&eid="+m.eid+"&"+i.jsonToQuery(y),L,C)}else if(!a||a.closed||!a.window)a=window.open(w+"?siteToken="+x+(k?"&hotIssue="+encodeURIComponent(k):"")+(M?"&hotIssueid="+encodeURIComponent(M):"")+"&speedLogId="+window.speedLogId+"&bid="+p+"&eid="+m.eid+"&"+i.jsonToQuery(y),"pcNBBridage",C);else a.focus();var N=document.querySelector(".nb-webim-light-message-num"),O=document.querySelector(".hidden-message-tip"),A=document.querySelector(".icon-message-tip");if(N)N.style.display="none";if(O)O.style.display="none";if(A)A.style.display="none";b=0},exports.accept=function(e,t,n,i,o,a){var s=n.getServer("siteObj");n.getServer("configBox").inviteBox;if(this.setVisitorFrom(i,o),s.isWebim){if(4!==s.from)i=0;this.openWebimWindow(i,o,a)}else{if(0!==i){if(s.invited=0,4===s.from)s.invited=1,f=window.nbNewWebImSid}else if(0===i)if(e.gid=o||-1,e.invited=0,e.tid="-1",o)e.tid=o,u=o;if(s.newWebIm)if(0!==i&&4===s.from)r(i);else exports.openWebimLight(!1,i,a);else exports.openWebimLight()}},exports.enterSuccess=function(e,t,n,i,o,r,a,s,d,l){d.logVisiterEnter({logType:"END"});var u=o.getServer("siteObj");o.getServer("configBox");if(3===l.status)s.show([c]),i.sid=l.sid,i.tid=l.tid,i.fromType=2,i.ttype=0;else if(4===l.status)s.hide([c]),i.siteStatus=l.status;if(e.emit("circleShowInvite",l),exports.autoOpenWebimLight(),exports.initSystemInvite(),4===l.status)if(u.newWebIm)if(!t.isConnected())exports.openWebimLight();if(i.siteStatus=l.status,-1!=="3".indexOf(l.status))s.show([c]);else{if(s.hide([c]),"iconBox"===u.clcikType&&0!==l.status)return;exports.initSystemInvite()}},exports.builtComunicate=function(e,t,n,r,a,s){var d=e.getServer("siteObj"),l=e.getServer().configBox.inviteBox;n.siteid=d.siteId,n.csrfToken=d.csrfToken,n.eid=d.eid,n.urlRoot=d.webRoot,n.siteToken=d.siteToken,n.crossDomain=!0,n.likeCrm=l.likeCrm,n.vstProto=d.vstProto,n.startTime=d.startTime,n.webSocket=!1,n.wsUrl=d.wsUrl,n.syncSessionHistory=!0,n.visitType=1,p=n.bid,t.init(n),a.init(n),exports.pageOnload(),a.enter(exports.enterSuccess,i),t.on("initiative",exports.initiative),t.on("forcetalk",o),t.on("watchStatus",exports.watchStatus),t.on("csoffline",exports.csoffline),c=s.g("nb_invite_wrap")},exports.initiative=function(e,t,n){if(2===e.fromType)t.show([c]),exports.clearInvite2Chat(!1)},exports.watchStatus=function(e,t,n,i,r,a,s){var d=t.getServer("siteObj");if(c){var l=a.g("nb_invite_smart_wrap");if(4===s.status){if("waiterDirectChat"===s.reason&&!n.isConnected())o(s);else if(!d.isWebim&&!n.isConnected())exports.openWebimLight()}else r.removeItem(i.TALKTYPEPRE+d.siteId);if(e.siteStatus=s.status,-1!=="3".indexOf(s.status)){if(c&&"chat"!==s.reason)a.show([c]);if(l)a.hide([l])}else{if(a.hide([c]),l)a.hide([l]);exports.initSystemInvite()}}},exports.csoffline=function(e){e.showInCenter()},exports.refuse=function(e,n,i){var o=e.getServer("siteObj"),r={v:o.userId,s:o.siteId,dev:"0",type:1,sid:n.sid,tid:n.tid,tid_authtype:4};i.push(r,exports.refuseSuccess,t)},exports.invite2Chat=function(e){var t=e.getServer(),n=t.configBox,i=n.inviteBox,o=i.toChatTime;if(+i.autoChat&&m)clearTimeout(g),g=setTimeout(function(){exports.openWebimLight(!0,3),m=!1},1e3*o)},exports.clearInvite2Chat=function(e){if(clearTimeout(g),e)m=!1},exports.pageOnload=function(e,t,n){if(t.isPageOnload=!1,n.checkLoad())t.isPageOnload=!0;else e.domOn(window,"load",function(){t.isPageOnload=!0})}}),define("embed/webimlight/commonConfig",[],function(){var exports={};return exports.domain="/",exports.staticDomain="//aff-im.cdn.bcebos.com/onlineEnv",exports.picExt="*.jpg *.png *.gif *.jpeg *.bmp",exports.sizeLimit=2e7,exports.LANG={OVER:"\u4f1a\u8bdd\u5df2\u7ed3\u675f",ERROR:"\u5ba2\u670d\u4e0d\u5728\u7ebf",CSOFFLINE:"\u5ba2\u670d\u4e0d\u5728\u7ebf",STARTCONVERSATION:"\u5f00\u59cb\u6c9f\u901a",TRANSFERERROR:"\u8f6c\u63a5\u5931\u8d25",CSONLINETIP:"\u60a8\u5df2\u4e0e\u5ba2\u670d\u5efa\u7acb\u5bf9\u8bdd",FILEUNKNOWN:"\u8be5\u6c9f\u901a\u7a97\u53e3\u4e0d\u652f\u6301\u63a5\u6536\u6587\u4ef6",TITLENOTIFY:"\u60a8\u6709\u65b0\u6d88\u606f",CSINVITETIP:"\u5ba2\u670d\u5df2\u4e0e\u60a8\u5efa\u7acb\u5bf9\u8bdd",VISITORBLOCK:"\u6682\u65f6\u65e0\u5728\u7ebf\u5ba2\u670d\u53ef\u63a5\u5f85\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",AUTOENDTALK:"\u672c\u6b21\u6c9f\u901a\u5df2\u7ed3\u675f\uff0c\u5982\u6709\u95ee\u9898\u6b22\u8fce\u518d\u6b21\u54a8\u8be2\u3002",VISITORTRANSFER:"\u5c06\u7531${nickname}\u7ee7\u7eed\u4e3a\u60a8\u670d\u52a1",IMGERROR:"\u8bf7\u9009\u62e9\u683c\u5f0f\u4e3ajpg\u3001png\u6216gif\uff0c\u4e14\u5927\u5c0f\u4e0d\u8d85\u8fc720M\u7684\u56fe\u7247"},exports.BLOCK_TYPE={IP_BLOCK:1,BID_BLOCK:2,CONFIRM_BLOCK:3,CODE_BLOCK:4,DIRECT_BLOCK:5},exports.CODE_TOKEN_URL="protection/authcode?from=chat&r=",exports.init=function(e){exports.domain=e},exports}),define("embed/webimlight/messagecontainer/main",["require","../../../embed/embedChat/pc/chat","../statusbar/main","../../log/main","../commonConfig"],function(require){function e(){var e;if(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(navigator.userAgent))e=2;else e=1;return e}var t,n,i,o,r=(require("../../../embed/embedChat/pc/chat"),require("../statusbar/main")),exports={},a=require("../../log/main");return exports.imgUploadSuccessNotify=function(e){},exports.imgUploadFailNotify=function(e){},exports.scrollToBottom=function(e){e.scrollToBottom(n)},exports.renderMessage=function(t,i,s,c,d,l,u,f,m,g,p){clearTimeout(o);var b=n;if("img"===f.type)if(0===f.status)return void exports.imgUploadSuccessNotify(f);else if(1===f.status)return void exports.imgUploadFailNotify(f);if("uploaded"!==f.type&&"transfer"!==f.type){g=g?new Date(g):new Date,f.timeStr=c.transferDate(g)+" "+c.parseTime(g,"HH:mm:ss"),f.hfid=f.id+"_1";var h=f.name;if("location"===f.type){var y=t.get("location"),v=l.lngLatToPixel(f.x,f.y,18),w={x:v[0],y:v[1]},T=i.getLocationUrl({x:w.x,y:w.y,name:h,alias:f.alias}),S=i.getLocationImgUrl({x:f.x,y:f.y,width:240,height:110});f.text=i.template(y,{x:f.x,y:f.y,aliasStr:f.alias,url:T,locationImgSrc:S})}if(f.role)f.role=1,f.name=i.filterXSS(m);else{f.role=0;var I=u.getServer("siteObj").session||{};f.name=I.displayName||"\u6211"}var C=t.get("message");if(f.menuMessage&&f.menuMessage.headContent)f.menuMessage.items.forEach(function(e){f.text+='<p data-key="'+e.id+'" class="nb-webim-light-message-content-robot-item" style="color:#467fff; cursor: pointer">'+e.content+"</p>"});f.text=d.anchor(f.text);var E=u.getServer(),x=E.configBox;if(0==+x.inviteBox.likeCrm&&0==+x.isWebim&&1==+x.webimConfig.isOpenAutoDirectCom&&1!=+x.seekIcon.iconType&&1==+E.siteObj.isCsOnline&&1==+x.webimConfig.isShowIntelWelLan&&1==+e()&&"IntelWelLanMsg"===f.confidentialreason)if(void 0!==x.webimConfig.license){x.webimConfig.license=String(x.webimConfig.license);var k=x.webimConfig.license.split("").reverse(),M=k[2];if(1==+M)f.isUseIntelWelLan=1,a.logShowIntelWelLan()}var L=i.template(C,f),N=d.picFilter(L,exports.scrollToBottom),O=N[1],A=u.getServer("configBox").webimConfig;if(1===A.themeType&&O&&0===f.role){var B=s.getElementsByClass("nb-webim-light-message-name",O)[0],R=s.getElementsByClass("nb-webim-light-message-content",O)[0],D=s.getElementsByClass("nb-webim-light-message-arrow",O)[0];s.setStyles(B,{color:A.customerColor}),s.setStyles(R,{backgroundColor:A.customerColor}),s.setStyles(D,{borderBottomColor:A.customerColor})}s["insertBefore"===p?"prependNodes":"appendNodes"](N,b),exports.scrollToBottom();var P=/minMessageContainer/.test(s.g("nbWebImLightContainer").className);if(1==+f.role&&P)r.toggle()}},exports.renderStatusMessage=function(e,t,n,o){i.innerHTML=t.template(e.get("statusmessage"),{text:o})},exports.renderSystemMessage=function(e,t,i,o,r,a){var s=n;r=r||"alert",i["insertBefore"===a?"prependHTML":"appendHTML"](t.template(e.get("systemmessage"),{text:o,type:r}),s),exports.scrollToBottom()},exports.getElByBcsname=function(e){return n.getElementById(e)},exports.render=function(e,o,r){r.appendHTML(o.template(e.get("messagecontainer"),{domain:require("../commonConfig").domain}),t),n=r.g("nbwlMessageContainer"),i=r.g("nbwlStatusMessage")},exports.imgPreview=function(e){var t=document.getElementById("nbwlImgViewer");document.getElementById("nbwlImgViewerInput").value=e,t.submit()},exports.bindEvent=function(e,i){i.domOn(n,"mousewheel",function(e){e=e||window.event;var t=n.scrollTop,o=n.offsetHeight,r=n.scrollHeight,a=e.wheelDelta||e.detail;if(!t&&a>0||a<0&&t+o===r)return i.domPrevent(e),!1}),i.domOn(t,"dblclick",function(t){t=t||window.event;var n=t.target||t.srcElement,i=n.parentNode;if(e.hasClass(i,"zoom")){var o=i.getElementsByTagName("img")[0].src;exports.imgPreview(o)}}),i.domOn(t,"click",function(t){t=t||window.event;var n=t.target||t.srcElement,i=n.parentNode;if(e.hasClass(n,"zoom-icon")){var o=i.getElementsByTagName("img")[0].src;exports.imgPreview(o)}if(e.hasClass(n,"nb-webim-light-message-content-robot-item")){var r=n.innerHTML,a=n.getAttribute("data-key");exports.sendsText(r,a)}if(e.hasClass(n,"nb-webim-light-message-resend")){if(e.hasClass(n,"nb-webim-light-message-resend-sent"))return;var s=n.parentNode.id;if(s)if(e.hasClass(n,"nb-webim-light-message-feedback")){var c=(n.parentNode.parentNode,n.parentNode.parentNode),d=c.children[1].children[1].innerHTML;exports.falseFeedback(s,d)}else if(e.hasClass(n,"nb-webim-light-message-rewrite")){var c=n.parentNode.parentNode,d=c.children[1].children[1].children[0].innerHTML;document.getElementById("nbWebimLightEditor").innerHTML=d,e.addClass(n,"nb-webim-light-message-resend-sent")}else exports.resend(s),e.addClass(n,"nb-webim-light-message-resend-sent")}})},exports.getImagesByBcsName=function(e){for(var t=n.getElementsByTagName("img"),i=[],o=0;o<t.length;o++){if(t[o].getAttribute("data-bcsname")===e)i.push(t[o])}return i},exports.resend=function(e){},exports.falseFeedback=function(e,t){},exports.sendsText=function(e,t,n,i){var o='<div style="font-family:\u5fae\u8f6f\u96c5\u9ed1;font-size:9pt;color:#000000"><p style="font-family: \u5fae\u8f6f\u96c5\u9ed1; font-size: 9pt; color: rgb(0, 0, 0);" data-key="'+i+'">'+n+"</p></div>";if(n){o=t.anchor(o);var r=+new Date;e.send({id:"msg"+r,text:o,type:"text"}),exports.renderMessage({text:o},0,r)}},exports.init=function(e,i,o){t=e.g("nbWebImLightContainer"),n=e.g("nbwlMessageContainer"),i.parse(o),exports.render(),exports.bindEvent()},exports}),define("embed/webimlight/messagecontainer/main.tpl",[],function(){return'\x3c!-- target: messagecontainer --\x3e<ins id="nbwlMessageContainer"><form id="nbwlImgViewer" action="<%domain%>/imageviewer" method="post" target="_blank"><input id="nbwlImgViewerInput" name="imgsrc"></form><ins id="nbwlStatusMessage"><ins class="nb-webim-light-status-message"><ins class="nb-webim-light-status-message-container">\u6b63\u5728\u7b49\u5f85\u5ba2\u670d\u63a5\u8d77</ins></ins></ins></ins>\x3c!-- target: msgTip --\x3e<ins id="msgTip" class="message-tip"><ins class="message-tip-wrapper"><ins class="message-tip-content" id="msgTipContent"><%text%></ins><ins class="message-tip-close"></ins></ins></ins>\x3c!-- target: message --\x3e<ins class="nb-webim-light-message nb-webim-light-message-<%role%>"><% if (+data.isUseIntelWelLan !== 1) { %><ins class="nb-webim-light-message-title"><ins class="nb-webim-light-message-name"><%name%></ins><ins class="nb-webim-light-message-time"><%timeStr%></ins></ins><ins class="nb-webim-light-message-content"><ins class="nb-webim-light-message-arrow"></ins><ins><%text%></ins></ins><% } else { %><ins class="nb-webim-light-message-content"><ins><%text%></ins></ins><% } %><ins id="<%id%>" class="nb-webim-light-message-error" style="display: none;"><ins class="nb-webim-light-message-error-icon"></ins>\u6d88\u606f\u53d1\u9001\u5931\u8d25, <ins class="nb-webim-light-message-resend">\u91cd\u65b0\u53d1\u9001</ins></ins><ins id="<%hfid%>" class="nb-webim-light-message-error" style="display: none; line-height: 18px;"><ins class="nb-webim-light-message-error-icon"></ins>\u53d1\u9001\u5931\u8d25\uff01\u542b\u6709\u654f\u611f\u8bcd\uff0c<br/>\u8bf7 <ins class="nb-webim-light-message-resend nb-webim-light-message-rewrite">\u91cd\u65b0\u7f16\u8f91</ins>\u540e\u518d\u53d1\u9001\u3002<ins class="nb-webim-light-message-resend nb-webim-light-message-feedback">\u8bef\u62a5\u53cd\u9988</ins></ins></ins>\x3c!-- target: systemmessage --\x3e<ins class="nb-webim-light-system-message"><ins class="nb-webim-light-system-message-container"><ins class="nb-webim-light-system-message-type-<%type%>"></ins><%text%></ins></ins>\x3c!-- target: statusmessage --\x3e<ins class="nb-webim-light-status-message"><ins class="nb-webim-light-status-message-container"><%text%></ins></ins>\x3c!-- target: location --\x3e<ins class="nb-webim-light-location"><ins class="nb-webim-light-location-img-content"><a href="<%url%>" target="_blank"><img class="nb-webim-light-location-img" src="<%locationImgSrc%>"></a></ins><a href="<%url%>" target="_blank"><ins class="nb-webim-light-location-content"><%aliasStr%><span class="view-map">\u67e5\u770b\u5730\u56fe</span></ins></a></ins>'}),define("embed/webimlight/messagecontainer/config",["require","im-core/bullConfig","im-filter/config","./main","./main.tpl"],function(require){return{package:"messagecontainer",importConfig:[require("im-core/bullConfig"),require("im-filter/config")],resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"messagecontainer.main",method:{init:["pbase.dom","common.tpl","messagecontainer.tpl"],scrollToBottom:["pbase.dom"],renderMessage:["common.tpl","common.util","pbase.dom","pbase.lib","imfilter.main","common.convert","data.config"],renderStatusMessage:["common.tpl","common.util","pbase.dom"],renderSystemMessage:["common.tpl","common.util","pbase.dom"],bindEvent:["pbase.dom","pbase.events"],render:["common.tpl","common.util","pbase.dom"],sendsText:["core.main","imfilter.main"]}}],aspect:[{id:"messagecontainer.main",pointCut:["layout.main.render, ,init","communicate.main.send, renderMessage","communicate.handler.message, ,renderMessage","communicate.handler.systemMessage, ,renderSystemMessage","communicate.handler.scrollToBottom, ,scrollToBottom","communicate.handler.sendfail, ,scrollToBottom","communicate.handler.changeStatus, ,renderStatusMessage","picture.main.message, ,renderMessage"]}]}}),define("embed/data/config",["require"],function(require){var exports={};return exports.staticDomain="//aff-im.cdn.bcebos.com/onlineEnv",exports.getServer=function(e,t){var n=e.getWrap();return n={configBox:n.config,siteObj:n.siteConfig,startTime:n.startTime},n[t]||n},exports.isAutoInvite=function(){return!!(exports.getServer("configBox").inviteBox.autoInvite-0)},exports}),define("embed/data/bullConfig",["require","./config"],function(require){return{package:"data",resource:{config:require("./config")},injection:[{id:"data.config",method:{getServer:["common.view"]}}]}}),define("embed/webimlight/layout/main",["require","im-core"],function(require){var e,t,exports={};return exports.bindEvent=function(t){t.domOn(e,"click",exports.hasOperation),t.domOn(e,"keydown",exports.hasOperation)},exports.hasOperation=function(){},exports.render=function(t,n,i,o){var r=i.prependHTML(n.template(t.get("layout")))[1],a=o.getServer("configBox").webimConfig;if(1===a.themeType)i.setStyles(r,{borderColor:"#ccc"});if(a.webimStyle&&!a.webimStyle.isWebimFixed){var s=a.webimStyle.webimBottom,c=a.webimStyle.webimRight;if(s>window.innerHeight-470)s=window.innerHeight-470;if(c>window.innerWidth-360)c=window.innerWidth-360;i.setStyles(r,{bottom:s+"px",right:c+"px"})}else if("left-bottom"===a.position)i.setStyles(r,{bottom:"10px",left:"20px"});else i.setStyles(r,{bottom:"10px",right:"20px"});e.appendChild(r)},exports.confirm=function(e,n,i,o){function r(){a.parentNode.removeChild(a)}i.appendHTML(n.template(e.get("blockConfirm")),t);var a=document.getElementById("blockConfirm"),s=require("im-core"),c=a.getElementsByTagName("button")[0];o.domOn(c,"click",function(e){e=e||window.event,r(),s.confirm()})},exports.codetoken=function(e,n,i,o,r,a){function s(){f.parentNode.removeChild(f)}function c(){f.getElementsByTagName("input")[0].value="",f.getElementsByTagName("img")[0].setAttribute("src",u+Math.random().toString().slice(2)+"&bid="+l)}var d=require("im-core"),l=d.getConfig("bid"),u=d.getConfig("urlRoot")+e.CODE_TOKEN_URL;if(!a)o.appendHTML(i.template(n.get("codeToken"),{src:u+Math.random().toString().slice(2)+"&bid="+l}),t);var f=document.getElementById("codeToken");if(1===a)return void s();if(2===a)return void c();else return r.domOn(f.getElementsByTagName("a")[0],"click",function(e){e.preventDefault(),c()}),d.on("codevalidated",function(){exports.codetoken(1)}),d.on("codeinvalidated",function(){exports.codetoken(2)}),void r.domOn(f.getElementsByTagName("button")[0],"click",function(e){e.preventDefault();var t=f.getElementsByTagName("input")[0].value;if(t)d.checkcode(t);else f.getElementsByTagName("input")[0].focus()})},exports.setFix=function(e,n){t=e.g("nbWebImLightContainer"),n.setFixed(t)},exports.init=function(t,n){e=document.getElementById("newBridge"),t.parse(n),exports.render(),exports.setFix(),exports.bindEvent()},exports}),define("embed/webimlight/layout/main.tpl",[],function(){return'\x3c!-- target: layout --\x3e<ins id="nbWebImLightContainer"></ins>\x3c!-- target: codeToken --\x3e<div id="codeToken"><div class="bgMark"></div><div class="codeToken"><h4>\u8f93\u5165\u9a8c\u8bc1\u7801\u540e\uff0c\u5c06\u4e3a\u60a8\u5f00\u542f\u5728\u7ebf\u54a8\u8be2</h4><div class="row"><input type="text"></div><div class="row code">\x3c!-- <img src="http://cas.baidu.com/?action=image&t=1536080144972" alt=""> --\x3e<img src="<%src%>" alt="\u9a8c\u8bc1\u7801"><a href="#">\u5237\u65b0</a></div><div class="row"><button type="submit">\u786e\u5b9a</button></div></div></div>\x3c!-- target: blockConfirm --\x3e<div id="blockConfirm"><div class="bgMark"></div><div class="codeToken"><h4>\u60a8\u786e\u5b9a\u5f00\u59cb\u4e0e\u5ba2\u670d\u6c9f\u901a\u5417\uff1f</h4><div class="row"><button type="submit">\u786e\u5b9a</button></div></div></div>'}),define("embed/webimlight/layout/config",["require","./main","./main.tpl"],function(require){return{package:"layout",resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"layout.main",method:{render:["common.tpl","common.util","pbase.dom","data.config"],confirm:["common.tpl","common.util","pbase.dom","pbase.events"],codetoken:["webimlight.commonConfig","common.tpl","common.util","pbase.dom","pbase.events"],setFix:["pbase.dom","common.fixed"],init:["common.tpl","layout.tpl"],bindEvent:["pbase.events"]}}],aspect:[{id:"layout.main",pointCut:["webimlight.entry.init, ,init"]}]}}),define("im-editor/browser",["require"],function(require){var exports={},e=navigator.userAgent.toLowerCase();return exports.ie=function(){var t=e.match(/(?:msie\s([\w.]+))/),n=e.match(/(?:trident.*rv:([\w.]+))/);if(t&&n&&t[1]&&n[1])return Math.max(1*t[1],1*n[1]);else if(t&&t[1])return 1*t[1];else if(n&&n[1])return 1*n[1];else return 0}(),exports.webkit=e.indexOf(" applewebkit/")>-1,exports}),define("im-editor/selection",["require","im-lib/lang/each"],function(require){function e(e,t){var n=t.focusNode||t.anchorNode||t.parentElement(),i=document.body;do{if(n===e)return!0;else if(n===i)return!1;else n=n.parentNode}while(n)}function t(t,i,r,a){var s=[];if(n(i,function(e){s.push(e.outerHTML)}),!a)a=o.selection.createRange();if(!e(t,a))a.moveToElementText(t),a.collapse(!1),a.select();a.pasteHTML(s.join("")),a.select()}var exports={},n=require("im-lib/lang/each"),i=window,o=document;return exports.setRange=function(e){var t=exports.getRange();if(i.getSelection){t.setStartBefore(e),t.collapse(!0);var n=i.getSelection();return n.removeAllRanges(),void n.addRange(t)}t.select()},exports.getRange=function(){var e=i.getSelection?i.getSelection():o.selection;return e.getRangeAt&&e.getRangeAt(0)?e.getRangeAt(0):e.createRange()},exports.insertNodes=function(e,o,r,a){if(e.focus(),!i.getSelection)t(e,o,r,a);else{var s=i.getSelection();if(!a)a=s.getRangeAt(0);if(a.deleteContents(),o.reverse(),n(o,function(e){a.insertNode(e)}),!r)a=document.createRange(),a.setStartAfter(o[0]),a.collapse(!0),s.removeAllRanges(),s.addRange(a)}},exports}),define("im-editor/plugins/text",[],function(){var exports={};return exports.name="text",exports.insert=function(e,t){e.insertElements(document.createTextNode(t))},exports}),define("im-editor/plugins/html",[],function(){var exports={};return exports.name="html",exports.insert=function(e,t){var n=document.createElement("div");n.innerHTML=t;var i=Array.prototype.slice.call(n.childNodes,0);e.insertElements(i)},exports}),define("im-editor/plugins/face",[],function(){var exports={};return exports.name="face",exports.insert=function(e,t,n){var i=document.createElement("img");i.setAttribute("data-face-id",t),n.faceText&&i.setAttribute("data-face-text",n.faceText),i.style.width="25px",i.style.height="25px",i.src=n.urlPrefix+t+"."+n.extension,e.insertElements(i)},exports}),define("im-editor/plugins/br",[],function(){var exports={};return exports.name="br",exports.insert=function(e){var t=document.createElement("br");if(e.insertElements(t),/ chrome/i.test(navigator.userAgent)){for(t=t.nextSibling;t&&3==t.nodeType&&!t.nodeValue;)t=t.nextSibling;if(!t)e.insertElements(document.createElement("br"))}},exports}),define("im-editor/plugins/img",[],function(){var exports={};return exports.name="img",exports.insert=function(e,t,n){var i=document.createElement("img");i.style.resize="none",i.src=t;for(var o in n)if(n.hasOwnProperty(o))i.setAttribute(o,n[o]);e.insertElements(i)},exports}),define("im-editor/Editor",["require","im-lib/lang/each","im-lib/lang/extend","im-lib/Emitter","./browser","im-filter","./selection","./plugins/text","./plugins/html","./plugins/face","./plugins/br","./plugins/img"],function(require){function e(e,t){e.setAttribute("contentEditable",t?"true":"false")}function t(e){return"true"===e.getAttribute("contentEditable").toString()}function n(t){return e(t,!0),t.innerHTML=v,t}function i(e,t){var n=e.innerHTML,i=document.createElement("div");return i.innerHTML=n.replace(/\r|\n/gi,"").replace(/<p[^>]*><br\/?><\/p>/gi,"<faketag></faketag>").replace(/<br\/?>/gi,"</p><p>").replace(/<p[^>]*>\s*<\/p>/gi,"<p><br/></p>").replace(/<faketag><\/faketag>/gi,"<p><br/></p>").replace(T,""),t.setStyles({},i),i.innerHTML}function o(e,t){e.innerHTML=t}function r(e){var t=[];return f(e,function(e,n){e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),t.push(e+":"+n)}),t.join(";")}function a(e){var t={};return e=e.split(";"),f(e,function(e){if(e){e=e.split(":");var n=e[0],i=e[1];n=n.replace(/-+(.)?/g,function(e,t){return t=t.replace(/^\s+|\s+$/g,""),t?t.toUpperCase():""}),t[n]=i}}),t}function s(e,t){f(t,function(t,n){e.style[t]=n})}function c(e){var t=y.getRange();if(clearTimeout(e._getCursorTimer),e.main===t.commonAncestorContainer.parentNode)e._cursor=t,e._getCursorTimer=setTimeout(function(){c(e)},S)}function d(e,t){try{var n=new FileReader;n.onload=function(n){e.emit("screenshotpaste",{src:n.target.result,blob:t})},n.readAsDataURL(t)}catch(e){}}function l(e){function t(e){if(!e.stopPropagation)e.stopPropagation=function(){this.cancelBubble=!0};if(!e.preventDefault)e.preventDefault=function(){this.returnValue=!1};return e.stop=function(){this.stopPropagation(),this.preventDefault()},e}function n(n){if(n=t(n||window.event),n.ctrlKey)switch(n.keyCode){case 66:var i=e.isBold(),o=i?"normal":"bold";e.setStyles({fontWeight:o}),e.emit("ctrlB",!i),n.stop();break;case 73:var r=e.isItalic(),o=r?"normal":"italic";e.setStyles({fontStyle:o}),e.emit("ctrlI",!r),n.stop();break;case 85:var a=e.isUnderline(),o=a?"none":"underline";e.setStyles({textDecoration:o}),e.emit("ctrlU",!a),n.stop()}if(8===n.keyCode&&e.main.innerHTML===v)n.stop();e.emit("keydown",n)}function i(n){if(n=t(n||window.event),n.clipboardData&&n.clipboardData.getData)if(/Files/.test(n.clipboardData.types)){n.stop();var i=n.clipboardData.items[0].getAsFile();d(e,i)}else{var o=n.clipboardData.getData("text/plain");n.clipboardData.getData("text/html");if(""===o)n.stop();else{var r=b.staticHTMLFilter(o);e.insert("text",r),n.stop()}}else if(window.clipboardData)if(clipboardData.files&&clipboardData.files.length>0){n.stop();var i=clipboardData.files[0];d(e,i)}}function o(t){if(p.webkit)return void(e._cursor=y.getRange());clearTimeout(e._getCursorTimer)}function r(t){var n=e.main;if(e._cursor&&e._cursor.commonAncestorContainer&&e._cursor.commonAncestorContainer.children){if(!e._cursor.commonAncestorContainer.children.length)return;var i=e._cursor.commonAncestorContainer.offsetTop,o=e._cursor.endOffset?e._cursor.endOffset-1:e._cursor.endOffset,r=e._cursor.commonAncestorContainer.childNodes[o],a=r.offsetTop-i<0?0:r.offsetTop-i;n.scrollTo(0,a)}if(!p.webkit)return void(e._cursor=null);c(e)}var a=e.main;if(a.addEventListener)a.addEventListener("keydown",n,!1),a.addEventListener("paste",i,!1),a.addEventListener("blur",o,!1),a.addEventListener("focus",r,!1);else a.attachEvent("onkeydown",n),a.attachEvent("onpaste",i),a.attachEvent("onblur",o),a.attachEvent("onfocus",r);a.ondrop=function(){return!1}}function u(e){g.mixin(this),this.styles={},this.plugins={text:require("./plugins/text"),html:require("./plugins/html"),face:require("./plugins/face"),br:require("./plugins/br"),img:require("./plugins/img")},this.main=n(e.main),l(this),this.setStyles(m(w,e.styles||{})),f(e.plugins||[],function(e){this.plugin(e)},this)}var f=require("im-lib/lang/each"),m=require("im-lib/lang/extend"),g=require("im-lib/Emitter"),p=require("./browser"),b=require("im-filter"),h=p.ie,y=require("./selection"),v=h&&h<11?"<p></p>":"<p><br></p>",w={fontFamily:"\u5b8b\u4f53",fontSize:"14px"},T=new RegExp("(^(<p[^>]*>(<br/?>|\\s*&nbsp;\\s*)*</p>)+)|((<p[^>]*>(<br/?>|\\s*&nbsp;\\s*)*</p>)+$)","ig"),S=300;return u.prototype.setStyles=function(e,t){e=e||{},this.styles=m(this.styles,e);for(var n=t||this.main,i=0;i<n.childNodes.length;i++)if("P"===n.childNodes[i].tagName)s(n.childNodes[i],this.styles);s(this.main,e)},u.prototype.getStyles=function(){return m({},this.styles)},u.prototype.isBold=function(){return"bold"===this.getStyles().fontWeight},u.prototype.isItalic=function(){return"italic"===this.getStyles().fontStyle},u.prototype.isUnderline=function(){return"underline"===this.getStyles().textDecoration},u.prototype.getContent=function(){var e=[i(this.main,this)];if(e[0])e.unshift('<div style="'+r(this.styles)+'">'),e.push("</div>");return e.join("")},u.prototype.setContent=function(e){if(e){var t=document.createDocumentFragment();t.innerHTML=e;var n=t.firstChild||this.main,i=a(n.style.cssText),r=this;f(i,function(e,t){if(r.styles[e]!==t)r.emit("stylechange",e,t,r.styles[e])}),this.setStyles(i),o(this.main,e)}},u.prototype.setText=function(e){if(e)o(this.main,e)},u.prototype.plugin=function(e){this.plugins[e.name]=e},u.prototype.insertElements=function(e,t){if(!(e instanceof Array))e=[e];if(e.length)y.insertNodes(this.main,e,t,this._cursor)},u.prototype.insert=function(e,t,n){var i=this.plugins[e];if(i&&"function"==typeof i.insert)i.insert(this,t,n)},u.prototype.focus=function(){var e=this.main;if(e.focus(),!h){var t=e.getElementsByTagName("p")[0];if(t)y.setRange(t.firstChild||t)}},u.prototype.clear=function(){o(this.main,v),this.setStyles(),this.main.blur(),this.main.focus()},u.prototype.enable=function(){e(this.main,!0)},u.prototype.disable=function(){e(this.main,!1)},u.prototype.isEnabled=function(){return t(this.main)},u}),define("im-editor/main",["require","./Editor"],function(require){var e=require("./Editor");return function(t){return new e(t)}}),define("im-editor",["im-editor/main"],function(e){return e}),define("im-editor/config",["require","./main"],function(require){return{package:"imEditor",resource:{main:require("./main")}}}),define("embed/webimlight/editor/main",[],function(){var e,t,n,exports={},i=!1;return exports.setBold=function(){n.setStyles({fontWeight:"bold"})},exports.changeSendKey=function(e){i=e},exports.clearBold=function(){n.setStyles({fontWeight:"normal"})},exports.setItalic=function(){n.setStyles({fontStyle:"italic"})},exports.clearItalic=function(){n.setStyles({fontStyle:"normal"})},exports.setUnderline=function(){n.setStyles({textDecoration:"underline"})},exports.clearUnderline=function(){n.setStyles({textDecoration:"none"})},exports.setColor=function(e){n.setStyles({color:e||"#000"})},exports.setFamily=function(e){n.setStyles({fontFamily:e})},exports.setSize=function(e){n.setStyles({fontSize:e})},exports.render=function(i,o,r,a){r.appendHTML(o.template(i.get("editor")),e),t=r.g("nbWebimLightEditor"),n=a({main:t,styles:{fontSize:"9pt",fontFamily:"\u5fae\u8f6f\u96c5\u9ed1"}})},exports.setFocus=function(e){t.focus()},exports.getInstance=function(){return n},exports.handleInput=function(e){if(13===e.keyCode)if(e.stop(),i){if(e.ctrlKey)return void exports.sendText();if(!/ mac/i.test(navigator.userAgent))n.insert("br")}else{if(e.ctrlKey){if(!/ mac/i.test(navigator.userAgent))n.insert("br");return}exports.sendText()}},exports.send=function(e){},exports.sendText=function(e,t){var i=n.getContent();if(i&&e.isConnected())i=t.anchor(i),exports.send({id:"msg"+ +new Date,text:i,type:"text"}),n.clear()},exports.pasteUploadSuccess=function(e,n){var i=n.bcsName,o=document.getElementById(i);if(e.contain(o,t))o.setAttribute("data-uploaded",1);else exports.send({type:"uploaded",bcsName:i})},exports.insertFace=function(e,t,i,o){var r=window.location.protocol+e.staticDomain;n.insert("face",t,{urlPrefix:r+"/webim/resource/img/face/",width:19,height:19,faceText:i,extension:o})},exports.pasteShot=function(e,t,i,o){var r=t.uuid();n.insert("img",o.src,{"data-snap":1,"data-uploaded":0,"data-bcsName":r,id:r}),i.upload(e.getUploadUrl(r),o.blob,"file",function(){exports.pasteUploadSuccess({bcsName:r})})},exports.bindEvent=function(){n.on("keydown",exports.handleInput),n.on("screenshotpaste",exports.pasteShot)},exports.init=function(t,n,i){e=t.g("nbWebImLightContainer"),n.parse(i),exports.render(),exports.bindEvent()},exports}),define("embed/webimlight/editor/main.tpl",[],function(){return'\x3c!-- target: editor --\x3e<ins id="nbwlEditor"><ins id="nbWebimLightEditor" class="editor"></ins></ins>'}),define("embed/webimlight/editor/config",["require","im-editor/config","im-lib/config","./main","./main.tpl"],function(require){return{package:"editor",importConfig:[require("im-editor/config"),require("im-lib/config")],resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"editor.main",method:{init:["pbase.dom","common.tpl","editor.tpl"],pasteShot:["core.net","pbase.lib","imLib.net"],sendText:["core.chat","imfilter.main"],insertFace:["webimlight.commonConfig"],pasteUploadSuccess:["pbase.dom"],render:["common.tpl","common.util","pbase.dom","imEditor.main"],setFocus:["pbase.dom"]}}],aspect:[{id:"editor.main",pointCut:["layout.main.render, , init","toolbar.main.sendBtnClick, , sendText","font.main.setBold, , setBold","font.main.clearBold, , clearBold","font.main.setItalic, , setItalic","font.main.clearItalic, , clearItalic","font.main.setUnderline, , setUnderline","font.main.clearUnderline, , clearUnderline","font.main.colorSelected, , setColor","font.main.fontFamilyChange, , setFamily","font.main.fontSizeChange, , setSize","face.main.faceSelected, , insertFace","webimlight.entry.show, , setFocus","toolbar.main.changeSendKey, , changeSendKey"]}]}}),define("embed/webimlight/communicate/main",[],function(){var e,exports={};exports.bindEvent=function(e,t){for(var n in t)if(t.hasOwnProperty(n))e.on(n,t[n])};var t;return exports.alive=function(e,n,i){if(e.setItem("NEWBRIDGE_TALK_TYPE_"+n.siteid,"webimlight_"+i.sid),!t)t=setInterval(function(){e.setItem("webimLightAlive"+n.siteid,+new Date)},1e3)},exports.die=function(){clearInterval(t)},exports.init=function(t,n){var i=document.getElementById("newBridge");e=i.siteConfig,e.ttype=1,exports.bindEvent()},exports.connect=function(t,n,i){if(e.tid=n.tid,e.sp_refer=location.href,t.connect(e.ttype,e),0===n.status||3===n.status)i.emit("webimLightStatus","show")},exports.send=function(e,t){e.send(t)},exports.falseFeedback=function(e,t,n){e.falseFeedback(t,n)},exports.sendUnableMessage=function(e,t,n){e.send({id:"msg"+ +new Date,content:t,msgInfo:n,msgType:"file",type:"unable message"})},exports}),define("embed/webimlight/communicate/synchronizer",[],function(){var e,exports={},t={},n={},i=!1;return exports.broadcast=function(e,n,i){if(n)for(var o=t[n]||[],r=0;r<o.length;r++){var a=o[r];if("function"==typeof a)a(i)}},exports.emit=function(t,i,o){exports.init(),i+=e,n[i]=o+"",t.setItem(i,o)},exports.on=function(i,o,r){if(exports.init(),o+=e,n[o]=null,o)t[o]=t[o]||[],t[o].push(r)},exports.startpoll=function(e){setInterval(function(){for(var t in n)if(n.hasOwnProperty(t)){var i=e.getItem(t);if(i!==n[t])exports.broadcast(t,i),n[t]=i}},100)},exports.init=function(t){if(!i)i=!0,e=t.siteid,exports.startpoll()},exports}),define("embed/webimlight/communicate/handler",["require","../main"],function(require){var exports={},e=1e3;exports.error=function(e,t){if(require("../main").finish(),"forceover"===t.type)exports.systemMessage(e.LANG.OVER);else if(exports.systemMessage(e.LANG.ERROR),"init"===t.type||"connect"===t.type||"offline"===t.type)exports.transferErrorLog()},exports.transferErrorLog=function(){},exports.queueing=function(e){var t=e.getServer("siteObj").queuing;exports.changeStatus(t)},exports.changeStatus=function(e){},exports.systemMessage=function(e){},exports.csoffline=function(e){exports.changeStatus(e.LANG.CSOFFLINE)},exports.visitorblock=function(e,t,n){if(n)if(n.blocktype)if(n.blocktype===e.BLOCK_TYPE.CONFIRM_BLOCK)t.confirm();else if(n.blocktype===e.BLOCK_TYPE.CODE_BLOCK)t.codetoken();else exports.changeStatus(e.LANG.VISITORBLOCK);else exports.systemMessage(e.LANG.VISITORBLOCK);else exports.changeStatus(e.LANG.VISITORBLOCK)},exports.autoendtalk=function(e,t){if(t)exports.systemMessage(e.LANG.AUTOENDTALK),require("../main").finish()},exports.invitefail=function(e){exports.systemMessage(e.LANG.ERROR)};var t=null;exports.connected=function(n,i,o,r,a,s){function c(e){var t={type:"text",text:e,id:"msg"+ +new Date};n.preSend(t)}i.isSessionConnected=!0;var d=r.getInstance(),l="";t=setInterval(function(){var e=d.getContent(),t=document.createElement("div");t.innerHTML=e;var n=a.getText(t);if(n!==l)c(n),l=n},e),exports.changeStatus(s.parseTime(new Date,"yyyy-MM-dd HH:mm:ss")+" "+o.LANG.STARTCONVERSATION)},exports.stopPreSend=function(){clearInterval(t)},exports.fileSUpload=function(e,t,n,i,o){e.renderSystemMessage(t.LANG.FILEUNKNOWN,"info",o)},exports.message=function(e){};var n={};exports.checkUpHF=function(e,t,i){if(t.hfid){var o=e.g(t.hfid);if(o)o.style.display="block",t.extra=i,n[t.hfid]=t}},exports.falseFeedbackFail=function(e,t){exports.toastShow("\u53cd\u9988\u5931\u8d25")},exports.falseFeedbackSuccess=function(e,t){var n=document.getElementById(t.hfid),i=n.children[3];i.innerHTML="\u611f\u8c22\u53cd\u9988",i.className+=" nb-webim-light-message-resend-sent",exports.toastShow("\u53cd\u9988\u6210\u529f")},exports.toastShow=function(e){var t=document.createElement("div");t.id="tip-toast";var n='<div style="margin: 0 auto;padding: 5px 10px;width: 120px;background-color: rgba(0,0,0,.5);color: #fff;border-radius: 3px;text-align: center;">'+e+"</div>";t.innerHTML=n,document.getElementById("nbWebImLightContainer").appendChild(t),setTimeout(function(){t.parentNode.removeChild(t)},2e3)};var i={};return exports.sendfail=function(e,t,n){if(n.id){var o=t.g(n.id);if(o){if(!e.isConnected())o.innerHTML='<ins class="nb-webim-light-message-error-icon"></ins>\u5ba2\u670d\u5df2\u7ed3\u675f\u6c9f\u901a\uff0c\u53d1\u9001\u5931\u8d25';o.style.display="block",i[n.id]=n}}},exports.resend=function(e,t){var n=i[t];if(n)n.id="msg"+ +new Date,e.send(n)},exports.falseFeedback=function(e,t,i){var o=n[t];if(o)e.falseFeedback(o,i)},exports.scrollToBottom=function(){},exports.imgsendsuccess=function(e,t,n){for(var i=t.getImagesByBcsName(n.bcsName),o=0;o<i.length;o++)e.imgProccessor(i[o],exports.scrollToBottom),i[o].setAttribute("data-uploaded",1)},exports.imgsendfail=function(e,t){var n=document.getElementById(t.bcsName);if(n)n.setAttribute("data-uploaded",2),e.imgProccessor(n,exports.scrollToBottom)},exports.currentIR=function(){},exports.showMsgRemind=function(){},exports.csonline=function(){},exports.fininshIR=function(e,t,n){e.renderSystemMessage(t.LANG["CS"+n.type.toUpperCase()+"TIP"],"info")},exports.transferError=function(e,t){e.renderSystemMessage(t.LANG.TRANSFERERROR)},exports.visitorTransfer=function(e,t,n,i,o){e.renderSystemMessage(n.parseTime(new Date,"yyyy-MM-dd HH:mm:ss")+" "+t.LANG.VISITORTRANSFER.replace("${nickname}",i.nickname),"info",o)},exports}),define("embed/webimlight/communicate/config",["require","im-core/bullConfig","./main","./synchronizer","./handler"],function(require){return{package:"communicate",importConfig:[require("im-core/bullConfig")],resource:{main:require("./main"),synchronizer:require("./synchronizer"),handler:require("./handler")},injection:[{id:"communicate.main",method:{init:["core.main","core.config"],send:["core.main"],falseFeedback:["core.main"],sendUnableMessage:["core.main"],alive:["imLib.localStorage","core.config"],connect:["core.main","core.config","communicate.synchronizer"],bindEvent:["core.main","communicate.handler"]}},{id:"communicate.synchronizer",method:{broadcast:["imLib.localStorage"],emit:["imLib.localStorage"],on:["imLib.localStorage"],init:["core.config"],startpoll:["imLib.localStorage"]}},{id:"communicate.handler",method:{error:["webimlight.commonConfig"],queueing:["data.config"],csoffline:["webimlight.commonConfig"],visitorblock:["webimlight.commonConfig","layout.main"],autoendtalk:["webimlight.commonConfig"],invitefail:["webimlight.commonConfig"],connected:["core.main","core.config","webimlight.commonConfig","editor.main","imLib.util","pbase.lib"],sendfail:["core.chat","pbase.dom"],checkUpHF:["pbase.dom"],falseFeedbackFail:["pbase.dom"],falseFeedbackSuccess:["pbase.dom"],resend:["communicate.main"],falseFeedback:["communicate.main"],imgsendsuccess:["imfilter.main","messagecontainer.main"],imgsendfail:["imfilter.main"],fininshIR:["messagecontainer.main","webimlight.commonConfig"],fileSUpload:["messagecontainer.main","webimlight.commonConfig"],transferError:["messagecontainer.main","webimlight.commonConfig"],visitorTransfer:["messagecontainer.main","webimlight.commonConfig","pbase.lib"]}}],aspect:[{id:"communicate.main",pointCut:["layout.main.init, ,init","webimlight.entry.connect, ,connect","communicate.handler.connected, ,alive","communicate.handler.error, ,die","communicate.handler.csoffline, ,die","communicate.handler.invitefail, ,die","communicate.handler.autoendtalk, ,die","editor.main.send, ,send","picture.main.send, ,send","robot.main.send, ,send","communicate.handler.fileSUpload, ,sendUnableMessage"]},{id:"communicate.handler",pointCut:["messagecontainer.main.imgUploadSuccessNotify, ,imgsendsuccess","editor.main.pasteUploadSuccess, ,imgsendsuccess","messagecontainer.main.resend, ,resend","messagecontainer.main.falseFeedback, ,falseFeedback","communicate.main.die, ,stopPreSend","messagecontainer.main.imgUploadFailNotify, ,imgsendfail"]},{id:"communicate.synchronizer",pointCut:["communicate.main.init, ,init"]}]}}),define("embed/embedChat/bid",["require"],function(require){function e(e,t,n){var i=n.OLDBIDKEY+e+"_BID",o=t.getItem(i);if(!o)return o;else return o=parseInt(o.substr(0,13),16).toString()}var exports={};return exports.init=function(t,n,i,o,r,a,s){if(n.isObject(s)&&void 0!==a&&""!==a)return a;var c=o.BIDPRE+r;if(!a)a=t.getItem(c)||e(r,t,o)||i.getBid();return t.setItem(c,a),a},exports}),define("embed/embedChat/pc/leave",["require"],function(require){var e,exports={};return exports.pageLeave=function(t,n,i,o,r){if(!e){i.getServer("siteObj"),n.siteStatus}},exports.init=function(e){e.domOn(window,"pagehide",exports.pagehideHandler),e.domOn(window,"unload",exports.unloadHandler)},exports.pagehideHandler=function(e){e.domOff(window,"unload",exports.unloadHandler)},exports.unloadHandler=function(e){e.domOff(window,"pagehide",exports.pagehideHandler)},exports}),define("embed/embedChat/consts",[],function(){return{OLDBIDKEY:"QIAO_LS_",BIDPRE:"NEWBRIDGE_BID_",TALKTYPEPRE:"NEWBRIDGE_TALK_TYPE_",DOMAIN:"//sgoutong.baidu.com"}}),define("embed/embedChat/config",["require","./bid","./pc/chat","./pc/leave","./consts"],function(require){return{package:"pchat",resource:{bid:require("./bid"),chat:require("./pc/chat"),leave:require("./pc/leave"),consts:require("./consts")},injection:[{id:"pchat.chat",method:{toggle:["data.config","imLib.main"],setVisitorFrom:["core.config","data.config"],openWebimWindow:["core.config","core.net","data.config","pbase.dom"],createFrameChat:["pbase.dom"],bindFrameBtn:["pbase.dom","pbase.events","imLib.main","data.config"],bindMessageTipClick:["pbase.dom"],keepOpenmsgWin:["pbase.dom"],bindAudioBtn:["pbase.dom","data.config"],bindHideBtn:["pbase.dom"],accept:["core.config","core.net","data.config"],builtComunicate:["data.config","core.main","core.config","pchat.bid","core.site","pbase.dom","pchat.leave"],enterSuccess:["core.main","core.chat","imLib.main","core.config","data.config","pchat.consts","imLib.localStorage","pbase.dom","common.logger"],autoOpenWebimLight:["data.config","imLib.main"],openWebimLight:["pchat.consts","imLib.localStorage","data.config"],initSystemInvite:["core.config"],watchStatus:["core.config","data.config","core.chat","pchat.consts","imLib.localStorage","pbase.dom"],invite2Chat:["data.config"],refuse:["data.config","core.config","core.net"],initiative:["core.config","pbase.dom"],refuseSuccess:["core.config","pbase.dom"],sendInviteMessage:["common.util","imEditor.main","pbase.events","data.config","pbase.dom"],csoffline:["pmessage.pmain"],pageOnload:["pbase.events","core.config","common.util"],showNbFrameChatBox:["data.config"]}},{id:"pchat.leave",method:{pageLeave:["core.main","core.config","data.config","imLib.localStorage","pchat.consts"],init:["pbase.events"],pagehideHandler:["pbase.events"],unloadHandler:["pbase.events"]}},{id:"pchat.bid",method:{init:["imLib.localStorage","imLib.lang","pbase.lib","pchat.consts"]}}],aspect:[{id:"pchat.chat",pointCut:["pinvite.main.init, , builtComunicate","toolbar.main.enableSendBtn, ,sendInviteMessage"]},{id:"pchat.leave",pointCut:["pchat.chat.builtComunicate, , init"]}]}}),define("embed/webimlight/toolbar/face/main",[],function(){var e,t,n,i,exports={};exports.show=function(e){t.style.display="block",e.addClass(n,"nb-webim-light-face-show")},exports.hide=function(e){t.style.display="none",e.removeClass(n,"nb-webim-light-face-show")},exports.toggle=function(){if(exports.isShown())exports.hide();else exports.show()},exports.bindEvent=function(e){e.domOn(n,"click",function(t){exports.toggle(),e.domStop(t)}),e.domOn(t,"mouseover",function(e){e=e||window.event;var t=e.target||e.srcElement;if(t&&"nb-webim-light-face-item"===t.className)exports.showPreview(t);else if("nbwlFaceContainer"===t.id)o()}),e.domOn(t,"click",function(e){e=e||window.event;var t=e.target||e.srcElement,n=t.getAttribute("face"),i=t.getAttribute("alt"),o=t.getAttribute("extension");if(n)exports.faceSelected(n,i,o)})},exports.showPreview=function(e,t){for(var n=t.getAttribute("face"),o=0,r=0;r<e.length;r++)if(e[r].md5===n)o=r;if(o%12<6)i.style.left="313px";else i.style.left="12px";i.style.backgroundImage='url("//aff-im.cdn.bcebos.com/onlineEnv/webim/resource/img/face/'+n+'.png")',i.style.display="block"};var o=function(){i.style.display="none"};return exports.faceSelected=function(e,t){},exports.isShown=function(){return!!t.offsetHeight},exports.render=function(o,r,a,s,c){for(var d=[],l=o.get("faceItem"),u=0;u<s.length;u++)d.push(r.template(l,{md5:s[u].md5,ext:s[u].ext,comment:c[u]}));a.appendHTML(r.template(o.get("face"),{faceItems:d.join("")}),e),t=a.g("nbwlFaceContainer"),n=a.g("nbwlFaceIcon"),i=a.g("previewBox")},exports.init=function(t,n,i){e=t.g("nbwlToolBar"),n.parse(i),exports.render(),exports.bindEvent()},exports}),define("embed/webimlight/toolbar/face/facemd5",[],function(){return[{md5:"7f62a16f51cc29b221a87ed741cb2040",ext:"png"},{md5:"449f34831c63932bc6f816fb69222696",ext:"png"},{md5:"84ac7709105c9e8b986e1fb080aef158",ext:"png"},{md5:"1360cc1b2e12fc722571584290a2b6e1",ext:"png"},{md5:"6628ce0328a1aec3e3688a95ebbd609d",ext:"png"},{md5:"5a2cce712902b315f98cbce1df04462a",ext:"png"},{md5:"6c0ae5a68c041f7f339d87ba313292c5",ext:"png"},{md5:"576f76513e5a4c5b49b8e5323e69ff8b",ext:"png"},{md5:"43a89b8fa99b951863b9e52bbba44e63",ext:"png"},{md5:"f0bcf27ffcef2c7d627af19d04ce7051",ext:"png"},{md5:"b19fb15226fdc3bedb574f7f319ac4e8",ext:"png"},{md5:"20791b0c75839b8ede1deddf7d14ea0e",ext:"png"},{md5:"585d6a02d5209eebce230c11a84e2122",ext:"png"},{md5:"65c0ea03c6ad3a2c9a56ef2f12d73d7f",ext:"png"},{md5:"9c3ab5280830b24928fba2ecbfa5423c",ext:"png"},{md5:"ec619f6b677a364aa8daca7ee088b0fc",ext:"png"},{md5:"ba6bd8678622db5c54cc265f78540a59",ext:"png"},{md5:"5d2bba3091be38970563d3e4bd04e8fb",ext:"png"},{md5:"eba03f67b8a667bb16b20fd32b9b51bd",ext:"png"},{md5:"915fb0149e684a7f1f40f568aac87a74",ext:"png"},{md5:"80f75e10b4fb8c46df80b1595c7d50cb",ext:"png"},{md5:"49c0997a2807cf28300e84fb87605efe",ext:"png"},{md5:"e162da21d7bde950367501958629aa18",ext:"png"},{md5:"f59bf80e1ba9111f4ee819fddec977d5",ext:"png"},{md5:"6594322f85d0a78caa55c95182937a43",ext:"png"},{md5:"6dd384507524a14951b2978ce45d427c",ext:"png"},{md5:"d2b9f0ebae2898bab340a464f10a678c",ext:"png"},{md5:"3b1f5191cc6f6aab3fbc161f5ca95586",ext:"png"},{md5:"6b562d094d2f23a5f41ba823ded02da2",ext:"png"},{md5:"10dbd6c0cf8d5af5c70fdf4eb7f98692",ext:"png"},{md5:"ce277e2ca55543eb7eb467c5d397e10d",ext:"png"},{md5:"d652ac7ff1ac8c0d4ad9d00e9847fccc",ext:"png"},{md5:"42c9ab68d510f0dfa35e4df3abf6a5fa",ext:"png"},{md5:"8e972967218fa060a8fcda1a54fe025b",ext:"png"},{md5:"2a3a3cf6d0b28d889fd249e3d68afae2",ext:"png"},{md5:"9912488906a31978d1c93150e7da65be",ext:"png"},{md5:"034650679ea520821ace18816fd309b8",ext:"png"},{md5:"f34d9586f86e135e4ce5c9630c9f6a25",ext:"png"},{md5:"a5b36a0ac2cf38463e9e6486fc3d6b70",ext:"png"},{md5:"f5ddc76e56c8221e61c58b72e37f9829",ext:"png"},{md5:"2f25b6cbc178c5811743bb3f3fe95eb6",ext:"png"},{md5:"b6405f17ae2596f6065a8b1da7d81da4",ext:"png"},{md5:"b0955a756bc690b02fc6c82cb5663be6",ext:"png"},{md5:"6a91ab45cab3ce482b2069f3a8bb43aa",ext:"png"},{md5:"e33ec7875595d23dfc0e70625aa839dd",ext:"png"},{md5:"d987e058fe2ddb9436e3f3af3aeee43c",ext:"png"},{md5:"7413c233681ce9f2a7d3d0e22d4ba632",ext:"png"},{md5:"004a9411849aa007b843d4bc74ba2db3",ext:"png"},{md5:"1e04fa2b77173ad5419c58cb2a4c944c",ext:"png"},{md5:"14f8db64e92d43e0ee4bb1c55553e399",ext:"png"},{md5:"0246fb8175a9e47e859593f6ed19e7f3",ext:"png"},{md5:"54207c894ff556b1778eeb90893e196a",ext:"png"},{md5:"73d4ace4f6bafb7c48f7d4ea62da5e27",ext:"png"},{md5:"f985e5a0d5f5e7ec7d0e02f229164816",ext:"png"},{md5:"4fc4e9bf21b34df2170c2add1a215162",ext:"png"},{md5:"481fa659924b4dd3c692556fe1e42349",ext:"png"},{md5:"e0275fff10e8225e5618e7baf95b6296",ext:"png"},{md5:"e1e8ac2d122dca4fe77644994a815613",ext:"png"},{md5:"fd1457cad55db7e7dc7970acb24e5832",ext:"png"},{md5:"dc45642dc5aae41541fff2634a08a647",ext:"png"},{md5:"49106010c742c69727221622283131a9",ext:"png"},{md5:"6b278bb3a2acaa362311551208c22de7",ext:"png"},{md5:"3693411aa84d66f7ff840993acc9c753",ext:"png"},{md5:"f5d3fd06ead545b5abd48e367195b1fb",ext:"png"},{md5:"a91f909f9d1a1fdca0c0eaf8f232eb1f",ext:"png"},{md5:"3e2ec2a092127757f89a771762d2103f",ext:"png"},{md5:"5cd4259ce1239fb13b1b026826ae5cd8",ext:"png"},{md5:"b9149566ccf3b7937ab2f0a639e681f5",ext:"png"},{md5:"6697732553bbee2d1760b2d889220eb2",ext:"png"},{md5:"5537920713864c60f86dcba194b459ef",ext:"png"},{md5:"bf4bc9d82fd8365319e4f4fca8732e26",ext:"png"},{md5:"bb3b630c7189b362d39905a6b10f4e25",ext:"png"},{md5:"c6796331da7ebed681d6adcfdc1d9e60",ext:"png"},{md5:"5e54aaa520e07cc35c92594aa85c3ca5",ext:"png"},{md5:"0e3a50af997063d132bb115e98cf9783",ext:"png"},{md5:"f4963b986d487f24100ac41b4d36e4b6",ext:"png"},{md5:"78d7c5e2e0dfb11fce910a45019bc52c",ext:"png"},{md5:"24b03c84c57ced0bea595c264bd7d9f1",ext:"png"},{md5:"e6af94688a6f70062c75a3cf3f8dfdf5",ext:"png"},{md5:"71a6b6d3231a0ca74f2c80f6c36b81b8",ext:"png"}]}),define("embed/webimlight/toolbar/face/facename",[],function(){return["\u5fae\u7b11","\u5927\u7b11","\u5077\u7b11","\u61a8\u7b11","\u5f97\u610f","\u53ef\u7231","\u5bb3\u7f9e","\u4e56","\u6dd8\u6c14","\u8c03\u76ae","\u6d41\u6cea","\u5927\u54ed","\u6487\u5634","\u95ed\u5634","\u5618","\u9119\u89c6","\u50b2\u6162","\u767d\u773c","\u601d\u8003","\u56f0","\u7761","\u6c57","\u5c34\u5c2c","\u60ca\u8bb6","\u60ca\u6050","\u7591\u95ee","\u6655","\u6572\u6253","\u96be\u8fc7","\u59d4\u5c48","\u8272","\u6293\u72c2","\u6124\u6012","\u5410","\u8870","\u518d\u89c1","\u6ed1\u7a3d","\u9ad8\u5174","\u5b8c\u7f8e","\u574f\u7b11","\u60ca\u5446","\u563f\u54c8","\u673a\u667a","\u8d70\u4f60","\u6342\u8138","\u6233\u8138","\u7231\u5fc3","\u9f3b\u8840","\u594b\u6597","\u68d2\u68d2\u54d2","\u6478\u5934","NO","\u6c89\u601d","\u62a0\u9f3b","\u751f\u75c5","\u53e3\u7f69","\u5de6\u62e5\u62b1","\u53f3\u62e5\u62b1","\u95ea\u4eba","\u5200","\u543b","\u7231\u60c5","\u5fc3\u788e","\u9c9c\u82b1","\u67af\u840e","\u80dc\u5229","OK","\u5927\u62c7\u6307","\u5f31","\u63e1\u624b","\u86cb\u7cd5","\u5496\u5561","\u5403\u996d","\u592a\u9633","\u6708\u4eae","\u661f\u661f","\u4fbf\u4fbf","\u732a\u5934","\u94b1","Hi"]}),define("embed/webimlight/toolbar/face/main.tpl",[],function(){return'\x3c!-- target: face --\x3e<ins id="nbwlFaceIcon" class="nb-webim-light-toolbar-face" title="\u9009\u62e9\u8868\u60c5"><ins id="nbwlFaceContainer" class="nb-webim-light-face-container"><ins class="nb-webim-light-face-content"><ul><%faceItems%></ul></ins><ins id="previewBox"></ins><div class="nb-webim-light-arrow"><em></em><ins></ins></div><ins></ins>\x3c!-- target: faceItem --\x3e<li class="nb-webim-light-face-item" face="<%md5%>" extension="<%ext%>" alt="<%comment%>"></li>'}),define("embed/webimlight/toolbar/face/config",["require","./main","./facemd5","./facename","./main.tpl"],function(require){return{package:"face",resource:{main:require("./main"),facemd5:require("./facemd5"),facename:require("./facename"),tpl:require("./main.tpl")},injection:[{id:"face.main",method:{init:["pbase.dom","common.tpl","face.tpl"],bindEvent:["pbase.events"],show:["pbase.dom"],hide:["pbase.dom"],render:["common.tpl","common.util","pbase.dom","face.facemd5","face.facename"],showPreview:["face.facemd5"]}}],aspect:[{id:"face.main",pointCut:["toolbar.main.render, , init","layout.main.hasOperation, , hide","font.main.toggleFontBar, , hide"]}]}}),define("embed/webimlight/toolbar/picture/main",[],function(){var e,t,n,exports={};return exports.bindEvent=function(e,n){t=e.g("nbwlPicInput"),n.domOn(t,"change",function(e){exports.fileSelected(t)})},exports.checkExt=function(e,t){var n=e.picExt,i=t.value,o=i.substring(i.lastIndexOf(".")).toLowerCase();if(-1===n.indexOf(o))return!1;else return!0},exports.checkSize=function(e,t){var n=e.sizeLimit,i=0;if(!n)return!0;try{if("files"in t)i=t.files[0].size;else{var o=new ActiveXObject("Scripting.FileSystemObject"),r=t.value;i=o.getFile(r).size}}catch(e){}if(i>n)return!1;else return!0},exports.send=function(e){},exports.resetInput=function(){n.innerHTML=n.innerHTML,exports.bindEvent()},exports.message=function(e){},exports.fileSelected=function(e,i,o,r,a,s){if(s.value){if(!exports.checkExt(s))return void exports.checkFailMsg();if(!exports.checkSize(s))return void exports.checkFailMsg();if(i.isConnected()){var c=o.uuid(),d="msg"+ +new Date,l=r.template(a.get("imgMessage"),{bcsname:c});exports.send({type:"img",id:d,bcsName:c,form:n,text:l,role:0,path:t.value})}}},exports.render=function(i,o,r){r.appendHTML(o.template(i.get("picture")),e),t=r.g("nbwlPicInput"),n=r.g("nbwlPicForm")},exports.checkFailMsg=function(e,t){e.renderSystemMessage(t.LANG.IMGERROR)},exports.init=function(t,n,i){e=t.g("nbwlToolBar"),n.parse(i),exports.render(),exports.bindEvent()},exports}),define("embed/webimlight/toolbar/picture/main.tpl",[],function(){return'\x3c!-- target: picture --\x3e<ins class="nb-webim-light-toolbar-picture" title="\u9009\u62e9\u56fe\u7247"><form id="nbwlPicForm"><input id="nbwlPicInput" type="file" name="pic" accept="image/jpeg,image/png,image/gif"></form></ins>\x3c!-- target: imgMessage --\x3e<img id="<%bcsname%>" data-uploaded="0" data-bcsName="<%bcsname%>">'}),define("embed/webimlight/toolbar/picture/config",["require","./main","./main.tpl"],function(require){return{package:"picture",resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"picture.main",method:{init:["pbase.dom","common.tpl","picture.tpl"],bindEvent:["pbase.dom","pbase.events"],checkExt:["webimlight.commonConfig"],fileSelected:["core.net","core.chat","imLib.util","common.util","common.tpl"],render:["common.tpl","common.util","pbase.dom"],checkFailMsg:["messagecontainer.main","webimlight.commonConfig"]}}],aspect:[{id:"picture.main",pointCut:["toolbar.main.render, , init","picture.main.fileSelected, , resetInput"]}]}}),define("embed/webimlight/toolbar/select",["require"],function(require){function e(e,n){var i={},o=t(e,n);if(!o.length&&0!==o.length)o=[o];return i.domlist=o,i.each=function(e){e=e||function(){};for(var t=0;t<this.domlist.length;t++)e(t,this.domlist[t])},i}function t(e,t){var n=t||document;if("string"!=typeof e)return e;else if(n.querySelectorAll)return n.querySelectorAll(e);else if(0===e.indexOf(".")){for(var i=n.getElementsByName("*"),o=" "+e.substring(1)+" ",r=[],a=0;a<i.length;a++){var s=i[a],c=s.className;if(c)if(c=" "+c+" ",0!==c.indexOf(o))r.push(s)}return r}else if(0===e.indexOf("#"))return document.getElementById(e.substring(1));else return n.getElementsByTagName(e)}function n(e,t){return t=t||document,t.getElementsByTagName(e)}function i(e,t){return n(e,t)[0]}function o(e){for(var t=e.value,i=n("option",e),o=0;o<i.length;o++){var r=i[o];if(r.value===t)return r}}function r(e,t,n){if(e.addEventListener)e.addEventListener(t,n);else if(e.attachEvent)e.attachEvent("on"+t,n);else e["on"+t]=n}function a(e){var t=null;if(document.createEvent&&e.dispatchEvent)t=document.createEvent("HTMLEvents"),t.initEvent("change",!0,!0),e.dispatchEvent(t);else if(document.createEventObject&&e.fireEvent)t=document.createEventObject(),e.fireEvent("onchange",t);else if(e.onchange)e.onchange()}function s(e,t){if(!d(e)){t=t||{};if(-1===(e.className||"").indexOf("nb-webim-light-selectmodal"))e.className+=" nb-webim-light-selectmodal";l.push(e);var n=i("select",e);n.style.display="none";var s=c(n),u=o(n).innerHTML,f=document.createElement("div");f.className="nb-webim-light-selectmodalvalue",f.innerHTML=u,e.appendChild(f),e.appendChild(s),r(f,"click",function(e){if(e=e||window.event,s.style.display="block",t.onShow)t.onShow();return!1}),r(s,"click",function(e){e=e||window.event;var i=e.target||e.srcElement;if(-1!==i.className.indexOf("nb-webim-light-selectmodaloption")){s.style.display="none";var o=i.getAttribute("value"),r=i.innerHTML;if(n.value=o,f.innerHTML=r,a(n),t.onHide)t.onHide()}return!1}),r(document.body,"click",function(e){if(s.style.display="none",t.onHide)t.onHide()})}}function c(e){var t=document.createElement("div");t.className="nb-webim-light-selectmodallist";for(var i=n("option",e),o=0;o<i.length;o++){var r=i[o],a=r.getAttribute("value"),s=r.innerHTML,c=document.createElement("div");c.className="nb-webim-light-selectmodaloption",c.innerHTML=s,c.setAttribute("value",a),t.appendChild(c)}return t}function d(e){for(var t=0;t<l.length;t++)if(l[t]===e)return!0;return!1}var exports={},l=[];return exports.init=function(t,n){if(t)return void s(t,n);e(".nb-webim-light-selectmodal").each(function(e,t){s(t,n)})},exports}),define("embed/webimlight/toolbar/main",[],function(){var e,exports={};return exports.bindEvent=function(e,t){var n=e.g("nbwlSendBtn"),i=e.getElementsByClass("nb-webim-light-toolbar-send-select")[0],o=e.getElementsByClass("nb-webim-light-toolbar-send-select-layer")[0],r=!1;if(t.domOn(n,"click",function(e){if(e=e||window.event,(e.target||e.srcElement)===n||!o||!i)exports.sendBtnClick();else if(!r)o.style.display="block",r=!0}),t.domOn(n,"mousedown",function(t){if(t=t||window.event,this===(t.target||t.srcElement))e.addClass(n,"nb-webim-light-toolbar-send-down")}),t.domOn(document.body,"mouseup",function(t){e.removeClass(n,"nb-webim-light-toolbar-send-down")}),o&&i){var a=o.getElementsByTagName("div");t.domOn(document.body,"click",function(t){t=t||window.event;var n=t.target||t.srcElement;if(r){if(e.isParentNode(n,i))return;var s=e.isParentNode(n,o);if(n===a[0]||n===a[1]){var c=n.getAttribute("val");return a[0].className="",a[1].className="",n.className="nb-webim-light-toolbar-send-select-layer-active",r=!1,o.style.display="none",void exports.changeSendKey("ctrlenter"===c)}else if(s)return;r=!1,o.style.display="none"}})}},exports.changeSendKey=function(e){},exports.disableSendBtn=function(e){var t=e.g("nbwlSendBtn");e.setStyles(t,{backgroundColor:""}),e.addClass(t,"nb-webim-light-toolbar-send-disable");for(var n=document.getElementsByClassName("nb-webim-light-message-rewrite"),i=n.length,o=0;o<i;o++)n[o].className+=" nb-webim-light-message-resend-sent";for(var r=document.getElementsByClassName("nb-webim-light-message-feedback"),a=r.length,s=0;s<a;s++)r[s].className+=" nb-webim-light-message-resend-sent"},exports.enableSendBtn=function(e,t){var n=e.g("nbwlSendBtn"),i=t.getServer("configBox").webimConfig;if(1===i.themeType)e.setStyles(n,{backgroundColor:i.customerColor});e.removeClass(n,"nb-webim-light-toolbar-send-disable");var o=document.getElementById("nbwlStatusMessage").nextElementSibling;if(o&&"nb-webim-light-system-message"===o.className)o.remove()},exports.sendBtnClick=function(){},exports.render=function(t,n,i){i.appendHTML(n.template(t.get("toolbar")),e)},exports.init=function(t,n,i,o){if(e=t.g("nbWebImLightContainer"),/Windows\s+NT/i.test(navigator.userAgent))e.className+=" nb-webim-light-windowsos";n.parse(i),exports.render(),exports.bindEvent(),o.init()},exports}),define("embed/webimlight/toolbar/main.tpl",[],function(){return'\x3c!-- target: toolbar --\x3e<ins id="nbwlToolBar"><ins id="nbwlSendBtn" class="nb-webim-light-toolbar-send nb-webim-light-toolbar-send-disable">\u53d1\u9001<span class="nb-webim-light-toolbar-send-select"><span></span></span><div class="nb-webim-light-toolbar-send-select-layer"><div val="enter" class="nb-webim-light-toolbar-send-select-layer-active">\u6309Enter\u53d1\u9001</div><div val="ctrlenter">\u6309Ctrl+Enter\u53d1\u9001</div></div></ins></ins>'}),define("embed/webimlight/toolbar/config",["require","./face/config","./picture/config","./select","./main","./main.tpl"],function(require){return{package:"toolbar",importConfig:[require("./face/config"),require("./picture/config"),require("./select")],resource:{main:require("./main"),tpl:require("./main.tpl"),select:require("./select")},injection:[{id:"toolbar.main",method:{init:["pbase.dom","common.tpl","toolbar.tpl","toolbar.select"],bindEvent:["pbase.dom","pbase.events"],disableSendBtn:["pbase.dom"],enableSendBtn:["pbase.dom","data.config"],render:["common.tpl","common.util","pbase.dom"]}}],aspect:[{id:"toolbar.main",pointCut:["layout.main.render, , init","communicate.handler.connected, , enableSendBtn","communicate.handler.error, , disableSendBtn","communicate.handler.autoendtalk, , disableSendBtn"]}]}}),define("embed/webimlight/support/main",[],function(){var e,exports={};return exports.render=function(t,n,i){i.appendHTML(n.template(t.get("support")),e)},exports.init=function(t,n,i){e=t.g("nbWebImLightContainer"),n.parse(i),exports.render()},exports}),define("embed/webimlight/support/main.tpl",[],function(){return'\x3c!-- target: support --\x3e\x3c!-- //<ins class="nb-webim-light-support">// <span class="nb-webim-light-support-icon"></span>\u54a8\u8be2\u8f6f\u4ef6\u7531\u767e\u5ea6\u5546\u6865\u514d\u8d39\u63d0\u4f9b</ins>--\x3e'}),define("embed/webimlight/support/config",["require","./main","./main.tpl"],function(require){return{package:"support",importConfig:[],resource:{main:require("./main"),tpl:require("./main.tpl")},injection:[{id:"support.main",method:{init:["pbase.dom","common.tpl","support.tpl"],render:["common.tpl","common.util","pbase.dom"]}}],aspect:[{id:"support.main",pointCut:["layout.main.render, , init"]}]}}),define("embed/webimlight/entry",["require"],function(require){var exports={};return exports.init=function(){},exports.connect=function(){},exports.show=function(){},exports}),define("embed/webimlight/config",["require","./statusbar/config","./robot/config","./messagecontainer/config","../data/bullConfig","./layout/config","./editor/config","./communicate/config","../embedChat/config","./toolbar/config","./support/config","./entry","./commonConfig"],function(require){return{package:"webimlight",importConfig:[require("./statusbar/config"),require("./robot/config"),require("./messagecontainer/config"),require("../data/bullConfig"),require("./layout/config"),require("./editor/config"),require("./communicate/config"),require("../embedChat/config"),require("./toolbar/config"),require("./support/config")],resource:{entry:require("./entry"),commonConfig:require("./commonConfig")}}}),define("embed/webimlight/main",["require","bull","./config","../mobilelite/lib/ajax","./commonConfig"],function(require){var exports={},e=require("bull"),t=require("./config"),n=(require("../mobilelite/lib/ajax"),0);return exports.init=function(){if(0===n){n=1,e.init(t);var i=e.get("data.config"),o=i.getServer("configBox"),r=i.getServer("siteObj"),a=o.webimConfig;require("./commonConfig").init(r.webRoot);var s="";if(s="embed/css/pc/webimlight/skin-"+a.skinIndex+".css",1===a.themeType)s="embed/css/pc/webimlight/skin-0.css";(0,(false||document.getElementById("newBridge")).require)(["cl!"+s],function(){n=2;var t=e.get("webimlight.entry");t.init(),t.connect()})}else if(1===n)return;else if(2===n)return void e.get("webimlight.entry").show();else if(3===n)n=2,e.get("webimlight.entry").connect(),e.get("webimlight.entry").show()},exports.finish=function(){n=3},exports});}();
